---
source: crates/runtime/benches/bench.rs
description: "Query: select  channel, item, return_ratio, return_rank, currency_rank from\n (select\n 'web' as channel\n ,web.item\n ,web.return_ratio\n ,web.return_rank\n ,web.currency_rank\n from (\n \tselect\n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect ws.ws_item_sk as item\n \t\t,(cast(sum(coalesce(wr.wr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(wr.wr_return_amt,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(ws.ws_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom\n \t\t web_sales ws left outer join web_returns wr\n \t\t\ton (ws.ws_order_number = wr.wr_order_number and\n \t\t\tws.ws_item_sk = wr.wr_item_sk)\n                 ,date_dim\n \t\twhere\n \t\t\twr.wr_return_amt > 10000\n \t\t\tand ws.ws_net_profit > 1\n                         and ws.ws_net_paid > 0\n                         and ws.ws_quantity > 0\n                         and ws_sold_date_sk = d_date_sk\n                         and d_year = 2000\n                         and d_moy = 12\n \t\tgroup by ws.ws_item_sk\n \t) in_web\n ) web\n where\n (\n web.return_rank <= 10\n or\n web.currency_rank <= 10\n )\n union\n select\n 'catalog' as channel\n ,catalog.item\n ,catalog.return_ratio\n ,catalog.return_rank\n ,catalog.currency_rank\n from (\n \tselect\n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect\n \t\tcs.cs_item_sk as item\n \t\t,(cast(sum(coalesce(cr.cr_return_quantity,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(cr.cr_return_amount,0)) as decimal(15,4))/\n \t\tcast(sum(coalesce(cs.cs_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom\n \t\tcatalog_sales cs left outer join catalog_returns cr\n \t\t\ton (cs.cs_order_number = cr.cr_order_number and\n \t\t\tcs.cs_item_sk = cr.cr_item_sk)\n                ,date_dim\n \t\twhere\n \t\t\tcr.cr_return_amount > 10000\n \t\t\tand cs.cs_net_profit > 1\n                         and cs.cs_net_paid > 0\n                         and cs.cs_quantity > 0\n                         and cs_sold_date_sk = d_date_sk\n                         and d_year = 2000\n                         and d_moy = 12\n                 group by cs.cs_item_sk\n \t) in_cat\n ) catalog\n where\n (\n catalog.return_rank <= 10\n or\n catalog.currency_rank <=10\n )\n union\n select\n 'store' as channel\n ,store.item\n ,store.return_ratio\n ,store.return_rank\n ,store.currency_rank\n from (\n \tselect\n \t item\n \t,return_ratio\n \t,currency_ratio\n \t,rank() over (order by return_ratio) as return_rank\n \t,rank() over (order by currency_ratio) as currency_rank\n \tfrom\n \t(\tselect sts.ss_item_sk as item\n \t\t,(cast(sum(coalesce(sr.sr_return_quantity,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_quantity,0)) as decimal(15,4) )) as return_ratio\n \t\t,(cast(sum(coalesce(sr.sr_return_amt,0)) as decimal(15,4))/cast(sum(coalesce(sts.ss_net_paid,0)) as decimal(15,4) )) as currency_ratio\n \t\tfrom\n \t\tstore_sales sts left outer join store_returns sr\n \t\t\ton (sts.ss_ticket_number = sr.sr_ticket_number and sts.ss_item_sk = sr.sr_item_sk)\n                ,date_dim\n \t\twhere\n \t\t\tsr.sr_return_amt > 10000\n \t\t\tand sts.ss_net_profit > 1\n                         and sts.ss_net_paid > 0\n                         and sts.ss_quantity > 0\n                         and ss_sold_date_sk = d_date_sk\n                         and d_year = 2000\n                         and d_moy = 12\n \t\tgroup by sts.ss_item_sk\n \t) in_store\n ) store\n where  (\n store.return_rank <= 10\n or\n store.currency_rank <= 10\n )\n )\n order by 1,4,5,2\n  LIMIT 100;\n"
snapshot_kind: text
---
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: channel ASC NULLS LAST, web.return_rank ASC NULLS LAST, web.currency_rank ASC NULLS LAST, web.item ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |   Aggregate: groupBy=[[channel, web.item, web.return_ratio, web.return_rank, web.currency_rank]], aggr=[[]]                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |     Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |       Projection: Utf8("web") AS channel, web.item, web.return_ratio, web.return_rank, web.currency_rank                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |         SubqueryAlias: web                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |           Projection: in_web.item, in_web.return_ratio, rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW AS return_rank, rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW AS currency_rank                                                                                                                                                                                                                                          |
|               |             Filter: rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW <= UInt64(10) OR rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW <= UInt64(10)                                                                                                                                                                                                                                                                                |
|               |               Projection: in_web.item, in_web.return_ratio, rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW, rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW                                                                                                                                                                                                                                                                      |
|               |                 WindowAggr: windowExpr=[[rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]]                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                   WindowAggr: windowExpr=[[rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]]                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                     SubqueryAlias: in_web                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                       Projection: ws.ws_item_sk AS item, CAST(sum(coalesce(wr.wr_return_quantity,Int64(0))) AS Decimal128(15, 4)) / CAST(sum(coalesce(ws.ws_quantity,Int64(0))) AS Decimal128(15, 4)) AS return_ratio, CAST(sum(coalesce(wr.wr_return_amt,Int64(0))) AS Decimal128(15, 4)) / CAST(sum(coalesce(ws.ws_net_paid,Int64(0))) AS Decimal128(15, 4)) AS currency_ratio                                                                                                                                                                  |
|               |                         Aggregate: groupBy=[[ws.ws_item_sk]], aggr=[[sum(coalesce(CAST(wr.wr_return_quantity AS Int64), Int64(0))), sum(coalesce(CAST(ws.ws_quantity AS Int64), Int64(0))), sum(coalesce(CAST(wr.wr_return_amt AS Decimal128(22, 2)), Decimal128(Some(0),22,2))) AS sum(coalesce(wr.wr_return_amt,Int64(0))), sum(coalesce(CAST(ws.ws_net_paid AS Decimal128(22, 2)), Decimal128(Some(0),22,2))) AS sum(coalesce(ws.ws_net_paid,Int64(0)))]]                                                                                      |
|               |                           Projection: ws.ws_item_sk, ws.ws_quantity, ws.ws_net_paid, wr.wr_return_quantity, wr.wr_return_amt                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             Inner Join: ws.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                               Filter: wr.wr_return_amt > Decimal128(Some(1000000),7,2)                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                 Projection: ws.ws_sold_date_sk, ws.ws_item_sk, ws.ws_quantity, ws.ws_net_paid, wr.wr_return_quantity, wr.wr_return_amt                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                   Left Join: ws.ws_order_number = wr.wr_order_number, ws.ws_item_sk = wr.wr_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                     SubqueryAlias: ws                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       Projection: web_sales.ws_sold_date_sk, web_sales.ws_item_sk, web_sales.ws_order_number, web_sales.ws_quantity, web_sales.ws_net_paid                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                           Filter: web_sales.ws_net_profit > Decimal128(Some(100),7,2) AND web_sales.ws_net_paid > Decimal128(Some(0),7,2) AND web_sales.ws_quantity > Int32(0)                                                                                                                                                                                                                                                                                                                                                    |
|               |                                             TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_order_number, ws_quantity, ws_net_paid, ws_net_profit]                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                     SubqueryAlias: wr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                         TableScan: web_returns projection=[wr_item_sk, wr_order_number, wr_return_quantity, wr_return_amt]                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                               Projection: date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                   Filter: date_dim.d_year = Int32(2000) AND date_dim.d_moy = Int32(12)                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                     TableScan: date_dim projection=[d_date_sk, d_year, d_moy]                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |       Projection: Utf8("catalog") AS channel, catalog.item, catalog.return_ratio, catalog.return_rank, catalog.currency_rank                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |         SubqueryAlias: catalog                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |           Projection: in_cat.item, in_cat.return_ratio, rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW AS return_rank, rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW AS currency_rank                                                                                                                                                                                                                                          |
|               |             Filter: rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW <= UInt64(10) OR rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW <= UInt64(10)                                                                                                                                                                                                                                                                                |
|               |               Projection: in_cat.item, in_cat.return_ratio, rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW, rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW                                                                                                                                                                                                                                                                      |
|               |                 WindowAggr: windowExpr=[[rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]]                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                   WindowAggr: windowExpr=[[rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]]                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                     SubqueryAlias: in_cat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                       Projection: cs.cs_item_sk AS item, CAST(sum(coalesce(cr.cr_return_quantity,Int64(0))) AS Decimal128(15, 4)) / CAST(sum(coalesce(cs.cs_quantity,Int64(0))) AS Decimal128(15, 4)) AS return_ratio, CAST(sum(coalesce(cr.cr_return_amount,Int64(0))) AS Decimal128(15, 4)) / CAST(sum(coalesce(cs.cs_net_paid,Int64(0))) AS Decimal128(15, 4)) AS currency_ratio                                                                                                                                                               |
|               |                         Aggregate: groupBy=[[cs.cs_item_sk]], aggr=[[sum(coalesce(CAST(cr.cr_return_quantity AS Int64), Int64(0))), sum(coalesce(CAST(cs.cs_quantity AS Int64), Int64(0))), sum(coalesce(CAST(cr.cr_return_amount AS Decimal128(22, 2)), Decimal128(Some(0),22,2))) AS sum(coalesce(cr.cr_return_amount,Int64(0))), sum(coalesce(CAST(cs.cs_net_paid AS Decimal128(22, 2)), Decimal128(Some(0),22,2))) AS sum(coalesce(cs.cs_net_paid,Int64(0)))]]                                                                                |
|               |                           Projection: cs.cs_item_sk, cs.cs_quantity, cs.cs_net_paid, cr.cr_return_quantity, cr.cr_return_amount                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                             Inner Join: cs.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                               Filter: cr.cr_return_amount > Decimal128(Some(1000000),7,2)                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 Projection: cs.cs_sold_date_sk, cs.cs_item_sk, cs.cs_quantity, cs.cs_net_paid, cr.cr_return_quantity, cr.cr_return_amount                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                   Left Join: cs.cs_order_number = cr.cr_order_number, cs.cs_item_sk = cr.cr_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                     SubqueryAlias: cs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_item_sk, catalog_sales.cs_order_number, catalog_sales.cs_quantity, catalog_sales.cs_net_paid                                                                                                                                                                                                                                                                                                                                                    |
|               |                                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                           Filter: catalog_sales.cs_net_profit > Decimal128(Some(100),7,2) AND catalog_sales.cs_net_paid > Decimal128(Some(0),7,2) AND catalog_sales.cs_quantity > Int32(0)                                                                                                                                                                                                                                                                                                                                        |
|               |                                             TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_order_number, cs_quantity, cs_net_paid, cs_net_profit]                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     SubqueryAlias: cr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                         TableScan: catalog_returns projection=[cr_item_sk, cr_order_number, cr_return_quantity, cr_return_amount]                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                               Projection: date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                   Filter: date_dim.d_year = Int32(2000) AND date_dim.d_moy = Int32(12)                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                     TableScan: date_dim projection=[d_date_sk, d_year, d_moy]                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |       Projection: Utf8("store") AS channel, store.item, store.return_ratio, store.return_rank, store.currency_rank                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |         SubqueryAlias: store                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |           Projection: in_store.item, in_store.return_ratio, rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW AS return_rank, rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW AS currency_rank                                                                                                                                                                                                                                  |
|               |             Filter: rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW <= UInt64(10) OR rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW <= UInt64(10)                                                                                                                                                                                                                                                                            |
|               |               Projection: in_store.item, in_store.return_ratio, rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW, rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW                                                                                                                                                                                                                                                              |
|               |                 WindowAggr: windowExpr=[[rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]]                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                   WindowAggr: windowExpr=[[rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]]                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                     SubqueryAlias: in_store                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                       Projection: sts.ss_item_sk AS item, CAST(sum(coalesce(sr.sr_return_quantity,Int64(0))) AS Decimal128(15, 4)) / CAST(sum(coalesce(sts.ss_quantity,Int64(0))) AS Decimal128(15, 4)) AS return_ratio, CAST(sum(coalesce(sr.sr_return_amt,Int64(0))) AS Decimal128(15, 4)) / CAST(sum(coalesce(sts.ss_net_paid,Int64(0))) AS Decimal128(15, 4)) AS currency_ratio                                                                                                                                                               |
|               |                         Aggregate: groupBy=[[sts.ss_item_sk]], aggr=[[sum(coalesce(CAST(sr.sr_return_quantity AS Int64), Int64(0))), sum(coalesce(CAST(sts.ss_quantity AS Int64), Int64(0))), sum(coalesce(CAST(sr.sr_return_amt AS Decimal128(22, 2)), Decimal128(Some(0),22,2))) AS sum(coalesce(sr.sr_return_amt,Int64(0))), sum(coalesce(CAST(sts.ss_net_paid AS Decimal128(22, 2)), Decimal128(Some(0),22,2))) AS sum(coalesce(sts.ss_net_paid,Int64(0)))]]                                                                                  |
|               |                           Projection: sts.ss_item_sk, sts.ss_quantity, sts.ss_net_paid, sr.sr_return_quantity, sr.sr_return_amt                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                             Inner Join: sts.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                               Filter: sr.sr_return_amt > Decimal128(Some(1000000),7,2)                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                 Projection: sts.ss_sold_date_sk, sts.ss_item_sk, sts.ss_quantity, sts.ss_net_paid, sr.sr_return_quantity, sr.sr_return_amt                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   Left Join: sts.ss_ticket_number = sr.sr_ticket_number, sts.ss_item_sk = sr.sr_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     SubqueryAlias: sts                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                       Projection: store_sales.ss_sold_date_sk, store_sales.ss_item_sk, store_sales.ss_ticket_number, store_sales.ss_quantity, store_sales.ss_net_paid                                                                                                                                                                                                                                                                                                                                                             |
|               |                                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                           Filter: store_sales.ss_net_profit > Decimal128(Some(100),7,2) AND store_sales.ss_net_paid > Decimal128(Some(0),7,2) AND store_sales.ss_quantity > Int32(0)                                                                                                                                                                                                                                                                                                                                              |
|               |                                             TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_ticket_number, ss_quantity, ss_net_paid, ss_net_profit]                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                     SubqueryAlias: sr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                         TableScan: store_returns projection=[sr_item_sk, sr_ticket_number, sr_return_quantity, sr_return_amt]                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                               Projection: date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                   Filter: date_dim.d_year = Int32(2000) AND date_dim.d_moy = Int32(12)                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                     TableScan: date_dim projection=[d_date_sk, d_year, d_moy]                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| physical_plan | SortPreservingMergeExec: [channel@0 ASC NULLS LAST, return_rank@3 ASC NULLS LAST, currency_rank@4 ASC NULLS LAST, item@1 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                                               |
|               |   SortExec: TopK(fetch=100), expr=[channel@0 ASC NULLS LAST, return_rank@3 ASC NULLS LAST, currency_rank@4 ASC NULLS LAST, item@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                   |
|               |     AggregateExec: mode=FinalPartitioned, gby=[channel@0 as channel, item@1 as item, return_ratio@2 as return_ratio, return_rank@3 as return_rank, currency_rank@4 as currency_rank], aggr=[]                                                                                                                                                                                                                                                                                                                                                     |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |         RepartitionExec: partitioning=Hash([channel@0, item@1, return_ratio@2, return_rank@3, currency_rank@4], 4), input_partitions=12                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |           AggregateExec: mode=Partial, gby=[channel@0 as channel, item@1 as item, return_ratio@2 as return_ratio, return_rank@3 as return_rank, currency_rank@4 as currency_rank], aggr=[], ordering_mode=PartiallySorted([0, 4])                                                                                                                                                                                                                                                                                                                 |
|               |             UnionExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |               ProjectionExec: expr=[web as channel, item@0 as item, return_ratio@1 as return_ratio, return_rank@2 as return_rank, currency_rank@3 as currency_rank]                                                                                                                                                                                                                                                                                                                                                                               |
|               |                 ProjectionExec: expr=[item@0 as item, return_ratio@1 as return_ratio, rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@2 as return_rank, rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 as currency_rank]                                                                                                                                                                                                       |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                     FilterExec: rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@2 <= 10 OR rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 <= 10                                                                                                                                                                                                                                                                                |
|               |                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                         ProjectionExec: expr=[item@0 as item, return_ratio@1 as return_ratio, rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 as rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW, rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@4 as rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]         |
|               |                           BoundedWindowAggExec: wdw=[rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW: Ok(Field { name: "rank() ORDER BY [in_web.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW", data_type: UInt64, nullable: false, dict_id: 0, dict_is_ordered: false, metadata: {} }), frame: WindowFrame { units: Range, start_bound: Preceding(Decimal128(None,23,8)), end_bound: CurrentRow, is_causal: false }], mode=[Sorted]                  |
|               |                             SortExec: expr=[currency_ratio@2 ASC NULLS LAST], preserve_partitioning=[false]                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                               BoundedWindowAggExec: wdw=[rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW: Ok(Field { name: "rank() ORDER BY [in_web.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW", data_type: UInt64, nullable: false, dict_id: 0, dict_is_ordered: false, metadata: {} }), frame: WindowFrame { units: Range, start_bound: Preceding(Decimal128(None,23,8)), end_bound: CurrentRow, is_causal: false }], mode=[Sorted]                  |
|               |                                 SortPreservingMergeExec: [return_ratio@1 ASC NULLS LAST]                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                   SortExec: expr=[return_ratio@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     ProjectionExec: expr=[ws_item_sk@0 as item, CAST(sum(coalesce(wr.wr_return_quantity,Int64(0)))@1 AS Decimal128(15, 4)) / CAST(sum(coalesce(ws.ws_quantity,Int64(0)))@2 AS Decimal128(15, 4)) as return_ratio, CAST(sum(coalesce(wr.wr_return_amt,Int64(0)))@3 AS Decimal128(15, 4)) / CAST(sum(coalesce(ws.ws_net_paid,Int64(0)))@4 AS Decimal128(15, 4)) as currency_ratio]                                                                                                                                  |
|               |                                       AggregateExec: mode=FinalPartitioned, gby=[ws_item_sk@0 as ws_item_sk], aggr=[sum(coalesce(wr.wr_return_quantity,Int64(0))), sum(coalesce(ws.ws_quantity,Int64(0))), sum(coalesce(wr.wr_return_amt,Int64(0))), sum(coalesce(ws.ws_net_paid,Int64(0)))]                                                                                                                                                                                                                                                      |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                           RepartitionExec: partitioning=Hash([ws_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                             AggregateExec: mode=Partial, gby=[ws_item_sk@0 as ws_item_sk], aggr=[sum(coalesce(wr.wr_return_quantity,Int64(0))), sum(coalesce(ws.ws_quantity,Int64(0))), sum(coalesce(wr.wr_return_amt,Int64(0))), sum(coalesce(ws.ws_net_paid,Int64(0)))]                                                                                                                                                                                                                                                         |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_item_sk@1, ws_quantity@2, ws_net_paid@3, wr_return_quantity@4, wr_return_amt@5]                                                                                                                                                                                                                                                                                                            |
|               |                                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                     RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                         FilterExec: wr_return_amt@5 > Some(1000000),7,2                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                             HashJoinExec: mode=Partitioned, join_type=Left, on=[(ws_order_number@2, wr_order_number@1), (ws_item_sk@1, wr_item_sk@0)], projection=[ws_sold_date_sk@0, ws_item_sk@1, ws_quantity@3, ws_net_paid@4, wr_return_quantity@7, wr_return_amt@8]                                                                                                                                                                                                                                          |
|               |                                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                 RepartitionExec: partitioning=Hash([ws_order_number@2, ws_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                   ProjectionExec: expr=[ws_sold_date_sk@0 as ws_sold_date_sk, ws_item_sk@1 as ws_item_sk, ws_order_number@2 as ws_order_number, ws_quantity@3 as ws_quantity, ws_net_paid@4 as ws_net_paid]                                                                                                                                                                                                                                                                                       |
|               |                                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                                         FilterExec: ws_net_profit@5 > Some(100),7,2 AND ws_net_paid@4 > Some(0),7,2 AND ws_quantity@3 > 0                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                           SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                               MemoryExec: partitions=1, partition_sizes=[88]                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                 RepartitionExec: partitioning=Hash([wr_order_number@1, wr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                     SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                                         MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                     RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                       ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                             FilterExec: d_year@1 = 2000 AND d_moy@2 = 12                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                   MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |               ProjectionExec: expr=[catalog as channel, item@0 as item, return_ratio@1 as return_ratio, return_rank@2 as return_rank, currency_rank@3 as currency_rank]                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 ProjectionExec: expr=[item@0 as item, return_ratio@1 as return_ratio, rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@2 as return_rank, rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 as currency_rank]                                                                                                                                                                                                       |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                     FilterExec: rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@2 <= 10 OR rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 <= 10                                                                                                                                                                                                                                                                                |
|               |                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                         ProjectionExec: expr=[item@0 as item, return_ratio@1 as return_ratio, rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 as rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW, rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@4 as rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW]         |
|               |                           BoundedWindowAggExec: wdw=[rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW: Ok(Field { name: "rank() ORDER BY [in_cat.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW", data_type: UInt64, nullable: false, dict_id: 0, dict_is_ordered: false, metadata: {} }), frame: WindowFrame { units: Range, start_bound: Preceding(Decimal128(None,23,8)), end_bound: CurrentRow, is_causal: false }], mode=[Sorted]                  |
|               |                             SortExec: expr=[currency_ratio@2 ASC NULLS LAST], preserve_partitioning=[false]                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                               BoundedWindowAggExec: wdw=[rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW: Ok(Field { name: "rank() ORDER BY [in_cat.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW", data_type: UInt64, nullable: false, dict_id: 0, dict_is_ordered: false, metadata: {} }), frame: WindowFrame { units: Range, start_bound: Preceding(Decimal128(None,23,8)), end_bound: CurrentRow, is_causal: false }], mode=[Sorted]                  |
|               |                                 SortPreservingMergeExec: [return_ratio@1 ASC NULLS LAST]                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                   SortExec: expr=[return_ratio@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     ProjectionExec: expr=[cs_item_sk@0 as item, CAST(sum(coalesce(cr.cr_return_quantity,Int64(0)))@1 AS Decimal128(15, 4)) / CAST(sum(coalesce(cs.cs_quantity,Int64(0)))@2 AS Decimal128(15, 4)) as return_ratio, CAST(sum(coalesce(cr.cr_return_amount,Int64(0)))@3 AS Decimal128(15, 4)) / CAST(sum(coalesce(cs.cs_net_paid,Int64(0)))@4 AS Decimal128(15, 4)) as currency_ratio]                                                                                                                               |
|               |                                       AggregateExec: mode=FinalPartitioned, gby=[cs_item_sk@0 as cs_item_sk], aggr=[sum(coalesce(cr.cr_return_quantity,Int64(0))), sum(coalesce(cs.cs_quantity,Int64(0))), sum(coalesce(cr.cr_return_amount,Int64(0))), sum(coalesce(cs.cs_net_paid,Int64(0)))]                                                                                                                                                                                                                                                   |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                           RepartitionExec: partitioning=Hash([cs_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                             AggregateExec: mode=Partial, gby=[cs_item_sk@0 as cs_item_sk], aggr=[sum(coalesce(cr.cr_return_quantity,Int64(0))), sum(coalesce(cs.cs_quantity,Int64(0))), sum(coalesce(cr.cr_return_amount,Int64(0))), sum(coalesce(cs.cs_net_paid,Int64(0)))]                                                                                                                                                                                                                                                      |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_item_sk@1, cs_quantity@2, cs_net_paid@3, cr_return_quantity@4, cr_return_amount@5]                                                                                                                                                                                                                                                                                                         |
|               |                                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                     RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                         FilterExec: cr_return_amount@5 > Some(1000000),7,2                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                             HashJoinExec: mode=Partitioned, join_type=Left, on=[(cs_order_number@2, cr_order_number@1), (cs_item_sk@1, cr_item_sk@0)], projection=[cs_sold_date_sk@0, cs_item_sk@1, cs_quantity@3, cs_net_paid@4, cr_return_quantity@7, cr_return_amount@8]                                                                                                                                                                                                                                       |
|               |                                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                 RepartitionExec: partitioning=Hash([cs_order_number@2, cs_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                   ProjectionExec: expr=[cs_sold_date_sk@0 as cs_sold_date_sk, cs_item_sk@1 as cs_item_sk, cs_order_number@2 as cs_order_number, cs_quantity@3 as cs_quantity, cs_net_paid@4 as cs_net_paid]                                                                                                                                                                                                                                                                                       |
|               |                                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                                         FilterExec: cs_net_profit@5 > Some(100),7,2 AND cs_net_paid@4 > Some(0),7,2 AND cs_quantity@3 > 0                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                           SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                               MemoryExec: partitions=1, partition_sizes=[176]                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                 RepartitionExec: partitioning=Hash([cr_order_number@1, cr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                     SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                                         MemoryExec: partitions=1, partition_sizes=[18]                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                     RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                       ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                             FilterExec: d_year@1 = 2000 AND d_moy@2 = 12                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                   MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |               ProjectionExec: expr=[store as channel, item@0 as item, return_ratio@1 as return_ratio, return_rank@2 as return_rank, currency_rank@3 as currency_rank]                                                                                                                                                                                                                                                                                                                                                                             |
|               |                 ProjectionExec: expr=[item@0 as item, return_ratio@1 as return_ratio, rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@2 as return_rank, rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 as currency_rank]                                                                                                                                                                                                   |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                     FilterExec: rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@2 <= 10 OR rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 <= 10                                                                                                                                                                                                                                                                            |
|               |                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                         ProjectionExec: expr=[item@0 as item, return_ratio@1 as return_ratio, rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@3 as rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW, rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW@4 as rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW] |
|               |                           BoundedWindowAggExec: wdw=[rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW: Ok(Field { name: "rank() ORDER BY [in_store.currency_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW", data_type: UInt64, nullable: false, dict_id: 0, dict_is_ordered: false, metadata: {} }), frame: WindowFrame { units: Range, start_bound: Preceding(Decimal128(None,23,8)), end_bound: CurrentRow, is_causal: false }], mode=[Sorted]              |
|               |                             SortExec: expr=[currency_ratio@2 ASC NULLS LAST], preserve_partitioning=[false]                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                               BoundedWindowAggExec: wdw=[rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW: Ok(Field { name: "rank() ORDER BY [in_store.return_ratio ASC NULLS LAST] RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW", data_type: UInt64, nullable: false, dict_id: 0, dict_is_ordered: false, metadata: {} }), frame: WindowFrame { units: Range, start_bound: Preceding(Decimal128(None,23,8)), end_bound: CurrentRow, is_causal: false }], mode=[Sorted]              |
|               |                                 SortPreservingMergeExec: [return_ratio@1 ASC NULLS LAST]                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                   SortExec: expr=[return_ratio@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     ProjectionExec: expr=[ss_item_sk@0 as item, CAST(sum(coalesce(sr.sr_return_quantity,Int64(0)))@1 AS Decimal128(15, 4)) / CAST(sum(coalesce(sts.ss_quantity,Int64(0)))@2 AS Decimal128(15, 4)) as return_ratio, CAST(sum(coalesce(sr.sr_return_amt,Int64(0)))@3 AS Decimal128(15, 4)) / CAST(sum(coalesce(sts.ss_net_paid,Int64(0)))@4 AS Decimal128(15, 4)) as currency_ratio]                                                                                                                                |
|               |                                       AggregateExec: mode=FinalPartitioned, gby=[ss_item_sk@0 as ss_item_sk], aggr=[sum(coalesce(sr.sr_return_quantity,Int64(0))), sum(coalesce(sts.ss_quantity,Int64(0))), sum(coalesce(sr.sr_return_amt,Int64(0))), sum(coalesce(sts.ss_net_paid,Int64(0)))]                                                                                                                                                                                                                                                    |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                           RepartitionExec: partitioning=Hash([ss_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                             AggregateExec: mode=Partial, gby=[ss_item_sk@0 as ss_item_sk], aggr=[sum(coalesce(sr.sr_return_quantity,Int64(0))), sum(coalesce(sts.ss_quantity,Int64(0))), sum(coalesce(sr.sr_return_amt,Int64(0))), sum(coalesce(sts.ss_net_paid,Int64(0)))]                                                                                                                                                                                                                                                       |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_quantity@2, ss_net_paid@3, sr_return_quantity@4, sr_return_amt@5]                                                                                                                                                                                                                                                                                                            |
|               |                                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                     RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                         FilterExec: sr_return_amt@5 > Some(1000000),7,2                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                             HashJoinExec: mode=Partitioned, join_type=Left, on=[(ss_ticket_number@2, sr_ticket_number@1), (ss_item_sk@1, sr_item_sk@0)], projection=[ss_sold_date_sk@0, ss_item_sk@1, ss_quantity@3, ss_net_paid@4, sr_return_quantity@7, sr_return_amt@8]                                                                                                                                                                                                                                        |
|               |                                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                 RepartitionExec: partitioning=Hash([ss_ticket_number@2, ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                                   ProjectionExec: expr=[ss_sold_date_sk@0 as ss_sold_date_sk, ss_item_sk@1 as ss_item_sk, ss_ticket_number@2 as ss_ticket_number, ss_quantity@3 as ss_quantity, ss_net_paid@4 as ss_net_paid]                                                                                                                                                                                                                                                                                     |
|               |                                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                                         FilterExec: ss_net_profit@5 > Some(100),7,2 AND ss_net_paid@4 > Some(0),7,2 AND ss_quantity@3 > 0                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                           SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                               MemoryExec: partitions=1, partition_sizes=[352]                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                                 RepartitionExec: partitioning=Hash([sr_ticket_number@1, sr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                     SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                                         MemoryExec: partitions=1, partition_sizes=[36]                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                     RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                       ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                             FilterExec: d_year@1 = 2000 AND d_moy@2 = 12                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                   MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
