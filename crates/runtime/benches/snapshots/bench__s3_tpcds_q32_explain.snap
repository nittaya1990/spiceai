---
source: crates/runtime/benches/bench.rs
description: "Query: select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\ni_manufact_id = 283\nand i_item_sk = cs_item_sk\nand d_date between '1999-02-22' and\n        (cast('1999-02-22' as date) + INTERVAL '90 days')\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '1999-02-22' and\n                             (cast('1999-02-22' as date) + INTERVAL '90 days')\n          and d_date_sk = cs_sold_date_sk\n      )\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: sum(catalog_sales.cs_ext_discount_amt) AS excess discount amount                                                                                                                                                                                                                                                                                                                                                                            |
|               |   Limit: skip=0, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |     Aggregate: groupBy=[[]], aggr=[[sum(catalog_sales.cs_ext_discount_amt)]]                                                                                                                                                                                                                                                                                                                                                                            |
|               |       Projection: catalog_sales.cs_ext_discount_amt                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |         Inner Join: item.i_item_sk = __scalar_sq_1.cs_item_sk Filter: CAST(catalog_sales.cs_ext_discount_amt AS Decimal128(30, 15)) > __scalar_sq_1.Float64(1.3) * avg(catalog_sales.cs_ext_discount_amt)                                                                                                                                                                                                                                               |
|               |           Projection: catalog_sales.cs_ext_discount_amt, item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                 |
|               |             Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                              |
|               |               Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_ext_discount_amt, item.i_item_sk                                                                                                                                                                                                                                                                                                                                              |
|               |                 Inner Join: catalog_sales.cs_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                     TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_ext_discount_amt]                                                                                                                                                                                                                                                                                                                                              |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                     TableScan: item projection=[i_item_sk], full_filters=[item.i_manufact_id = Int32(283)]                                                                                                                                                                                                                                                                                                                                              |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                 TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_date >= Date32("1999-02-22"), date_dim.d_date <= Date32("1999-05-23")]                                                                                                                                                                                                                                                                                             |
|               |           SubqueryAlias: __scalar_sq_1                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |             Projection: CAST(Float64(1.3) * CAST(avg(catalog_sales.cs_ext_discount_amt) AS Float64) AS Decimal128(30, 15)), catalog_sales.cs_item_sk                                                                                                                                                                                                                                                                                                    |
|               |               Aggregate: groupBy=[[catalog_sales.cs_item_sk]], aggr=[[avg(catalog_sales.cs_ext_discount_amt)]]                                                                                                                                                                                                                                                                                                                                          |
|               |                 Projection: catalog_sales.cs_item_sk, catalog_sales.cs_ext_discount_amt                                                                                                                                                                                                                                                                                                                                                                 |
|               |                   Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                        |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                       TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_ext_discount_amt]                                                                                                                                                                                                                                                                                                                                            |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                       TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_date >= Date32("1999-02-22"), date_dim.d_date <= Date32("1999-05-23")]                                                                                                                                                                                                                                                                                       |
| physical_plan | ProjectionExec: expr=[sum(catalog_sales.cs_ext_discount_amt)@0 as excess discount amount]                                                                                                                                                                                                                                                                                                                                                               |
|               |   GlobalLimitExec: skip=0, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |     AggregateExec: mode=Final, gby=[], aggr=[sum(catalog_sales.cs_ext_discount_amt)]                                                                                                                                                                                                                                                                                                                                                                    |
|               |       CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |         AggregateExec: mode=Partial, gby=[], aggr=[sum(catalog_sales.cs_ext_discount_amt)]                                                                                                                                                                                                                                                                                                                                                              |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(i_item_sk@1, cs_item_sk@1)], filter=CAST(cs_ext_discount_amt@0 AS Decimal128(30, 15)) > Float64(1.3) * avg(catalog_sales.cs_ext_discount_amt)@1, projection=[cs_ext_discount_amt@0]                                                                                                                                                                                                   |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                 RepartitionExec: partitioning=Hash([i_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_ext_discount_amt@1, i_item_sk@2]                                                                                                                                                                                                                                                                                             |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                         RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                  |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_item_sk@1, i_item_sk@0)], projection=[cs_sold_date_sk@0, cs_ext_discount_amt@2, i_item_sk@3]                                                                                                                                                                                                                                                                       |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                 RepartitionExec: partitioning=Hash([cs_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                               |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_item_sk, cs_ext_discount_amt]                                      |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                 RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk], predicate=i_manufact_id@13 = 283, pruning_predicate=CASE WHEN i_manufact_id_null_count@2 = i_manufact_id_row_count@3 THEN false ELSE i_manufact_id_min@0 <= 283 AND 283 <= i_manufact_id_max@1 END, required_guarantees=[N]                                                                     |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                         RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                        |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                          |
|               |                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                               ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_date@2 >= 1999-02-22 AND d_date@2 <= 1999-05-23, pruning_predicate=CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_max@0 >= 1999-02-22 END AND CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_min@3 <= 1999-05-23 END, required_guarantees=[N]       |
|               |               ProjectionExec: expr=[CAST(1.3 * CAST(avg(catalog_sales.cs_ext_discount_amt)@1 AS Float64) AS Decimal128(30, 15)) as Float64(1.3) * avg(catalog_sales.cs_ext_discount_amt), cs_item_sk@0 as cs_item_sk]                                                                                                                                                                                                                                   |
|               |                 AggregateExec: mode=FinalPartitioned, gby=[cs_item_sk@0 as cs_item_sk], aggr=[avg(catalog_sales.cs_ext_discount_amt)]                                                                                                                                                                                                                                                                                                                   |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     RepartitionExec: partitioning=Hash([cs_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                           |
|               |                       AggregateExec: mode=Partial, gby=[cs_item_sk@0 as cs_item_sk], aggr=[avg(catalog_sales.cs_ext_discount_amt)]                                                                                                                                                                                                                                                                                                                      |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_item_sk@1, cs_ext_discount_amt@2]                                                                                                                                                                                                                                                                                      |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                               RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                            |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                   ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_item_sk, cs_ext_discount_amt]                                        |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                               RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                    |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_date@2 >= 1999-02-22 AND d_date@2 <= 1999-05-23, pruning_predicate=CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_max@0 >= 1999-02-22 END AND CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_min@3 <= 1999-05-23 END, required_guarantees=[N] |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
