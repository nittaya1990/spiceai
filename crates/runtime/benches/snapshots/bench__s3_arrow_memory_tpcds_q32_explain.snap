---
source: crates/runtime/benches/bench.rs
description: "Query: select  sum(cs_ext_discount_amt)  as \"excess discount amount\"\nfrom\n   catalog_sales\n   ,item\n   ,date_dim\nwhere\ni_manufact_id = 283\nand i_item_sk = cs_item_sk\nand d_date between '1999-02-22' and\n        (cast('1999-02-22' as date) + INTERVAL '90 days')\nand d_date_sk = cs_sold_date_sk\nand cs_ext_discount_amt\n     > (\n         select\n            1.3 * avg(cs_ext_discount_amt)\n         from\n            catalog_sales\n           ,date_dim\n         where\n              cs_item_sk = i_item_sk\n          and d_date between '1999-02-22' and\n                             (cast('1999-02-22' as date) + INTERVAL '90 days')\n          and d_date_sk = cs_sold_date_sk\n      )\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                  |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: sum(catalog_sales.cs_ext_discount_amt) AS excess discount amount                                                                                                                                                                          |
|               |   Limit: skip=0, fetch=100                                                                                                                                                                                                                            |
|               |     Aggregate: groupBy=[[]], aggr=[[sum(catalog_sales.cs_ext_discount_amt)]]                                                                                                                                                                          |
|               |       Projection: catalog_sales.cs_ext_discount_amt                                                                                                                                                                                                   |
|               |         Inner Join: item.i_item_sk = __scalar_sq_1.cs_item_sk Filter: CAST(catalog_sales.cs_ext_discount_amt AS Decimal128(30, 15)) > __scalar_sq_1.Float64(1.3) * avg(catalog_sales.cs_ext_discount_amt)                                             |
|               |           Projection: catalog_sales.cs_ext_discount_amt, item.i_item_sk                                                                                                                                                                               |
|               |             Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                            |
|               |               Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_ext_discount_amt, item.i_item_sk                                                                                                                                            |
|               |                 Inner Join: catalog_sales.cs_item_sk = item.i_item_sk                                                                                                                                                                                 |
|               |                   BytesProcessedNode                                                                                                                                                                                                                  |
|               |                     TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_ext_discount_amt]                                                                                                                                            |
|               |                   Projection: item.i_item_sk                                                                                                                                                                                                          |
|               |                     BytesProcessedNode                                                                                                                                                                                                                |
|               |                       Filter: item.i_manufact_id = Int32(283)                                                                                                                                                                                         |
|               |                         TableScan: item projection=[i_item_sk, i_manufact_id]                                                                                                                                                                         |
|               |               Projection: date_dim.d_date_sk                                                                                                                                                                                                          |
|               |                 BytesProcessedNode                                                                                                                                                                                                                    |
|               |                   Filter: date_dim.d_date >= Date32("1999-02-22") AND date_dim.d_date <= Date32("1999-05-23")                                                                                                                                         |
|               |                     TableScan: date_dim projection=[d_date_sk, d_date]                                                                                                                                                                                |
|               |           SubqueryAlias: __scalar_sq_1                                                                                                                                                                                                                |
|               |             Projection: CAST(Float64(1.3) * CAST(avg(catalog_sales.cs_ext_discount_amt) AS Float64) AS Decimal128(30, 15)), catalog_sales.cs_item_sk                                                                                                  |
|               |               Aggregate: groupBy=[[catalog_sales.cs_item_sk]], aggr=[[avg(catalog_sales.cs_ext_discount_amt)]]                                                                                                                                        |
|               |                 Projection: catalog_sales.cs_item_sk, catalog_sales.cs_ext_discount_amt                                                                                                                                                               |
|               |                   Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                      |
|               |                     BytesProcessedNode                                                                                                                                                                                                                |
|               |                       TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_ext_discount_amt]                                                                                                                                          |
|               |                     Projection: date_dim.d_date_sk                                                                                                                                                                                                    |
|               |                       BytesProcessedNode                                                                                                                                                                                                              |
|               |                         Filter: date_dim.d_date >= Date32("1999-02-22") AND date_dim.d_date <= Date32("1999-05-23")                                                                                                                                   |
|               |                           TableScan: date_dim projection=[d_date_sk, d_date]                                                                                                                                                                          |
| physical_plan | ProjectionExec: expr=[sum(catalog_sales.cs_ext_discount_amt)@0 as excess discount amount]                                                                                                                                                             |
|               |   GlobalLimitExec: skip=0, fetch=100                                                                                                                                                                                                                  |
|               |     AggregateExec: mode=Final, gby=[], aggr=[sum(catalog_sales.cs_ext_discount_amt)]                                                                                                                                                                  |
|               |       CoalescePartitionsExec                                                                                                                                                                                                                          |
|               |         AggregateExec: mode=Partial, gby=[], aggr=[sum(catalog_sales.cs_ext_discount_amt)]                                                                                                                                                            |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                 |
|               |             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(i_item_sk@1, cs_item_sk@1)], filter=CAST(cs_ext_discount_amt@0 AS Decimal128(30, 15)) > Float64(1.3) * avg(catalog_sales.cs_ext_discount_amt)@1, projection=[cs_ext_discount_amt@0] |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                             |
|               |                 RepartitionExec: partitioning=Hash([i_item_sk@1], 4), input_partitions=4                                                                                                                                                              |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                         |
|               |                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_ext_discount_amt@1, i_item_sk@2]                                                                                           |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                     |
|               |                         RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                 |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_item_sk@1, i_item_sk@0)], projection=[cs_sold_date_sk@0, cs_ext_discount_amt@2, i_item_sk@3]                                                                     |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                             |
|               |                                 RepartitionExec: partitioning=Hash([cs_item_sk@1], 4), input_partitions=4                                                                                                                                             |
|               |                                   BytesProcessedExec                                                                                                                                                                                                  |
|               |                                     SchemaCastScanExec                                                                                                                                                                                                |
|               |                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                            |
|               |                                         MemoryExec: partitions=1, partition_sizes=[176]                                                                                                                                                               |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                             |
|               |                                 RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                              |
|               |                                   ProjectionExec: expr=[i_item_sk@0 as i_item_sk]                                                                                                                                                                     |
|               |                                     BytesProcessedExec                                                                                                                                                                                                |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                     |
|               |                                         FilterExec: i_manufact_id@1 = 283                                                                                                                                                                             |
|               |                                           SchemaCastScanExec                                                                                                                                                                                          |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                      |
|               |                                               MemoryExec: partitions=1, partition_sizes=[3]                                                                                                                                                           |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                     |
|               |                         RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                      |
|               |                           ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                             |
|               |                             BytesProcessedExec                                                                                                                                                                                                        |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                             |
|               |                                 FilterExec: d_date@1 >= 1999-02-22 AND d_date@1 <= 1999-05-23                                                                                                                                                         |
|               |                                   SchemaCastScanExec                                                                                                                                                                                                  |
|               |                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                              |
|               |                                       MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                   |
|               |               ProjectionExec: expr=[CAST(1.3 * CAST(avg(catalog_sales.cs_ext_discount_amt)@1 AS Float64) AS Decimal128(30, 15)) as Float64(1.3) * avg(catalog_sales.cs_ext_discount_amt), cs_item_sk@0 as cs_item_sk]                                 |
|               |                 AggregateExec: mode=FinalPartitioned, gby=[cs_item_sk@0 as cs_item_sk], aggr=[avg(catalog_sales.cs_ext_discount_amt)]                                                                                                                 |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                         |
|               |                     RepartitionExec: partitioning=Hash([cs_item_sk@0], 4), input_partitions=4                                                                                                                                                         |
|               |                       AggregateExec: mode=Partial, gby=[cs_item_sk@0 as cs_item_sk], aggr=[avg(catalog_sales.cs_ext_discount_amt)]                                                                                                                    |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                   |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_item_sk@1, cs_ext_discount_amt@2]                                                                                    |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                               |
|               |                               RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                          |
|               |                                 BytesProcessedExec                                                                                                                                                                                                    |
|               |                                   SchemaCastScanExec                                                                                                                                                                                                  |
|               |                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                              |
|               |                                       MemoryExec: partitions=1, partition_sizes=[176]                                                                                                                                                                 |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                               |
|               |                               RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                |
|               |                                 ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                       |
|               |                                   BytesProcessedExec                                                                                                                                                                                                  |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                       |
|               |                                       FilterExec: d_date@1 >= 1999-02-22 AND d_date@1 <= 1999-05-23                                                                                                                                                   |
|               |                                         SchemaCastScanExec                                                                                                                                                                                            |
|               |                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                        |
|               |                                             MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                             |
|               |                                                                                                                                                                                                                                                       |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
