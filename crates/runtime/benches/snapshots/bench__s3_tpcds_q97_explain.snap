---
source: crates/runtime/benches/bench.rs
description: "Query: with ssci as (\nselect ss_customer_sk customer_sk\n      ,ss_item_sk item_sk\nfrom store_sales,date_dim\nwhere ss_sold_date_sk = d_date_sk\n  and d_month_seq between 1211 and 1211 + 11\ngroup by ss_customer_sk\n        ,ss_item_sk),\ncsci as(\n select cs_bill_customer_sk customer_sk\n      ,cs_item_sk item_sk\nfrom catalog_sales,date_dim\nwhere cs_sold_date_sk = d_date_sk\n  and d_month_seq between 1211 and 1211 + 11\ngroup by cs_bill_customer_sk\n        ,cs_item_sk)\n select  sum(case when ssci.customer_sk is not null and csci.customer_sk is null then 1 else 0 end) store_only\n      ,sum(case when ssci.customer_sk is null and csci.customer_sk is not null then 1 else 0 end) catalog_only\n      ,sum(case when ssci.customer_sk is not null and csci.customer_sk is not null then 1 else 0 end) store_and_catalog\nfrom ssci full outer join csci on (ssci.customer_sk=csci.customer_sk\n                               and ssci.item_sk = csci.item_sk)\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NULL THEN Int64(1) ELSE Int64(0) END) AS store_only, sum(CASE WHEN ssci.customer_sk IS NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END) AS catalog_only, sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END) AS store_and_catalog                                                                           |
|               |   Limit: skip=0, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |     Aggregate: groupBy=[[]], aggr=[[sum(CASE WHEN __common_expr_1 AS ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NULL THEN Int64(1) ELSE Int64(0) END), sum(CASE WHEN ssci.customer_sk IS NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END), sum(CASE WHEN __common_expr_1 AS ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END)]]                                                              |
|               |       Projection: ssci.customer_sk IS NOT NULL AS __common_expr_1, ssci.customer_sk, csci.customer_sk                                                                                                                                                                                                                                                                                                                                                                     |
|               |         Full Join: ssci.customer_sk = csci.customer_sk, ssci.item_sk = csci.item_sk                                                                                                                                                                                                                                                                                                                                                                                       |
|               |           SubqueryAlias: ssci                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |             Projection: store_sales.ss_customer_sk AS customer_sk, store_sales.ss_item_sk AS item_sk                                                                                                                                                                                                                                                                                                                                                                      |
|               |               Aggregate: groupBy=[[store_sales.ss_customer_sk, store_sales.ss_item_sk]], aggr=[[]]                                                                                                                                                                                                                                                                                                                                                                        |
|               |                 Projection: store_sales.ss_item_sk, store_sales.ss_customer_sk                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                   Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_customer_sk]                                                                                                                                                                                                                                                                                                                                                                     |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_month_seq >= Int32(1211), date_dim.d_month_seq <= Int32(1222)]                                                                                                                                                                                                                                                                                                                 |
|               |           SubqueryAlias: csci                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |             Projection: catalog_sales.cs_bill_customer_sk AS customer_sk, catalog_sales.cs_item_sk AS item_sk                                                                                                                                                                                                                                                                                                                                                             |
|               |               Aggregate: groupBy=[[catalog_sales.cs_bill_customer_sk, catalog_sales.cs_item_sk]], aggr=[[]]                                                                                                                                                                                                                                                                                                                                                               |
|               |                 Projection: catalog_sales.cs_bill_customer_sk, catalog_sales.cs_item_sk                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                   Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       TableScan: catalog_sales projection=[cs_sold_date_sk, cs_bill_customer_sk, cs_item_sk]                                                                                                                                                                                                                                                                                                                                                              |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_month_seq >= Int32(1211), date_dim.d_month_seq <= Int32(1222)]                                                                                                                                                                                                                                                                                                                 |
| physical_plan | ProjectionExec: expr=[sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NULL THEN Int64(1) ELSE Int64(0) END)@0 as store_only, sum(CASE WHEN ssci.customer_sk IS NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END)@1 as catalog_only, sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END)@2 as store_and_catalog]                                                          |
|               |   GlobalLimitExec: skip=0, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |     AggregateExec: mode=Final, gby=[], aggr=[sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NULL THEN Int64(1) ELSE Int64(0) END), sum(CASE WHEN ssci.customer_sk IS NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END), sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END)]                                                                                            |
|               |       CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |         AggregateExec: mode=Partial, gby=[], aggr=[sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NULL THEN Int64(1) ELSE Int64(0) END), sum(CASE WHEN ssci.customer_sk IS NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END), sum(CASE WHEN ssci.customer_sk IS NOT NULL AND csci.customer_sk IS NOT NULL THEN Int64(1) ELSE Int64(0) END)]                                                                                      |
|               |           ProjectionExec: expr=[customer_sk@0 IS NOT NULL as __common_expr_1, customer_sk@0 as customer_sk, customer_sk@1 as customer_sk]                                                                                                                                                                                                                                                                                                                                 |
|               |             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |               HashJoinExec: mode=Partitioned, join_type=Full, on=[(customer_sk@0, customer_sk@0), (item_sk@1, item_sk@1)], projection=[customer_sk@0, customer_sk@2]                                                                                                                                                                                                                                                                                                      |
|               |                 ProjectionExec: expr=[ss_customer_sk@0 as customer_sk, ss_item_sk@1 as item_sk]                                                                                                                                                                                                                                                                                                                                                                           |
|               |                   AggregateExec: mode=FinalPartitioned, gby=[ss_customer_sk@0 as ss_customer_sk, ss_item_sk@1 as ss_item_sk], aggr=[]                                                                                                                                                                                                                                                                                                                                     |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                       RepartitionExec: partitioning=Hash([ss_customer_sk@0, ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                         |
|               |                         AggregateExec: mode=Partial, gby=[ss_customer_sk@1 as ss_customer_sk, ss_item_sk@0 as ss_item_sk], aggr=[]                                                                                                                                                                                                                                                                                                                                        |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_customer_sk@2]                                                                                                                                                                                                                                                                                                           |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                            |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_item_sk, ss_customer_sk]                                                                           |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_month_seq@3 >= 1211 AND d_month_seq@3 <= 1222, pruning_predicate=CASE WHEN d_month_seq_null_count@1 = d_month_seq_row_count@2 THEN false ELSE d_month_seq_max@0 >= 1211 END AND CASE WHEN d_month_seq_null_count@1 = d_month_seq_row_count@2 THEN false ELSE d_month_seq_min@3 <= 1222 END, required_guarantees=[N] |
|               |                 ProjectionExec: expr=[cs_bill_customer_sk@0 as customer_sk, cs_item_sk@1 as item_sk]                                                                                                                                                                                                                                                                                                                                                                      |
|               |                   AggregateExec: mode=FinalPartitioned, gby=[cs_bill_customer_sk@0 as cs_bill_customer_sk, cs_item_sk@1 as cs_item_sk], aggr=[]                                                                                                                                                                                                                                                                                                                           |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                       RepartitionExec: partitioning=Hash([cs_bill_customer_sk@0, cs_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                    |
|               |                         AggregateExec: mode=Partial, gby=[cs_bill_customer_sk@0 as cs_bill_customer_sk, cs_item_sk@1 as cs_item_sk], aggr=[]                                                                                                                                                                                                                                                                                                                              |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_bill_customer_sk@1, cs_item_sk@2]                                                                                                                                                                                                                                                                                                      |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                            |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_bill_customer_sk, cs_item_sk]                                                        |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_month_seq@3 >= 1211 AND d_month_seq@3 <= 1222, pruning_predicate=CASE WHEN d_month_seq_null_count@1 = d_month_seq_row_count@2 THEN false ELSE d_month_seq_max@0 >= 1211 END AND CASE WHEN d_month_seq_null_count@1 = d_month_seq_row_count@2 THEN false ELSE d_month_seq_min@3 <= 1222 END, required_guarantees=[N] |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
