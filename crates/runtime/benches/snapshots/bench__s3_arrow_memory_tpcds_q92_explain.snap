---
source: crates/runtime/benches/bench.rs
description: "Query: select\n   sum(ws_ext_discount_amt)  as \"Excess Discount Amount\"\nfrom\n    web_sales\n   ,item\n   ,date_dim\nwhere\ni_manufact_id = 914\nand i_item_sk = ws_item_sk\nand d_date between '2001-01-25' and\n        (cast('2001-01-25' as date) + INTERVAL '90 days')\nand d_date_sk = ws_sold_date_sk\nand ws_ext_discount_amt\n     > (\n         SELECT\n            1.3 * avg(ws_ext_discount_amt)\n         FROM\n            web_sales\n           ,date_dim\n         WHERE\n              ws_item_sk = i_item_sk\n          and d_date between '2001-01-25' and\n                             (cast('2001-01-25' as date) + INTERVAL '90 days')\n          and d_date_sk = ws_sold_date_sk\n      )\norder by sum(ws_ext_discount_amt)\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: Excess Discount Amount                                                                                                                                                                                                                  |
|               |   Sort: sum(web_sales.ws_ext_discount_amt) AS Excess Discount Amount ASC NULLS LAST, fetch=100                                                                                                                                                      |
|               |     Projection: sum(web_sales.ws_ext_discount_amt) AS Excess Discount Amount, sum(web_sales.ws_ext_discount_amt)                                                                                                                                    |
|               |       Aggregate: groupBy=[[]], aggr=[[sum(web_sales.ws_ext_discount_amt)]]                                                                                                                                                                          |
|               |         Projection: web_sales.ws_ext_discount_amt                                                                                                                                                                                                   |
|               |           Inner Join: item.i_item_sk = __scalar_sq_1.ws_item_sk Filter: CAST(web_sales.ws_ext_discount_amt AS Decimal128(30, 15)) > __scalar_sq_1.Float64(1.3) * avg(web_sales.ws_ext_discount_amt)                                                 |
|               |             Projection: web_sales.ws_ext_discount_amt, item.i_item_sk                                                                                                                                                                               |
|               |               Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                            |
|               |                 Projection: web_sales.ws_sold_date_sk, web_sales.ws_ext_discount_amt, item.i_item_sk                                                                                                                                                |
|               |                   Inner Join: web_sales.ws_item_sk = item.i_item_sk                                                                                                                                                                                 |
|               |                     BytesProcessedNode                                                                                                                                                                                                              |
|               |                       TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_ext_discount_amt]                                                                                                                                            |
|               |                     Projection: item.i_item_sk                                                                                                                                                                                                      |
|               |                       BytesProcessedNode                                                                                                                                                                                                            |
|               |                         Filter: item.i_manufact_id = Int32(914)                                                                                                                                                                                     |
|               |                           TableScan: item projection=[i_item_sk, i_manufact_id]                                                                                                                                                                     |
|               |                 Projection: date_dim.d_date_sk                                                                                                                                                                                                      |
|               |                   BytesProcessedNode                                                                                                                                                                                                                |
|               |                     Filter: date_dim.d_date >= Date32("2001-01-25") AND date_dim.d_date <= Date32("2001-04-25")                                                                                                                                     |
|               |                       TableScan: date_dim projection=[d_date_sk, d_date]                                                                                                                                                                            |
|               |             SubqueryAlias: __scalar_sq_1                                                                                                                                                                                                            |
|               |               Projection: CAST(Float64(1.3) * CAST(avg(web_sales.ws_ext_discount_amt) AS Float64) AS Decimal128(30, 15)), web_sales.ws_item_sk                                                                                                      |
|               |                 Aggregate: groupBy=[[web_sales.ws_item_sk]], aggr=[[avg(web_sales.ws_ext_discount_amt)]]                                                                                                                                            |
|               |                   Projection: web_sales.ws_item_sk, web_sales.ws_ext_discount_amt                                                                                                                                                                   |
|               |                     Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                      |
|               |                       BytesProcessedNode                                                                                                                                                                                                            |
|               |                         TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_ext_discount_amt]                                                                                                                                          |
|               |                       Projection: date_dim.d_date_sk                                                                                                                                                                                                |
|               |                         BytesProcessedNode                                                                                                                                                                                                          |
|               |                           Filter: date_dim.d_date >= Date32("2001-01-25") AND date_dim.d_date <= Date32("2001-04-25")                                                                                                                               |
|               |                             TableScan: date_dim projection=[d_date_sk, d_date]                                                                                                                                                                      |
| physical_plan | ProjectionExec: expr=[Excess Discount Amount@0 as Excess Discount Amount]                                                                                                                                                                           |
|               |   SortExec: TopK(fetch=100), expr=[sum(web_sales.ws_ext_discount_amt)@1 ASC NULLS LAST], preserve_partitioning=[false]                                                                                                                              |
|               |     ProjectionExec: expr=[sum(web_sales.ws_ext_discount_amt)@0 as Excess Discount Amount, sum(web_sales.ws_ext_discount_amt)@0 as sum(web_sales.ws_ext_discount_amt)]                                                                               |
|               |       AggregateExec: mode=Final, gby=[], aggr=[sum(web_sales.ws_ext_discount_amt)]                                                                                                                                                                  |
|               |         CoalescePartitionsExec                                                                                                                                                                                                                      |
|               |           AggregateExec: mode=Partial, gby=[], aggr=[sum(web_sales.ws_ext_discount_amt)]                                                                                                                                                            |
|               |             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                             |
|               |               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(i_item_sk@1, ws_item_sk@1)], filter=CAST(ws_ext_discount_amt@0 AS Decimal128(30, 15)) > Float64(1.3) * avg(web_sales.ws_ext_discount_amt)@1, projection=[ws_ext_discount_amt@0] |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                         |
|               |                   RepartitionExec: partitioning=Hash([i_item_sk@1], 4), input_partitions=4                                                                                                                                                          |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                     |
|               |                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_ext_discount_amt@1, i_item_sk@2]                                                                                       |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                 |
|               |                           RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                            |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                             |
|               |                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_item_sk@1, i_item_sk@0)], projection=[ws_sold_date_sk@0, ws_ext_discount_amt@2, i_item_sk@3]                                                                 |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                         |
|               |                                   RepartitionExec: partitioning=Hash([ws_item_sk@1], 4), input_partitions=4                                                                                                                                         |
|               |                                     BytesProcessedExec                                                                                                                                                                                              |
|               |                                       SchemaCastScanExec                                                                                                                                                                                            |
|               |                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                        |
|               |                                           MemoryExec: partitions=1, partition_sizes=[88]                                                                                                                                                            |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                         |
|               |                                   RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                          |
|               |                                     ProjectionExec: expr=[i_item_sk@0 as i_item_sk]                                                                                                                                                                 |
|               |                                       BytesProcessedExec                                                                                                                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                 |
|               |                                           FilterExec: i_manufact_id@1 = 914                                                                                                                                                                         |
|               |                                             SchemaCastScanExec                                                                                                                                                                                      |
|               |                                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                  |
|               |                                                 MemoryExec: partitions=1, partition_sizes=[3]                                                                                                                                                       |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                 |
|               |                           RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                  |
|               |                             ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                         |
|               |                               BytesProcessedExec                                                                                                                                                                                                    |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                         |
|               |                                   FilterExec: d_date@1 >= 2001-01-25 AND d_date@1 <= 2001-04-25                                                                                                                                                     |
|               |                                     SchemaCastScanExec                                                                                                                                                                                              |
|               |                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                          |
|               |                                         MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                               |
|               |                 ProjectionExec: expr=[CAST(1.3 * CAST(avg(web_sales.ws_ext_discount_amt)@1 AS Float64) AS Decimal128(30, 15)) as Float64(1.3) * avg(web_sales.ws_ext_discount_amt), ws_item_sk@0 as ws_item_sk]                                     |
|               |                   AggregateExec: mode=FinalPartitioned, gby=[ws_item_sk@0 as ws_item_sk], aggr=[avg(web_sales.ws_ext_discount_amt)]                                                                                                                 |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                     |
|               |                       RepartitionExec: partitioning=Hash([ws_item_sk@0], 4), input_partitions=4                                                                                                                                                     |
|               |                         AggregateExec: mode=Partial, gby=[ws_item_sk@0 as ws_item_sk], aggr=[avg(web_sales.ws_ext_discount_amt)]                                                                                                                    |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                               |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_item_sk@1, ws_ext_discount_amt@2]                                                                                |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                           |
|               |                                 RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                      |
|               |                                   BytesProcessedExec                                                                                                                                                                                                |
|               |                                     SchemaCastScanExec                                                                                                                                                                                              |
|               |                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                          |
|               |                                         MemoryExec: partitions=1, partition_sizes=[88]                                                                                                                                                              |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                           |
|               |                                 RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                            |
|               |                                   ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                   |
|               |                                     BytesProcessedExec                                                                                                                                                                                              |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                   |
|               |                                         FilterExec: d_date@1 >= 2001-01-25 AND d_date@1 <= 2001-04-25                                                                                                                                               |
|               |                                           SchemaCastScanExec                                                                                                                                                                                        |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                    |
|               |                                               MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                         |
|               |                                                                                                                                                                                                                                                     |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
