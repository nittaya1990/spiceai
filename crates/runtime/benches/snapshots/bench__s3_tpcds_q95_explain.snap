---
source: crates/runtime/benches/bench.rs
description: "Query: with ws_wh as\n(select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2\n from web_sales ws1,web_sales ws2\n where ws1.ws_order_number = ws2.ws_order_number\n   and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)\n select\n   count(distinct ws_order_number) as \"order count\"\n  ,sum(ws_ext_ship_cost) as \"total shipping cost\"\n  ,sum(ws_net_profit) as \"total net profit\"\nfrom\n   web_sales ws1\n  ,date_dim\n  ,customer_address\n  ,web_site\nwhere\n    d_date between '2002-5-01' and\n           (cast('2002-5-01' as date) + INTERVAL '60 days')\nand ws1.ws_ship_date_sk = d_date_sk\nand ws1.ws_ship_addr_sk = ca_address_sk\nand ca_state = 'MA'\nand ws1.ws_web_site_sk = web_site_sk\nand web_company_name = 'pri'\nand ws1.ws_order_number in (select ws_order_number\n                            from ws_wh)\nand ws1.ws_order_number in (select wr_order_number\n                            from web_returns,ws_wh\n                            where wr_order_number = ws_wh.ws_order_number)\norder by count(distinct ws_order_number)\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: order count, total shipping cost, total net profit                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |   Sort: count(DISTINCT ws1.ws_order_number) AS order count ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                      |
|               |     Projection: count(DISTINCT ws1.ws_order_number) AS order count, sum(ws1.ws_ext_ship_cost) AS total shipping cost, sum(ws1.ws_net_profit) AS total net profit, count(DISTINCT ws1.ws_order_number)                                                                                                                                                                                                                                                                     |
|               |       Projection: count(alias1) AS count(DISTINCT ws1.ws_order_number), sum(alias2) AS sum(ws1.ws_ext_ship_cost), sum(alias3) AS sum(ws1.ws_net_profit)                                                                                                                                                                                                                                                                                                                   |
|               |         Aggregate: groupBy=[[]], aggr=[[count(alias1), sum(alias2), sum(alias3)]]                                                                                                                                                                                                                                                                                                                                                                                         |
|               |           Aggregate: groupBy=[[ws1.ws_order_number AS alias1]], aggr=[[sum(ws1.ws_ext_ship_cost) AS alias2, sum(ws1.ws_net_profit) AS alias3]]                                                                                                                                                                                                                                                                                                                            |
|               |             LeftSemi Join: ws1.ws_order_number = __correlated_sq_2.wr_order_number                                                                                                                                                                                                                                                                                                                                                                                        |
|               |               LeftSemi Join: ws1.ws_order_number = __correlated_sq_1.ws_order_number                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                 Projection: ws1.ws_order_number, ws1.ws_ext_ship_cost, ws1.ws_net_profit                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                   Inner Join: ws1.ws_web_site_sk = web_site.web_site_sk                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                     Projection: ws1.ws_web_site_sk, ws1.ws_order_number, ws1.ws_ext_ship_cost, ws1.ws_net_profit                                                                                                                                                                                                                                                                                                                                                          |
|               |                       Inner Join: ws1.ws_ship_addr_sk = customer_address.ca_address_sk                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                         Projection: ws1.ws_ship_addr_sk, ws1.ws_web_site_sk, ws1.ws_order_number, ws1.ws_ext_ship_cost, ws1.ws_net_profit                                                                                                                                                                                                                                                                                                                                 |
|               |                           Inner Join: ws1.ws_ship_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                             SubqueryAlias: ws1                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                 TableScan: web_sales projection=[ws_ship_date_sk, ws_ship_addr_sk, ws_web_site_sk, ws_order_number, ws_ext_ship_cost, ws_net_profit]                                                                                                                                                                                                                                                                                                      |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_date >= Date32("2002-05-01"), date_dim.d_date <= Date32("2002-06-30")]                                                                                                                                                                                                                                                                                                 |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: customer_address projection=[ca_address_sk], full_filters=[customer_address.ca_state = LargeUtf8("MA")]                                                                                                                                                                                                                                                                                                                              |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       TableScan: web_site projection=[web_site_sk], full_filters=[web_site.web_company_name = LargeUtf8("pri")]                                                                                                                                                                                                                                                                                                                                           |
|               |                 SubqueryAlias: __correlated_sq_1                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                   SubqueryAlias: ws_wh                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                     Projection: ws1.ws_order_number                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                       Inner Join: ws1.ws_order_number = ws2.ws_order_number Filter: ws2.ws_warehouse_sk != ws1.ws_warehouse_sk                                                                                                                                                                                                                                                                                                                                            |
|               |                         SubqueryAlias: ws1                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                             TableScan: web_sales projection=[ws_warehouse_sk, ws_order_number]                                                                                                                                                                                                                                                                                                                                                                            |
|               |                         SubqueryAlias: ws2                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                             TableScan: web_sales projection=[ws_warehouse_sk, ws_order_number]                                                                                                                                                                                                                                                                                                                                                                            |
|               |               SubqueryAlias: __correlated_sq_2                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                 Projection: web_returns.wr_order_number                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                   Inner Join: web_returns.wr_order_number = ws_wh.ws_order_number                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       TableScan: web_returns projection=[wr_order_number]                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                     SubqueryAlias: ws_wh                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                       Projection: ws1.ws_order_number                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                         Inner Join: ws1.ws_order_number = ws2.ws_order_number Filter: ws2.ws_warehouse_sk != ws1.ws_warehouse_sk                                                                                                                                                                                                                                                                                                                                          |
|               |                           SubqueryAlias: ws1                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: web_sales projection=[ws_warehouse_sk, ws_order_number]                                                                                                                                                                                                                                                                                                                                                                          |
|               |                           SubqueryAlias: ws2                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: web_sales projection=[ws_warehouse_sk, ws_order_number]                                                                                                                                                                                                                                                                                                                                                                          |
| physical_plan | ProjectionExec: expr=[order count@0 as order count, total shipping cost@1 as total shipping cost, total net profit@2 as total net profit]                                                                                                                                                                                                                                                                                                                                 |
|               |   SortExec: TopK(fetch=100), expr=[count(DISTINCT ws1.ws_order_number)@3 ASC NULLS LAST], preserve_partitioning=[false]                                                                                                                                                                                                                                                                                                                                                   |
|               |     ProjectionExec: expr=[count(alias1)@0 as order count, sum(alias2)@1 as total shipping cost, sum(alias3)@2 as total net profit, count(alias1)@0 as count(DISTINCT ws1.ws_order_number)]                                                                                                                                                                                                                                                                                |
|               |       AggregateExec: mode=Final, gby=[], aggr=[count(alias1), sum(alias2), sum(alias3)]                                                                                                                                                                                                                                                                                                                                                                                   |
|               |         CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |           AggregateExec: mode=Partial, gby=[], aggr=[count(alias1), sum(alias2), sum(alias3)]                                                                                                                                                                                                                                                                                                                                                                             |
|               |             AggregateExec: mode=SinglePartitioned, gby=[ws_order_number@0 as alias1], aggr=[alias2, alias3]                                                                                                                                                                                                                                                                                                                                                               |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 HashJoinExec: mode=Partitioned, join_type=LeftSemi, on=[(ws_order_number@0, wr_order_number@0)]                                                                                                                                                                                                                                                                                                                                                           |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                     HashJoinExec: mode=Partitioned, join_type=LeftSemi, on=[(ws_order_number@0, ws_order_number@0)]                                                                                                                                                                                                                                                                                                                                                       |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                         RepartitionExec: partitioning=Hash([ws_order_number@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                    |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_web_site_sk@0, web_site_sk@0)], projection=[ws_order_number@1, ws_ext_ship_cost@2, ws_net_profit@3]                                                                                                                                                                                                                                                                                  |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=Hash([ws_web_site_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                             |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_ship_addr_sk@0, ca_address_sk@0)], projection=[ws_web_site_sk@1, ws_order_number@2, ws_ext_ship_cost@3, ws_net_profit@4]                                                                                                                                                                                                                                                     |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                         RepartitionExec: partitioning=Hash([ws_ship_addr_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                    |
|               |                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_ship_date_sk@0, d_date_sk@0)], projection=[ws_ship_addr_sk@1, ws_web_site_sk@2, ws_order_number@3, ws_ext_ship_cost@4, ws_net_profit@5]                                                                                                                                                                                                                              |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 RepartitionExec: partitioning=Hash([ws_ship_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                            |
|               |                                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_ship_date_sk, ws_ship_addr_sk, ws_web_site_sk, ws_order_number, ws_ext_ship_cost, ws_net_profit]                       |
|               |                                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                    |
|               |                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_date@2 >= 2002-05-01 AND d_date@2 <= 2002-06-30, pruning_predicate=CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_max@0 >= 2002-05-01 END AND CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_min@3 <= 2002-06-30 END, required_guarantees=[N] |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                         RepartitionExec: partitioning=Hash([ca_address_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                      |
|               |                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                            |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                               ParquetExec: file_groups={1 group: [[tpcds_sf1/customer_address/customer_address.parquet]]}, projection=[ca_address_sk], predicate=ca_state@8 = MA, pruning_predicate=CASE WHEN ca_state_null_count@2 = ca_state_row_count@3 THEN false ELSE ca_state_min@0 <= MA AND MA <= ca_state_max@1 END, required_guarantees=[N]                                                                                      |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=Hash([web_site_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/web_site/web_site.parquet]]}, projection=[web_site_sk], predicate=web_company_name@14 = pri, pruning_predicate=CASE WHEN web_company_name_null_count@2 = web_company_name_row_count@3 THEN false ELSE web_company_name_min@0 <= pri AND pri <= web_company_name_max@1 END, required_guarantees=[N]                                                           |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_order_number@1, ws_order_number@1)], filter=ws_warehouse_sk@1 != ws_warehouse_sk@0, projection=[ws_order_number@1]                                                                                                                                                                                                                                                                       |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             RepartitionExec: partitioning=Hash([ws_order_number@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                |
|               |                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                 ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_warehouse_sk, ws_order_number]                                                                                                             |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             RepartitionExec: partitioning=Hash([ws_order_number@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                |
|               |                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                 ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_warehouse_sk, ws_order_number]                                                                                                             |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(wr_order_number@0, ws_order_number@0)], projection=[wr_order_number@0]                                                                                                                                                                                                                                                                                                                          |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                         RepartitionExec: partitioning=Hash([wr_order_number@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                    |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                            |
|               |                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               ParquetExec: file_groups={1 group: [[tpcds_sf1/web_returns/web_returns.parquet]]}, projection=[wr_order_number]                                                                                                                                                                                                                                                                                                                             |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_order_number@1, ws_order_number@1)], filter=ws_warehouse_sk@1 != ws_warehouse_sk@0, projection=[ws_order_number@1]                                                                                                                                                                                                                                                                       |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             RepartitionExec: partitioning=Hash([ws_order_number@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                |
|               |                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                 ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_warehouse_sk, ws_order_number]                                                                                                             |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             RepartitionExec: partitioning=Hash([ws_order_number@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                |
|               |                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                 ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_warehouse_sk, ws_order_number]                                                                                                             |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
