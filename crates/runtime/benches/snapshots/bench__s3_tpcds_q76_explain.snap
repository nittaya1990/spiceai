---
source: crates/runtime/benches/bench.rs
description: "Query: select  channel, col_name, d_year, d_qoy, i_category, COUNT(*) sales_cnt, SUM(ext_sales_price) sales_amt FROM (\n        SELECT 'store' as channel, 'ss_customer_sk' col_name, d_year, d_qoy, i_category, ss_ext_sales_price ext_sales_price\n         FROM store_sales, item, date_dim\n         WHERE ss_customer_sk IS NULL\n           AND ss_sold_date_sk=d_date_sk\n           AND ss_item_sk=i_item_sk\n        UNION ALL\n        SELECT 'web' as channel, 'ws_ship_hdemo_sk' col_name, d_year, d_qoy, i_category, ws_ext_sales_price ext_sales_price\n         FROM web_sales, item, date_dim\n         WHERE ws_ship_hdemo_sk IS NULL\n           AND ws_sold_date_sk=d_date_sk\n           AND ws_item_sk=i_item_sk\n        UNION ALL\n        SELECT 'catalog' as channel, 'cs_bill_customer_sk' col_name, d_year, d_qoy, i_category, cs_ext_sales_price ext_sales_price\n         FROM catalog_sales, item, date_dim\n         WHERE cs_bill_customer_sk IS NULL\n           AND cs_sold_date_sk=d_date_sk\n           AND cs_item_sk=i_item_sk) foo\nGROUP BY channel, col_name, d_year, d_qoy, i_category\nORDER BY channel, col_name, d_year, d_qoy, i_category\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: foo.channel ASC NULLS LAST, foo.col_name ASC NULLS LAST, foo.d_year ASC NULLS LAST, foo.d_qoy ASC NULLS LAST, foo.i_category ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                               |
|               |   Projection: foo.channel, foo.col_name, foo.d_year, foo.d_qoy, foo.i_category, count(*) AS sales_cnt, sum(foo.ext_sales_price) AS sales_amt                                                                                                                                                                                                                                                                                                                                                                                               |
|               |     Aggregate: groupBy=[[foo.channel, foo.col_name, foo.d_year, foo.d_qoy, foo.i_category]], aggr=[[count(Int64(1)) AS count(*), sum(foo.ext_sales_price)]]                                                                                                                                                                                                                                                                                                                                                                                |
|               |       SubqueryAlias: foo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |         Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |           Projection: Utf8("store") AS channel, Utf8("ss_customer_sk") AS col_name, date_dim.d_year, date_dim.d_qoy, item.i_category, store_sales.ss_ext_sales_price AS ext_sales_price                                                                                                                                                                                                                                                                                                                                                    |
|               |             Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |               Projection: store_sales.ss_sold_date_sk, store_sales.ss_ext_sales_price, item.i_category                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                 Inner Join: store_sales.ss_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_ext_sales_price], full_filters=[store_sales.ss_customer_sk IS NULL]                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: item projection=[i_item_sk, i_category]                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 TableScan: date_dim projection=[d_date_sk, d_year, d_qoy]                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |           Projection: Utf8("web") AS channel, Utf8("ws_ship_hdemo_sk") AS col_name, date_dim.d_year, date_dim.d_qoy, item.i_category, web_sales.ws_ext_sales_price AS ext_sales_price                                                                                                                                                                                                                                                                                                                                                      |
|               |             Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |               Projection: web_sales.ws_sold_date_sk, web_sales.ws_ext_sales_price, item.i_category                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                 Inner Join: web_sales.ws_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_ext_sales_price], full_filters=[web_sales.ws_ship_hdemo_sk IS NULL]                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: item projection=[i_item_sk, i_category]                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 TableScan: date_dim projection=[d_date_sk, d_year, d_qoy]                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |           Projection: Utf8("catalog") AS channel, Utf8("cs_bill_customer_sk") AS col_name, date_dim.d_year, date_dim.d_qoy, item.i_category, catalog_sales.cs_ext_sales_price AS ext_sales_price                                                                                                                                                                                                                                                                                                                                           |
|               |             Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |               Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_ext_sales_price, item.i_category                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 Inner Join: catalog_sales.cs_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_ext_sales_price], full_filters=[catalog_sales.cs_bill_customer_sk IS NULL]                                                                                                                                                                                                                                                                                                                                                                        |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: item projection=[i_item_sk, i_category]                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 TableScan: date_dim projection=[d_date_sk, d_year, d_qoy]                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| physical_plan | SortPreservingMergeExec: [channel@0 ASC NULLS LAST, col_name@1 ASC NULLS LAST, d_year@2 ASC NULLS LAST, d_qoy@3 ASC NULLS LAST, i_category@4 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                    |
|               |   SortExec: TopK(fetch=100), expr=[channel@0 ASC NULLS LAST, col_name@1 ASC NULLS LAST, d_year@2 ASC NULLS LAST, d_qoy@3 ASC NULLS LAST, i_category@4 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                        |
|               |     ProjectionExec: expr=[channel@0 as channel, col_name@1 as col_name, d_year@2 as d_year, d_qoy@3 as d_qoy, i_category@4 as i_category, count(*)@5 as sales_cnt, sum(foo.ext_sales_price)@6 as sales_amt]                                                                                                                                                                                                                                                                                                                                |
|               |       AggregateExec: mode=FinalPartitioned, gby=[channel@0 as channel, col_name@1 as col_name, d_year@2 as d_year, d_qoy@3 as d_qoy, i_category@4 as i_category], aggr=[count(*), sum(foo.ext_sales_price)]                                                                                                                                                                                                                                                                                                                                |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |           RepartitionExec: partitioning=Hash([channel@0, col_name@1, d_year@2, d_qoy@3, i_category@4], 4), input_partitions=12                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |             AggregateExec: mode=Partial, gby=[channel@0 as channel, col_name@1 as col_name, d_year@2 as d_year, d_qoy@3 as d_qoy, i_category@4 as i_category], aggr=[count(*), sum(foo.ext_sales_price)], ordering_mode=PartiallySorted([0, 1])                                                                                                                                                                                                                                                                                            |
|               |               UnionExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                 ProjectionExec: expr=[store as channel, ss_customer_sk as col_name, d_year@4 as d_year, d_qoy@5 as d_qoy, i_category@2 as i_category, ss_ext_sales_price@1 as ext_sales_price]                                                                                                                                                                                                                                                                                                                                             |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)]                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_item_sk@1, i_item_sk@0)], projection=[ss_sold_date_sk@0, ss_ext_sales_price@2, i_category@4]                                                                                                                                                                                                                                                                                                                                                          |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=Hash([ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_item_sk, ss_ext_sales_price], predicate=ss_customer_sk@3 IS NULL, pruning_predicate=ss_customer_sk_null_count@0 > 0, required_guarantees=[N]                         |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_category]                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                               ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year, d_qoy]                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 ProjectionExec: expr=[web as channel, ws_ship_hdemo_sk as col_name, d_year@4 as d_year, d_qoy@5 as d_qoy, i_category@2 as i_category, ws_ext_sales_price@1 as ext_sales_price]                                                                                                                                                                                                                                                                                                                                             |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)]                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_item_sk@1, i_item_sk@0)], projection=[ws_sold_date_sk@0, ws_ext_sales_price@2, i_category@4]                                                                                                                                                                                                                                                                                                                                                          |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=Hash([ws_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_sold_date_sk, ws_item_sk, ws_ext_sales_price], predicate=ws_ship_hdemo_sk@10 IS NULL, pruning_predicate=ws_ship_hdemo_sk_null_count@0 > 0, required_guarantees=[N]                                       |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_category]                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                               ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year, d_qoy]                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 ProjectionExec: expr=[catalog as channel, cs_bill_customer_sk as col_name, d_year@4 as d_year, d_qoy@5 as d_qoy, i_category@2 as i_category, cs_ext_sales_price@1 as ext_sales_price]                                                                                                                                                                                                                                                                                                                                      |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                     HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)]                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_item_sk@1, i_item_sk@0)], projection=[cs_sold_date_sk@0, cs_ext_sales_price@2, i_category@4]                                                                                                                                                                                                                                                                                                                                                          |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=Hash([cs_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                     ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_item_sk, cs_ext_sales_price], predicate=cs_bill_customer_sk@3 IS NULL, pruning_predicate=cs_bill_customer_sk_null_count@0 > 0, required_guarantees=[N] |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                       ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_category]                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                               ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year, d_qoy]                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
