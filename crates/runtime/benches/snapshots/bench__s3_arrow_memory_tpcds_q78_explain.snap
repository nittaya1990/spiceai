---
source: crates/runtime/benches/bench.rs
description: "Query: with ws as\n  (select d_year AS ws_sold_year, ws_item_sk,\n    ws_bill_customer_sk ws_customer_sk,\n    sum(ws_quantity) ws_qty,\n    sum(ws_wholesale_cost) ws_wc,\n    sum(ws_sales_price) ws_sp\n   from web_sales\n   left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n   join date_dim on ws_sold_date_sk = d_date_sk\n   where wr_order_number is null\n   group by d_year, ws_item_sk, ws_bill_customer_sk\n   ),\ncs as\n  (select d_year AS cs_sold_year, cs_item_sk,\n    cs_bill_customer_sk cs_customer_sk,\n    sum(cs_quantity) cs_qty,\n    sum(cs_wholesale_cost) cs_wc,\n    sum(cs_sales_price) cs_sp\n   from catalog_sales\n   left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n   join date_dim on cs_sold_date_sk = d_date_sk\n   where cr_order_number is null\n   group by d_year, cs_item_sk, cs_bill_customer_sk\n   ),\nss as\n  (select d_year AS ss_sold_year, ss_item_sk,\n    ss_customer_sk,\n    sum(ss_quantity) ss_qty,\n    sum(ss_wholesale_cost) ss_wc,\n    sum(ss_sales_price) ss_sp\n   from store_sales\n   left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n   join date_dim on ss_sold_date_sk = d_date_sk\n   where sr_ticket_number is null\n   group by d_year, ss_item_sk, ss_customer_sk\n   )\n select\nss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001\norder by\n  ss_customer_sk,\n  ss_qty desc, ss_wc desc, ss_sp desc,\n  other_chan_qty,\n  other_chan_wholesale_cost,\n  other_chan_sales_price,\n  ratio\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: ss.ss_customer_sk, ratio, store_qty, store_wholesale_cost, store_sales_price, other_chan_qty, other_chan_wholesale_cost, other_chan_sales_price                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |   Sort: ss.ss_customer_sk ASC NULLS LAST, ss.ss_qty DESC NULLS FIRST, ss.ss_wc DESC NULLS FIRST, ss.ss_sp DESC NULLS FIRST, other_chan_qty ASC NULLS LAST, other_chan_wholesale_cost ASC NULLS LAST, other_chan_sales_price ASC NULLS LAST, ratio ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                       |
|               |     Projection: ss.ss_customer_sk, round(CAST(ss.ss_qty / __common_expr_1 AS Float64), Int64(2)) AS ratio, ss.ss_qty AS store_qty, ss.ss_wc AS store_wholesale_cost, ss.ss_sp AS store_sales_price, __common_expr_1 AS other_chan_qty, coalesce(CAST(ws.ws_wc AS Decimal128(22, 2)), Decimal128(Some(0),22,2)) + coalesce(CAST(cs.cs_wc AS Decimal128(22, 2)), Decimal128(Some(0),22,2)) AS other_chan_wholesale_cost, coalesce(CAST(ws.ws_sp AS Decimal128(22, 2)), Decimal128(Some(0),22,2)) + coalesce(CAST(cs.cs_sp AS Decimal128(22, 2)), Decimal128(Some(0),22,2)) AS other_chan_sales_price, ss.ss_qty, ss.ss_wc, ss.ss_sp |
|               |       Projection: coalesce(ws.ws_qty, Int64(0)) + coalesce(cs.cs_qty, Int64(0)) AS __common_expr_1, ss.ss_customer_sk, ss.ss_qty, ss.ss_wc, ss.ss_sp, ws.ws_wc, ws.ws_sp, cs.cs_wc, cs.cs_sp                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |         Filter: coalesce(ws.ws_qty, Int64(0)) > Int64(0) OR coalesce(cs.cs_qty, Int64(0)) > Int64(0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |           Projection: ss.ss_customer_sk, ss.ss_qty, ss.ss_wc, ss.ss_sp, ws.ws_qty, ws.ws_wc, ws.ws_sp, cs.cs_qty, cs.cs_wc, cs.cs_sp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |             Left Join: ss.ss_sold_year = cs.cs_sold_year, ss.ss_item_sk = cs.cs_item_sk, ss.ss_customer_sk = cs.cs_customer_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |               Projection: ss.ss_sold_year, ss.ss_item_sk, ss.ss_customer_sk, ss.ss_qty, ss.ss_wc, ss.ss_sp, ws.ws_qty, ws.ws_wc, ws.ws_sp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                 Left Join: ss.ss_sold_year = ws.ws_sold_year, ss.ss_item_sk = ws.ws_item_sk, ss.ss_customer_sk = ws.ws_customer_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                   SubqueryAlias: ss                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                     Projection: date_dim.d_year AS ss_sold_year, store_sales.ss_item_sk, store_sales.ss_customer_sk, sum(store_sales.ss_quantity) AS ss_qty, sum(store_sales.ss_wholesale_cost) AS ss_wc, sum(store_sales.ss_sales_price) AS ss_sp                                                                                                                                                                                                                                                                                                                                                                                |
|               |                       Aggregate: groupBy=[[date_dim.d_year, store_sales.ss_item_sk, store_sales.ss_customer_sk]], aggr=[[sum(CAST(store_sales.ss_quantity AS Int64)), sum(store_sales.ss_wholesale_cost), sum(store_sales.ss_sales_price)]]                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                         Projection: store_sales.ss_item_sk, store_sales.ss_customer_sk, store_sales.ss_quantity, store_sales.ss_wholesale_cost, store_sales.ss_sales_price, date_dim.d_year                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                             Projection: store_sales.ss_sold_date_sk, store_sales.ss_item_sk, store_sales.ss_customer_sk, store_sales.ss_quantity, store_sales.ss_wholesale_cost, store_sales.ss_sales_price                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                               Filter: store_returns.sr_ticket_number IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                 Projection: store_sales.ss_sold_date_sk, store_sales.ss_item_sk, store_sales.ss_customer_sk, store_sales.ss_quantity, store_sales.ss_wholesale_cost, store_sales.ss_sales_price, store_returns.sr_ticket_number                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                   Left Join: store_sales.ss_ticket_number = store_returns.sr_ticket_number, store_sales.ss_item_sk = store_returns.sr_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                       TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_ticket_number, ss_quantity, ss_wholesale_cost, ss_sales_price]                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                       TableScan: store_returns projection=[sr_item_sk, sr_ticket_number]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                               Filter: date_dim.d_year = Int32(2001)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                 TableScan: date_dim projection=[d_date_sk, d_year]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                   SubqueryAlias: ws                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                     Projection: date_dim.d_year AS ws_sold_year, web_sales.ws_item_sk, web_sales.ws_bill_customer_sk AS ws_customer_sk, sum(web_sales.ws_quantity) AS ws_qty, sum(web_sales.ws_wholesale_cost) AS ws_wc, sum(web_sales.ws_sales_price) AS ws_sp                                                                                                                                                                                                                                                                                                                                                                   |
|               |                       Aggregate: groupBy=[[date_dim.d_year, web_sales.ws_item_sk, web_sales.ws_bill_customer_sk]], aggr=[[sum(CAST(web_sales.ws_quantity AS Int64)), sum(web_sales.ws_wholesale_cost), sum(web_sales.ws_sales_price)]]                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                         Projection: web_sales.ws_item_sk, web_sales.ws_bill_customer_sk, web_sales.ws_quantity, web_sales.ws_wholesale_cost, web_sales.ws_sales_price, date_dim.d_year                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                           Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                             Projection: web_sales.ws_sold_date_sk, web_sales.ws_item_sk, web_sales.ws_bill_customer_sk, web_sales.ws_quantity, web_sales.ws_wholesale_cost, web_sales.ws_sales_price                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                               Filter: web_returns.wr_order_number IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 Projection: web_sales.ws_sold_date_sk, web_sales.ws_item_sk, web_sales.ws_bill_customer_sk, web_sales.ws_quantity, web_sales.ws_wholesale_cost, web_sales.ws_sales_price, web_returns.wr_order_number                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                   Left Join: web_sales.ws_order_number = web_returns.wr_order_number, web_sales.ws_item_sk = web_returns.wr_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                       TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_bill_customer_sk, ws_order_number, ws_quantity, ws_wholesale_cost, ws_sales_price]                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                       TableScan: web_returns projection=[wr_item_sk, wr_order_number]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |               SubqueryAlias: cs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                 Projection: date_dim.d_year AS cs_sold_year, catalog_sales.cs_item_sk, catalog_sales.cs_bill_customer_sk AS cs_customer_sk, sum(catalog_sales.cs_quantity) AS cs_qty, sum(catalog_sales.cs_wholesale_cost) AS cs_wc, sum(catalog_sales.cs_sales_price) AS cs_sp                                                                                                                                                                                                                                                                                                                                                   |
|               |                   Aggregate: groupBy=[[date_dim.d_year, catalog_sales.cs_item_sk, catalog_sales.cs_bill_customer_sk]], aggr=[[sum(CAST(catalog_sales.cs_quantity AS Int64)), sum(catalog_sales.cs_wholesale_cost), sum(catalog_sales.cs_sales_price)]]                                                                                                                                                                                                                                                                                                                                                                            |
|               |                     Projection: catalog_sales.cs_bill_customer_sk, catalog_sales.cs_item_sk, catalog_sales.cs_quantity, catalog_sales.cs_wholesale_cost, catalog_sales.cs_sales_price, date_dim.d_year                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                       Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                         Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_bill_customer_sk, catalog_sales.cs_item_sk, catalog_sales.cs_quantity, catalog_sales.cs_wholesale_cost, catalog_sales.cs_sales_price                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                           Filter: catalog_returns.cr_order_number IS NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                             Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_bill_customer_sk, catalog_sales.cs_item_sk, catalog_sales.cs_quantity, catalog_sales.cs_wholesale_cost, catalog_sales.cs_sales_price, catalog_returns.cr_order_number                                                                                                                                                                                                                                                                                                                                                                     |
|               |                               Left Join: catalog_sales.cs_order_number = catalog_returns.cr_order_number, catalog_sales.cs_item_sk = catalog_returns.cr_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                   TableScan: catalog_sales projection=[cs_sold_date_sk, cs_bill_customer_sk, cs_item_sk, cs_order_number, cs_quantity, cs_wholesale_cost, cs_sales_price]                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                   TableScan: catalog_returns projection=[cr_item_sk, cr_order_number]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                           TableScan: date_dim projection=[d_date_sk, d_year]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| physical_plan | ProjectionExec: expr=[ss_customer_sk@0 as ss_customer_sk, ratio@1 as ratio, store_qty@2 as store_qty, store_wholesale_cost@3 as store_wholesale_cost, store_sales_price@4 as store_sales_price, other_chan_qty@5 as other_chan_qty, other_chan_wholesale_cost@6 as other_chan_wholesale_cost, other_chan_sales_price@7 as other_chan_sales_price]                                                                                                                                                                                                                                                                                 |
|               |   SortPreservingMergeExec: [ss_customer_sk@0 ASC NULLS LAST, ss_qty@8 DESC, ss_wc@9 DESC, ss_sp@10 DESC, other_chan_qty@5 ASC NULLS LAST, other_chan_wholesale_cost@6 ASC NULLS LAST, other_chan_sales_price@7 ASC NULLS LAST, ratio@1 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                 |
|               |     SortExec: TopK(fetch=100), expr=[ss_customer_sk@0 ASC NULLS LAST, ss_qty@8 DESC, ss_wc@9 DESC, ss_sp@10 DESC, other_chan_qty@5 ASC NULLS LAST, other_chan_wholesale_cost@6 ASC NULLS LAST, other_chan_sales_price@7 ASC NULLS LAST, ratio@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                     |
|               |       ProjectionExec: expr=[ss_customer_sk@1 as ss_customer_sk, round(CAST(ss_qty@2 / __common_expr_1@0 AS Float64), 2) as ratio, ss_qty@2 as store_qty, ss_wc@3 as store_wholesale_cost, ss_sp@4 as store_sales_price, __common_expr_1@0 as other_chan_qty, coalesce(CAST(ws_wc@5 AS Decimal128(22, 2)), Some(0),22,2) + coalesce(CAST(cs_wc@7 AS Decimal128(22, 2)), Some(0),22,2) as other_chan_wholesale_cost, coalesce(CAST(ws_sp@6 AS Decimal128(22, 2)), Some(0),22,2) + coalesce(CAST(cs_sp@8 AS Decimal128(22, 2)), Some(0),22,2) as other_chan_sales_price, ss_qty@2 as ss_qty, ss_wc@3 as ss_wc, ss_sp@4 as ss_sp]     |
|               |         ProjectionExec: expr=[coalesce(ws_qty@4, 0) + coalesce(cs_qty@7, 0) as __common_expr_1, ss_customer_sk@0 as ss_customer_sk, ss_qty@1 as ss_qty, ss_wc@2 as ss_wc, ss_sp@3 as ss_sp, ws_wc@5 as ws_wc, ws_sp@6 as ws_sp, cs_wc@8 as cs_wc, cs_sp@9 as cs_sp]                                                                                                                                                                                                                                                                                                                                                               |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |             FilterExec: coalesce(ws_qty@4, 0) > 0 OR coalesce(cs_qty@7, 0) > 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                 HashJoinExec: mode=Partitioned, join_type=Left, on=[(ss_sold_year@0, cs_sold_year@0), (ss_item_sk@1, cs_item_sk@1), (ss_customer_sk@2, cs_customer_sk@2)], projection=[ss_customer_sk@2, ss_qty@3, ss_wc@4, ss_sp@5, ws_qty@6, ws_wc@7, ws_sp@8, cs_qty@12, cs_wc@13, cs_sp@14]                                                                                                                                                                                                                                                                                                                                   |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                     HashJoinExec: mode=Partitioned, join_type=Left, on=[(ss_sold_year@0, ws_sold_year@0), (ss_item_sk@1, ws_item_sk@1), (ss_customer_sk@2, ws_customer_sk@2)], projection=[ss_sold_year@0, ss_item_sk@1, ss_customer_sk@2, ss_qty@3, ss_wc@4, ss_sp@5, ws_qty@9, ws_wc@10, ws_sp@11]                                                                                                                                                                                                                                                                                                                              |
|               |                       ProjectionExec: expr=[d_year@0 as ss_sold_year, ss_item_sk@1 as ss_item_sk, ss_customer_sk@2 as ss_customer_sk, sum(store_sales.ss_quantity)@3 as ss_qty, sum(store_sales.ss_wholesale_cost)@4 as ss_wc, sum(store_sales.ss_sales_price)@5 as ss_sp]                                                                                                                                                                                                                                                                                                                                                        |
|               |                         AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, ss_item_sk@1 as ss_item_sk, ss_customer_sk@2 as ss_customer_sk], aggr=[sum(store_sales.ss_quantity), sum(store_sales.ss_wholesale_cost), sum(store_sales.ss_sales_price)]                                                                                                                                                                                                                                                                                                                                                                  |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                             RepartitionExec: partitioning=Hash([d_year@0, ss_item_sk@1, ss_customer_sk@2], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                               AggregateExec: mode=Partial, gby=[d_year@5 as d_year, ss_item_sk@0 as ss_item_sk, ss_customer_sk@1 as ss_customer_sk], aggr=[sum(store_sales.ss_quantity), sum(store_sales.ss_wholesale_cost), sum(store_sales.ss_sales_price)]                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_customer_sk@2, ss_quantity@3, ss_wholesale_cost@4, ss_sales_price@5, d_year@7]                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                       RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                           FilterExec: sr_ticket_number@6 IS NULL, projection=[ss_sold_date_sk@0, ss_item_sk@1, ss_customer_sk@2, ss_quantity@3, ss_wholesale_cost@4, ss_sales_price@5]                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Left, on=[(ss_ticket_number@3, sr_ticket_number@1), (ss_item_sk@1, sr_item_sk@0)], projection=[ss_sold_date_sk@0, ss_item_sk@1, ss_customer_sk@2, ss_quantity@4, ss_wholesale_cost@5, ss_sales_price@6, sr_ticket_number@8]                                                                                                                                                                                                                                                                                                               |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                   RepartitionExec: partitioning=Hash([ss_ticket_number@3, ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                           MemoryExec: partitions=1, partition_sizes=[352]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                   RepartitionExec: partitioning=Hash([sr_ticket_number@1, sr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                           MemoryExec: partitions=1, partition_sizes=[36]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                       RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                             FilterExec: d_year@1 = 2001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                               SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                   MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                       ProjectionExec: expr=[d_year@0 as ws_sold_year, ws_item_sk@1 as ws_item_sk, ws_bill_customer_sk@2 as ws_customer_sk, sum(web_sales.ws_quantity)@3 as ws_qty, sum(web_sales.ws_wholesale_cost)@4 as ws_wc, sum(web_sales.ws_sales_price)@5 as ws_sp]                                                                                                                                                                                                                                                                                                                                                         |
|               |                         AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, ws_item_sk@1 as ws_item_sk, ws_bill_customer_sk@2 as ws_bill_customer_sk], aggr=[sum(web_sales.ws_quantity), sum(web_sales.ws_wholesale_cost), sum(web_sales.ws_sales_price)]                                                                                                                                                                                                                                                                                                                                                              |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                             RepartitionExec: partitioning=Hash([d_year@0, ws_item_sk@1, ws_bill_customer_sk@2], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               AggregateExec: mode=Partial, gby=[d_year@5 as d_year, ws_item_sk@0 as ws_item_sk, ws_bill_customer_sk@1 as ws_bill_customer_sk], aggr=[sum(web_sales.ws_quantity), sum(web_sales.ws_wholesale_cost), sum(web_sales.ws_sales_price)]                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_item_sk@1, ws_bill_customer_sk@2, ws_quantity@3, ws_wholesale_cost@4, ws_sales_price@5, d_year@7]                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                       RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                           FilterExec: wr_order_number@6 IS NULL, projection=[ws_sold_date_sk@0, ws_item_sk@1, ws_bill_customer_sk@2, ws_quantity@3, ws_wholesale_cost@4, ws_sales_price@5]                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Left, on=[(ws_order_number@3, wr_order_number@1), (ws_item_sk@1, wr_item_sk@0)], projection=[ws_sold_date_sk@0, ws_item_sk@1, ws_bill_customer_sk@2, ws_quantity@4, ws_wholesale_cost@5, ws_sales_price@6, wr_order_number@8]                                                                                                                                                                                                                                                                                                             |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                   RepartitionExec: partitioning=Hash([ws_order_number@3, ws_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                           MemoryExec: partitions=1, partition_sizes=[88]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                   RepartitionExec: partitioning=Hash([wr_order_number@1, wr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                           MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                       RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                           SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                               MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                   ProjectionExec: expr=[d_year@0 as cs_sold_year, cs_item_sk@1 as cs_item_sk, cs_bill_customer_sk@2 as cs_customer_sk, sum(catalog_sales.cs_quantity)@3 as cs_qty, sum(catalog_sales.cs_wholesale_cost)@4 as cs_wc, sum(catalog_sales.cs_sales_price)@5 as cs_sp]                                                                                                                                                                                                                                                                                                                                                 |
|               |                     AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, cs_item_sk@1 as cs_item_sk, cs_bill_customer_sk@2 as cs_bill_customer_sk], aggr=[sum(catalog_sales.cs_quantity), sum(catalog_sales.cs_wholesale_cost), sum(catalog_sales.cs_sales_price)]                                                                                                                                                                                                                                                                                                                                                      |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                         RepartitionExec: partitioning=Hash([d_year@0, cs_item_sk@1, cs_bill_customer_sk@2], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           AggregateExec: mode=Partial, gby=[d_year@5 as d_year, cs_item_sk@1 as cs_item_sk, cs_bill_customer_sk@0 as cs_bill_customer_sk], aggr=[sum(catalog_sales.cs_quantity), sum(catalog_sales.cs_wholesale_cost), sum(catalog_sales.cs_sales_price)]                                                                                                                                                                                                                                                                                                                                                         |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_bill_customer_sk@1, cs_item_sk@2, cs_quantity@3, cs_wholesale_cost@4, cs_sales_price@5, d_year@7]                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                   RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                       FilterExec: cr_order_number@6 IS NULL, projection=[cs_sold_date_sk@0, cs_bill_customer_sk@1, cs_item_sk@2, cs_quantity@3, cs_wholesale_cost@4, cs_sales_price@5]                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                           HashJoinExec: mode=Partitioned, join_type=Left, on=[(cs_order_number@3, cr_order_number@1), (cs_item_sk@2, cr_item_sk@0)], projection=[cs_sold_date_sk@0, cs_bill_customer_sk@1, cs_item_sk@2, cs_quantity@4, cs_wholesale_cost@5, cs_sales_price@6, cr_order_number@8]                                                                                                                                                                                                                                                                                                                 |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                               RepartitionExec: partitioning=Hash([cs_order_number@3, cs_item_sk@2], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                   SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                       MemoryExec: partitions=1, partition_sizes=[176]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                               RepartitionExec: partitioning=Hash([cr_order_number@1, cr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                   SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                       MemoryExec: partitions=1, partition_sizes=[18]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                           MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
