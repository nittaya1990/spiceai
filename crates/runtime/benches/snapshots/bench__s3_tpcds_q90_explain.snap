---
source: crates/runtime/benches/bench.rs
description: "Query: select  cast(amc as decimal(15,4))/cast(pmc as decimal(15,4)) am_pm_ratio\n from ( select count(*) amc\n       from web_sales, household_demographics , time_dim, web_page\n       where ws_sold_time_sk = time_dim.t_time_sk\n         and ws_ship_hdemo_sk = household_demographics.hd_demo_sk\n         and ws_web_page_sk = web_page.wp_web_page_sk\n         and time_dim.t_hour between 9 and 9+1\n         and household_demographics.hd_dep_count = 2\n         and web_page.wp_char_count between 2500 and 5200) at,\n      ( select count(*) pmc\n       from web_sales, household_demographics , time_dim, web_page\n       where ws_sold_time_sk = time_dim.t_time_sk\n         and ws_ship_hdemo_sk = household_demographics.hd_demo_sk\n         and ws_web_page_sk = web_page.wp_web_page_sk\n         and time_dim.t_hour between 15 and 15+1\n         and household_demographics.hd_dep_count = 2\n         and web_page.wp_char_count between 2500 and 5200) pt\n order by am_pm_ratio\n  LIMIT 100;\n"
snapshot_kind: text
---
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: am_pm_ratio ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |   Projection: CAST(at.amc AS Decimal128(15, 4)) / CAST(pt.pmc AS Decimal128(15, 4)) AS am_pm_ratio                                                                                                                                                                                                                                                                                                                                                                                     |
|               |     Cross Join:                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |       SubqueryAlias: at                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |         Projection: count(*) AS amc                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |           Aggregate: groupBy=[[]], aggr=[[count(Int64(1)) AS count(*)]]                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |             Projection:                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |               Inner Join: web_sales.ws_web_page_sk = web_page.wp_web_page_sk                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 Projection: web_sales.ws_web_page_sk                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                   Inner Join: web_sales.ws_sold_time_sk = time_dim.t_time_sk                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     Projection: web_sales.ws_sold_time_sk, web_sales.ws_web_page_sk                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       Inner Join: web_sales.ws_ship_hdemo_sk = household_demographics.hd_demo_sk                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           TableScan: web_sales projection=[ws_sold_time_sk, ws_ship_hdemo_sk, ws_web_page_sk]                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           TableScan: household_demographics projection=[hd_demo_sk], full_filters=[household_demographics.hd_dep_count = Int32(2)]                                                                                                                                                                                                                                                                                                                                     |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                       TableScan: time_dim projection=[t_time_sk], full_filters=[time_dim.t_hour >= Int32(9), time_dim.t_hour <= Int32(10)]                                                                                                                                                                                                                                                                                                                                             |
|               |                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                   TableScan: web_page projection=[wp_web_page_sk], full_filters=[web_page.wp_char_count >= Int32(2500), web_page.wp_char_count <= Int32(5200)]                                                                                                                                                                                                                                                                                                                         |
|               |       SubqueryAlias: pt                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |         Projection: count(*) AS pmc                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |           Aggregate: groupBy=[[]], aggr=[[count(Int64(1)) AS count(*)]]                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |             Projection:                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |               Inner Join: web_sales.ws_web_page_sk = web_page.wp_web_page_sk                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 Projection: web_sales.ws_web_page_sk                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                   Inner Join: web_sales.ws_sold_time_sk = time_dim.t_time_sk                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     Projection: web_sales.ws_sold_time_sk, web_sales.ws_web_page_sk                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                       Inner Join: web_sales.ws_ship_hdemo_sk = household_demographics.hd_demo_sk                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           TableScan: web_sales projection=[ws_sold_time_sk, ws_ship_hdemo_sk, ws_web_page_sk]                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           TableScan: household_demographics projection=[hd_demo_sk], full_filters=[household_demographics.hd_dep_count = Int32(2)]                                                                                                                                                                                                                                                                                                                                     |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                       TableScan: time_dim projection=[t_time_sk], full_filters=[time_dim.t_hour >= Int32(15), time_dim.t_hour <= Int32(16)]                                                                                                                                                                                                                                                                                                                                            |
|               |                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                   TableScan: web_page projection=[wp_web_page_sk], full_filters=[web_page.wp_char_count >= Int32(2500), web_page.wp_char_count <= Int32(5200)]                                                                                                                                                                                                                                                                                                                         |
| physical_plan | SortExec: TopK(fetch=100), expr=[am_pm_ratio@0 ASC NULLS LAST], preserve_partitioning=[false]                                                                                                                                                                                                                                                                                                                                                                                          |
|               |   ProjectionExec: expr=[CAST(amc@0 AS Decimal128(15, 4)) / CAST(pmc@1 AS Decimal128(15, 4)) as am_pm_ratio]                                                                                                                                                                                                                                                                                                                                                                            |
|               |     CrossJoinExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |       ProjectionExec: expr=[count(*)@0 as amc]                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |         AggregateExec: mode=Final, gby=[], aggr=[count(*)]                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |           CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |             AggregateExec: mode=Partial, gby=[], aggr=[count(*)]                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |               ProjectionExec: expr=[]                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_web_page_sk@0, wp_web_page_sk@0)]                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                       RepartitionExec: partitioning=Hash([ws_web_page_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_time_sk@0, t_time_sk@0)], projection=[ws_web_page_sk@1]                                                                                                                                                                                                                                                                                                                                        |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                               RepartitionExec: partitioning=Hash([ws_sold_time_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_ship_hdemo_sk@1, hd_demo_sk@0)], projection=[ws_sold_time_sk@0, ws_web_page_sk@2]                                                                                                                                                                                                                                                                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                       RepartitionExec: partitioning=Hash([ws_ship_hdemo_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                           ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_sold_time_sk, ws_ship_hdemo_sk, ws_web_page_sk]                                                                                               |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                       RepartitionExec: partitioning=Hash([hd_demo_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                             ParquetExec: file_groups={1 group: [[tpcds_sf1/household_demographics/household_demographics.parquet]]}, projection=[hd_demo_sk], predicate=hd_dep_count@3 = 2, pruning_predicate=CASE WHEN hd_dep_count_null_count@2 = hd_dep_count_row_count@3 THEN false ELSE hd_dep_count_min@0 <= 2 AND 2 <= hd_dep_count_max@1 END, required_guarantees=[N]                                                                        |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                               RepartitionExec: partitioning=Hash([t_time_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/time_dim/time_dim.parquet]]}, projection=[t_time_sk], predicate=t_hour@3 >= 9 AND t_hour@3 <= 10, pruning_predicate=CASE WHEN t_hour_null_count@1 = t_hour_row_count@2 THEN false ELSE t_hour_max@0 >= 9 END AND CASE WHEN t_hour_null_count@1 = t_hour_row_count@2 THEN false ELSE t_hour_min@3 <= 10 END, required_guarantees=[N]                                                                  |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                       RepartitionExec: partitioning=Hash([wp_web_page_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                             ParquetExec: file_groups={1 group: [[tpcds_sf1/web_page/web_page.parquet]]}, projection=[wp_web_page_sk], predicate=wp_char_count@10 >= 2500 AND wp_char_count@10 <= 5200, pruning_predicate=CASE WHEN wp_char_count_null_count@1 = wp_char_count_row_count@2 THEN false ELSE wp_char_count_max@0 >= 2500 END AND CASE WHEN wp_char_count_null_count@1 = wp_char_count_row_count@2 THEN false ELSE wp_char_count_min@3 <= 5200 END, required_guarantees=[N] |
|               |       ProjectionExec: expr=[count(*)@0 as pmc]                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |         AggregateExec: mode=Final, gby=[], aggr=[count(*)]                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |           CoalescePartitionsExec                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |             AggregateExec: mode=Partial, gby=[], aggr=[count(*)]                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |               ProjectionExec: expr=[]                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_web_page_sk@0, wp_web_page_sk@0)]                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                       RepartitionExec: partitioning=Hash([ws_web_page_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_time_sk@0, t_time_sk@0)], projection=[ws_web_page_sk@1]                                                                                                                                                                                                                                                                                                                                        |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                               RepartitionExec: partitioning=Hash([ws_sold_time_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_ship_hdemo_sk@1, hd_demo_sk@0)], projection=[ws_sold_time_sk@0, ws_web_page_sk@2]                                                                                                                                                                                                                                                                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                       RepartitionExec: partitioning=Hash([ws_ship_hdemo_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                           ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_sold_time_sk, ws_ship_hdemo_sk, ws_web_page_sk]                                                                                               |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                       RepartitionExec: partitioning=Hash([hd_demo_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                             ParquetExec: file_groups={1 group: [[tpcds_sf1/household_demographics/household_demographics.parquet]]}, projection=[hd_demo_sk], predicate=hd_dep_count@3 = 2, pruning_predicate=CASE WHEN hd_dep_count_null_count@2 = hd_dep_count_row_count@3 THEN false ELSE hd_dep_count_min@0 <= 2 AND 2 <= hd_dep_count_max@1 END, required_guarantees=[N]                                                                        |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                               RepartitionExec: partitioning=Hash([t_time_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/time_dim/time_dim.parquet]]}, projection=[t_time_sk], predicate=t_hour@3 >= 15 AND t_hour@3 <= 16, pruning_predicate=CASE WHEN t_hour_null_count@1 = t_hour_row_count@2 THEN false ELSE t_hour_max@0 >= 15 END AND CASE WHEN t_hour_null_count@1 = t_hour_row_count@2 THEN false ELSE t_hour_min@3 <= 16 END, required_guarantees=[N]                                                                |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                       RepartitionExec: partitioning=Hash([wp_web_page_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                             ParquetExec: file_groups={1 group: [[tpcds_sf1/web_page/web_page.parquet]]}, projection=[wp_web_page_sk], predicate=wp_char_count@10 >= 2500 AND wp_char_count@10 <= 5200, pruning_predicate=CASE WHEN wp_char_count_null_count@1 = wp_char_count_row_count@2 THEN false ELSE wp_char_count_max@0 >= 2500 END AND CASE WHEN wp_char_count_null_count@1 = wp_char_count_row_count@2 THEN false ELSE wp_char_count_min@3 <= 5200 END, required_guarantees=[N] |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
