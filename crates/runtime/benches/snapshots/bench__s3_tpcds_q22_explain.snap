---
source: crates/runtime/benches/bench.rs
description: "Query: select  i_product_name\n             ,i_brand\n             ,i_class\n             ,i_category\n             ,avg(inv_quantity_on_hand) qoh\n       from inventory\n           ,date_dim\n           ,item\n       where inv_date_sk=d_date_sk\n              and inv_item_sk=i_item_sk\n              and d_month_seq between 1201 and 1201 + 11\n       group by rollup(i_product_name\n                       ,i_brand\n                       ,i_class\n                       ,i_category)\norder by qoh, i_product_name, i_brand, i_class, i_category\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: qoh ASC NULLS LAST, item.i_product_name ASC NULLS LAST, item.i_brand ASC NULLS LAST, item.i_class ASC NULLS LAST, item.i_category ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |   Projection: item.i_product_name, item.i_brand, item.i_class, item.i_category, avg(inventory.inv_quantity_on_hand) AS qoh                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |     Aggregate: groupBy=[[ROLLUP (item.i_product_name, item.i_brand, item.i_class, item.i_category)]], aggr=[[avg(CAST(inventory.inv_quantity_on_hand AS Float64))]]                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |       Projection: inventory.inv_quantity_on_hand, item.i_brand, item.i_class, item.i_category, item.i_product_name                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |         Inner Join: inventory.inv_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |           Projection: inventory.inv_item_sk, inventory.inv_quantity_on_hand                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |             Inner Join: inventory.inv_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 TableScan: inventory projection=[inv_date_sk, inv_item_sk, inv_quantity_on_hand]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                 TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_month_seq >= Int32(1201), date_dim.d_month_seq <= Int32(1212)]                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |           BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |             TableScan: item projection=[i_item_sk, i_brand, i_class, i_category, i_product_name]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| physical_plan | SortPreservingMergeExec: [qoh@4 ASC NULLS LAST, i_product_name@0 ASC NULLS LAST, i_brand@1 ASC NULLS LAST, i_class@2 ASC NULLS LAST, i_category@3 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |   SortExec: TopK(fetch=100), expr=[qoh@4 ASC NULLS LAST, i_product_name@0 ASC NULLS LAST, i_brand@1 ASC NULLS LAST, i_class@2 ASC NULLS LAST, i_category@3 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                   |
|               |     ProjectionExec: expr=[i_product_name@0 as i_product_name, i_brand@1 as i_brand, i_class@2 as i_class, i_category@3 as i_category, avg(inventory.inv_quantity_on_hand)@5 as qoh]                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |       AggregateExec: mode=FinalPartitioned, gby=[i_product_name@0 as i_product_name, i_brand@1 as i_brand, i_class@2 as i_class, i_category@3 as i_category, __grouping_id@4 as __grouping_id], aggr=[avg(inventory.inv_quantity_on_hand)]                                                                                                                                                                                                                                                                                                                                                 |
|               |         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |           RepartitionExec: partitioning=Hash([i_product_name@0, i_brand@1, i_class@2, i_category@3, __grouping_id@4], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |             AggregateExec: mode=Partial, gby=[(NULL as i_product_name, NULL as i_brand, NULL as i_class, NULL as i_category), (i_product_name@4 as i_product_name, NULL as i_brand, NULL as i_class, NULL as i_category), (i_product_name@4 as i_product_name, i_brand@1 as i_brand, NULL as i_class, NULL as i_category), (i_product_name@4 as i_product_name, i_brand@1 as i_brand, i_class@2 as i_class, NULL as i_category), (i_product_name@4 as i_product_name, i_brand@1 as i_brand, i_class@2 as i_class, i_category@3 as i_category)], aggr=[avg(inventory.inv_quantity_on_hand)] |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(inv_item_sk@0, i_item_sk@0)], projection=[inv_quantity_on_hand@1, i_brand@3, i_class@4, i_category@5, i_product_name@6]                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                     RepartitionExec: partitioning=Hash([inv_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(inv_date_sk@0, d_date_sk@0)], projection=[inv_item_sk@1, inv_quantity_on_hand@2]                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             RepartitionExec: partitioning=Hash([inv_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                 ParquetExec: file_groups={4 groups: [[tpcds_sf1/inventory/inventory.parquet:0..16070757], [tpcds_sf1/inventory/inventory.parquet:16070757..32141514], [tpcds_sf1/inventory/inventory.parquet:32141514..48212271], [tpcds_sf1/inventory/inventory.parquet:48212271..64283026]]}, projection=[inv_date_sk, inv_item_sk, inv_quantity_on_hand]                                                                                                                                                                                                                |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                   ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_month_seq@3 >= 1201 AND d_month_seq@3 <= 1212, pruning_predicate=CASE WHEN d_month_seq_null_count@1 = d_month_seq_row_count@2 THEN false ELSE d_month_seq_max@0 >= 1201 END AND CASE WHEN d_month_seq_null_count@1 = d_month_seq_row_count@2 THEN false ELSE d_month_seq_min@3 <= 1212 END, required_guarantees=[N]                                                                                                                      |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                     RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                           ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand, i_class, i_category, i_product_name]                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
