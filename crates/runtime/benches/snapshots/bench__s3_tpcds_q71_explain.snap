---
source: crates/runtime/benches/bench.rs
description: "Query: select i_brand_id brand_id, i_brand brand,t_hour,t_minute,\n \tsum(ext_price) ext_price\n from item, (select ws_ext_sales_price as ext_price,\n                        ws_sold_date_sk as sold_date_sk,\n                        ws_item_sk as sold_item_sk,\n                        ws_sold_time_sk as time_sk\n                 from web_sales,date_dim\n                 where d_date_sk = ws_sold_date_sk\n                   and d_moy=11\n                   and d_year=2001\n                 union all\n                 select cs_ext_sales_price as ext_price,\n                        cs_sold_date_sk as sold_date_sk,\n                        cs_item_sk as sold_item_sk,\n                        cs_sold_time_sk as time_sk\n                 from catalog_sales,date_dim\n                 where d_date_sk = cs_sold_date_sk\n                   and d_moy=11\n                   and d_year=2001\n                 union all\n                 select ss_ext_sales_price as ext_price,\n                        ss_sold_date_sk as sold_date_sk,\n                        ss_item_sk as sold_item_sk,\n                        ss_sold_time_sk as time_sk\n                 from store_sales,date_dim\n                 where d_date_sk = ss_sold_date_sk\n                   and d_moy=11\n                   and d_year=2001\n                 ) tmp,time_dim\n where\n   sold_item_sk = i_item_sk\n   and i_manager_id=1\n   and time_sk = t_time_sk\n   and (t_meal_time = 'breakfast' or t_meal_time = 'dinner')\n group by i_brand, i_brand_id,t_hour,t_minute\n order by ext_price desc, i_brand_id\n ;\n"
snapshot_kind: text
---
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: brand_id, brand, time_dim.t_hour, time_dim.t_minute, ext_price                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |   Sort: ext_price DESC NULLS FIRST, item.i_brand_id ASC NULLS LAST                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |     Projection: item.i_brand_id AS brand_id, item.i_brand AS brand, time_dim.t_hour, time_dim.t_minute, sum(tmp.ext_price) AS ext_price, item.i_brand_id                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |       Aggregate: groupBy=[[item.i_brand, item.i_brand_id, time_dim.t_hour, time_dim.t_minute]], aggr=[[sum(tmp.ext_price)]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |         Projection: item.i_brand_id, item.i_brand, tmp.ext_price, time_dim.t_hour, time_dim.t_minute                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |           Inner Join: tmp.time_sk = time_dim.t_time_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |             Projection: item.i_brand_id, item.i_brand, tmp.ext_price, tmp.time_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |               Inner Join: item.i_item_sk = tmp.sold_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                   TableScan: item projection=[i_item_sk, i_brand_id, i_brand], full_filters=[item.i_manager_id = Int32(1)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                 SubqueryAlias: tmp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                   Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                     Projection: web_sales.ws_ext_sales_price AS ext_price, web_sales.ws_item_sk AS sold_item_sk, web_sales.ws_sold_time_sk AS time_sk                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                       Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           TableScan: web_sales projection=[ws_sold_date_sk, ws_sold_time_sk, ws_item_sk, ws_ext_sales_price]                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_moy = Int32(11), date_dim.d_year = Int32(2001)]                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                     Projection: catalog_sales.cs_ext_sales_price AS ext_price, catalog_sales.cs_item_sk AS sold_item_sk, catalog_sales.cs_sold_time_sk AS time_sk                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                       Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           TableScan: catalog_sales projection=[cs_sold_date_sk, cs_sold_time_sk, cs_item_sk, cs_ext_sales_price]                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_moy = Int32(11), date_dim.d_year = Int32(2001)]                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                     Projection: store_sales.ss_ext_sales_price AS ext_price, store_sales.ss_item_sk AS sold_item_sk, store_sales.ss_sold_time_sk AS time_sk                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                       Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           TableScan: store_sales projection=[ss_sold_date_sk, ss_sold_time_sk, ss_item_sk, ss_ext_sales_price]                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_moy = Int32(11), date_dim.d_year = Int32(2001)]                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |               TableScan: time_dim projection=[t_time_sk, t_hour, t_minute], full_filters=[time_dim.t_meal_time = LargeUtf8("breakfast") OR time_dim.t_meal_time = LargeUtf8("dinner")]                                                                                                                                                                                                                                                                                                                                                                                                           |
| physical_plan | ProjectionExec: expr=[brand_id@0 as brand_id, brand@1 as brand, t_hour@2 as t_hour, t_minute@3 as t_minute, ext_price@4 as ext_price]                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |   SortPreservingMergeExec: [ext_price@4 DESC, i_brand_id@5 ASC NULLS LAST]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |     SortExec: expr=[ext_price@4 DESC, i_brand_id@5 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |       ProjectionExec: expr=[i_brand_id@1 as brand_id, i_brand@0 as brand, t_hour@2 as t_hour, t_minute@3 as t_minute, sum(tmp.ext_price)@4 as ext_price, i_brand_id@1 as i_brand_id]                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |         AggregateExec: mode=FinalPartitioned, gby=[i_brand@0 as i_brand, i_brand_id@1 as i_brand_id, t_hour@2 as t_hour, t_minute@3 as t_minute], aggr=[sum(tmp.ext_price)]                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |             RepartitionExec: partitioning=Hash([i_brand@0, i_brand_id@1, t_hour@2, t_minute@3], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |               AggregateExec: mode=Partial, gby=[i_brand@1 as i_brand, i_brand_id@0 as i_brand_id, t_hour@3 as t_hour, t_minute@4 as t_minute], aggr=[sum(tmp.ext_price)]                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(time_sk@3, t_time_sk@0)], projection=[i_brand_id@0, i_brand@1, ext_price@2, t_hour@5, t_minute@6]                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                       RepartitionExec: partitioning=Hash([time_sk@3], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(i_item_sk@0, sold_item_sk@1)], projection=[i_brand_id@1, i_brand@2, ext_price@3, time_sk@5]                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                               RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_brand], predicate=i_manager_id@20 = 1, pruning_predicate=CASE WHEN i_manager_id_null_count@2 = i_manager_id_row_count@3 THEN false ELSE i_manager_id_min@0 <= 1 AND 1 <= i_manager_id_max@1 END, required_guarantees=[N]                                                                                                                                                                                                         |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                               RepartitionExec: partitioning=Hash([sold_item_sk@1], 4), input_partitions=12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                 UnionExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   ProjectionExec: expr=[ws_ext_sales_price@2 as ext_price, ws_item_sk@1 as sold_item_sk, ws_sold_time_sk@0 as time_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_sold_time_sk@1, ws_item_sk@2, ws_ext_sales_price@3]                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_sold_date_sk, ws_sold_time_sk, ws_item_sk, ws_ext_sales_price]                                                                                                                                                                                      |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_moy@8 = 11 AND d_year@6 = 2001, pruning_predicate=CASE WHEN d_moy_null_count@2 = d_moy_row_count@3 THEN false ELSE d_moy_min@0 <= 11 AND 11 <= d_moy_max@1 END AND CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 2001 AND 2001 <= d_year_max@5 END, required_guarantees=[N]                                                                                  |
|               |                                   ProjectionExec: expr=[cs_ext_sales_price@2 as ext_price, cs_item_sk@1 as sold_item_sk, cs_sold_time_sk@0 as time_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_sold_time_sk@1, cs_item_sk@2, cs_ext_sales_price@3]                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_sold_time_sk, cs_item_sk, cs_ext_sales_price]                                                                                                                                                     |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_moy@8 = 11 AND d_year@6 = 2001, pruning_predicate=CASE WHEN d_moy_null_count@2 = d_moy_row_count@3 THEN false ELSE d_moy_min@0 <= 11 AND 11 <= d_moy_max@1 END AND CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 2001 AND 2001 <= d_year_max@5 END, required_guarantees=[N]                                                                                  |
|               |                                   ProjectionExec: expr=[ss_ext_sales_price@2 as ext_price, ss_item_sk@1 as sold_item_sk, ss_sold_time_sk@0 as time_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_sold_time_sk@1, ss_item_sk@2, ss_ext_sales_price@3]                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_sold_time_sk, ss_item_sk, ss_ext_sales_price]                                                                                                                                                                   |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_moy@8 = 11 AND d_year@6 = 2001, pruning_predicate=CASE WHEN d_moy_null_count@2 = d_moy_row_count@3 THEN false ELSE d_moy_min@0 <= 11 AND 11 <= d_moy_max@1 END AND CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 2001 AND 2001 <= d_year_max@5 END, required_guarantees=[N]                                                                                  |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                       RepartitionExec: partitioning=Hash([t_time_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             ParquetExec: file_groups={1 group: [[tpcds_sf1/time_dim/time_dim.parquet]]}, projection=[t_time_sk, t_hour, t_minute], predicate=t_meal_time@9 = breakfast OR t_meal_time@9 = dinner, pruning_predicate=CASE WHEN t_meal_time_null_count@2 = t_meal_time_row_count@3 THEN false ELSE t_meal_time_min@0 <= breakfast AND breakfast <= t_meal_time_max@1 END OR CASE WHEN t_meal_time_null_count@2 = t_meal_time_row_count@3 THEN false ELSE t_meal_time_min@0 <= dinner AND dinner <= t_meal_time_max@1 END, required_guarantees=[N] |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
