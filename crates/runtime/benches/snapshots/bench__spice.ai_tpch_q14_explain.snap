---
source: crates/runtime/benches/bench.rs
description: "Query: select\n            100.00 * sum(case\n                             when p_type like 'PROMO%'\n                                 then l_extendedprice * (1 - l_discount)\n                             else 0\n            end) / sum(l_extendedprice * (1 - l_discount)) as promo_revenue\nfrom\n    lineitem,\n    part\nwhere\n        l_partkey = p_partkey\n  and l_shipdate >= date '1995-09-01'\n  and l_shipdate < date '1995-10-01';"
snapshot_kind: text
---
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |   Federated                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |  Projection: Float64(100) * sum(CASE WHEN part.p_type LIKE Utf8("PROMO%") THEN lineitem.l_extendedprice * Int64(1) - lineitem.l_discount ELSE Int64(0) END) / sum(lineitem.l_extendedprice * Int64(1) - lineitem.l_discount) AS promo_revenue                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |   Aggregate: groupBy=[[]], aggr=[[sum(CASE WHEN part.p_type LIKE Utf8("PROMO%") THEN lineitem.l_extendedprice * (Int64(1) - lineitem.l_discount) ELSE Int64(0) END), sum(lineitem.l_extendedprice * (Int64(1) - lineitem.l_discount))]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |     Inner Join:  Filter: lineitem.l_partkey = part.p_partkey                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |       Filter: lineitem.l_shipdate >= CAST(Utf8("1995-09-01") AS Date32) AND lineitem.l_shipdate < CAST(Utf8("1995-10-01") AS Date32)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |         TableScan: lineitem projection=[l_partkey, l_extendedprice, l_discount, l_shipdate]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |       TableScan: part projection=[p_partkey, p_type]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| physical_plan | BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |   SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |     VirtualExecutionPlan name=spice.ai compute_context=url=https://flight.spiceai.io,username=,org=spiceai,app=tpch sql=SELECT ((100.0 * sum(CASE WHEN "part".p_type LIKE 'PROMO%' THEN (lineitem.l_extendedprice * (1 - lineitem.l_discount)) ELSE 0 END)) / sum((lineitem.l_extendedprice * (1 - lineitem.l_discount)))) AS promo_revenue FROM lineitem JOIN "part" ON ((lineitem.l_partkey = "part".p_partkey) AND ((lineitem.l_shipdate >= CAST('1995-09-01' AS DATE)) AND (lineitem.l_shipdate < CAST('1995-10-01' AS DATE)))) rewritten_sql=SELECT ((100.0 * sum(CASE WHEN "tpch"."part"."p_type" LIKE 'PROMO%' THEN ("tpch"."lineitem"."l_extendedprice" * (1 - "tpch"."lineitem"."l_discount")) ELSE 0 END)) / sum(("tpch"."lineitem"."l_extendedprice" * (1 - "tpch"."lineitem"."l_discount")))) AS "promo_revenue" FROM "tpch"."lineitem" JOIN "tpch"."part" ON (("tpch"."lineitem"."l_partkey" = "tpch"."part"."p_partkey") AND (("tpch"."lineitem"."l_shipdate" >= CAST('1995-09-01' AS DATE)) AND ("tpch"."lineitem"."l_shipdate" < CAST('1995-10-01' AS DATE)))) |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
