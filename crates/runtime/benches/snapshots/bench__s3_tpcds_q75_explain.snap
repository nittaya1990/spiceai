---
source: crates/runtime/benches/bench.rs
description: "Query: WITH all_sales AS (\n SELECT d_year\n       ,i_brand_id\n       ,i_class_id\n       ,i_category_id\n       ,i_manufact_id\n       ,SUM(sales_cnt) AS sales_cnt\n       ,SUM(sales_amt) AS sales_amt\n FROM (SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt\n             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt\n       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk\n                          JOIN date_dim ON d_date_sk=cs_sold_date_sk\n                          LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number\n                                                    AND cs_item_sk=cr_item_sk)\n       WHERE i_category='Shoes'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt\n             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt\n       FROM store_sales JOIN item ON i_item_sk=ss_item_sk\n                        JOIN date_dim ON d_date_sk=ss_sold_date_sk\n                        LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number\n                                                AND ss_item_sk=sr_item_sk)\n       WHERE i_category='Shoes'\n       UNION\n       SELECT d_year\n             ,i_brand_id\n             ,i_class_id\n             ,i_category_id\n             ,i_manufact_id\n             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt\n             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt\n       FROM web_sales JOIN item ON i_item_sk=ws_item_sk\n                      JOIN date_dim ON d_date_sk=ws_sold_date_sk\n                      LEFT JOIN web_returns ON (ws_order_number=wr_order_number\n                                            AND ws_item_sk=wr_item_sk)\n       WHERE i_category='Shoes') sales_detail\n GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id)\n SELECT  prev_yr.d_year AS prev_year\n                          ,curr_yr.d_year AS year\n                          ,curr_yr.i_brand_id\n                          ,curr_yr.i_class_id\n                          ,curr_yr.i_category_id\n                          ,curr_yr.i_manufact_id\n                          ,prev_yr.sales_cnt AS prev_yr_cnt\n                          ,curr_yr.sales_cnt AS curr_yr_cnt\n                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff\n                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff\n FROM all_sales curr_yr, all_sales prev_yr\n WHERE curr_yr.i_brand_id=prev_yr.i_brand_id\n   AND curr_yr.i_class_id=prev_yr.i_class_id\n   AND curr_yr.i_category_id=prev_yr.i_category_id\n   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id\n   AND curr_yr.d_year=2000\n   AND prev_yr.d_year=2000-1\n   AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9\n ORDER BY sales_cnt_diff,sales_amt_diff\n  LIMIT 100;\n"
snapshot_kind: text
---
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: sales_cnt_diff ASC NULLS LAST, sales_amt_diff ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                             |
|               |   Projection: prev_yr.d_year AS prev_year, curr_yr.d_year AS year, curr_yr.i_brand_id, curr_yr.i_class_id, curr_yr.i_category_id, curr_yr.i_manufact_id, prev_yr.sales_cnt AS prev_yr_cnt, curr_yr.sales_cnt AS curr_yr_cnt, curr_yr.sales_cnt - prev_yr.sales_cnt AS sales_cnt_diff, curr_yr.sales_amt - prev_yr.sales_amt AS sales_amt_diff                                                                                                                             |
|               |     Inner Join: curr_yr.i_brand_id = prev_yr.i_brand_id, curr_yr.i_class_id = prev_yr.i_class_id, curr_yr.i_category_id = prev_yr.i_category_id, curr_yr.i_manufact_id = prev_yr.i_manufact_id Filter: CAST(curr_yr.sales_cnt AS Decimal128(17, 2)) / CAST(prev_yr.sales_cnt AS Decimal128(17, 2)) < Decimal128(Some(900000),23,6)                                                                                                                                        |
|               |       SubqueryAlias: curr_yr                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |         SubqueryAlias: all_sales                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |           Projection: sales_detail.d_year, sales_detail.i_brand_id, sales_detail.i_class_id, sales_detail.i_category_id, sales_detail.i_manufact_id, sum(sales_detail.sales_cnt) AS sales_cnt, sum(sales_detail.sales_amt) AS sales_amt                                                                                                                                                                                                                                   |
|               |             Aggregate: groupBy=[[sales_detail.d_year, sales_detail.i_brand_id, sales_detail.i_class_id, sales_detail.i_category_id, sales_detail.i_manufact_id]], aggr=[[sum(sales_detail.sales_cnt), sum(sales_detail.sales_amt)]]                                                                                                                                                                                                                                       |
|               |               SubqueryAlias: sales_detail                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 Aggregate: groupBy=[[date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, sales_cnt, sales_amt]], aggr=[[]]                                                                                                                                                                                                                                                                                                         |
|               |                   Union                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                     Projection: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, CAST(catalog_sales.cs_quantity AS Int64) - coalesce(CAST(catalog_returns.cr_return_quantity AS Int64), Int64(0)) AS sales_cnt, catalog_sales.cs_ext_sales_price - coalesce(CAST(catalog_returns.cr_return_amount AS Decimal128(30, 15)), Decimal128(Some(0),30,15)) AS sales_amt                                                               |
|               |                       Left Join: catalog_sales.cs_order_number = catalog_returns.cr_order_number, catalog_sales.cs_item_sk = catalog_returns.cr_item_sk                                                                                                                                                                                                                                                                                                                   |
|               |                         Projection: catalog_sales.cs_item_sk, catalog_sales.cs_order_number, catalog_sales.cs_quantity, catalog_sales.cs_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, date_dim.d_year                                                                                                                                                                                                                       |
|               |                           Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                             Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_item_sk, catalog_sales.cs_order_number, catalog_sales.cs_quantity, catalog_sales.cs_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id                                                                                                                                                                                                     |
|               |                               Inner Join: catalog_sales.cs_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_order_number, cs_quantity, cs_ext_sales_price]                                                                                                                                                                                                                                                                                                                     |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: item projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], full_filters=[item.i_category = LargeUtf8("Shoes")]                                                                                                                                                                                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year], full_filters=[date_dim.d_year = Int32(2000)]                                                                                                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: catalog_returns projection=[cr_item_sk, cr_order_number, cr_return_quantity, cr_return_amount]                                                                                                                                                                                                                                                                                                                                       |
|               |                     Projection: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, CAST(store_sales.ss_quantity AS Int64) - coalesce(CAST(store_returns.sr_return_quantity AS Int64), Int64(0)) AS sales_cnt, store_sales.ss_ext_sales_price - coalesce(CAST(store_returns.sr_return_amt AS Decimal128(30, 15)), Decimal128(Some(0),30,15)) AS sales_amt                                                                          |
|               |                       Left Join: store_sales.ss_ticket_number = store_returns.sr_ticket_number, store_sales.ss_item_sk = store_returns.sr_item_sk                                                                                                                                                                                                                                                                                                                         |
|               |                         Projection: store_sales.ss_item_sk, store_sales.ss_ticket_number, store_sales.ss_quantity, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, date_dim.d_year                                                                                                                                                                                                                              |
|               |                           Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                             Projection: store_sales.ss_sold_date_sk, store_sales.ss_item_sk, store_sales.ss_ticket_number, store_sales.ss_quantity, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id                                                                                                                                                                                                              |
|               |                               Inner Join: store_sales.ss_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_ticket_number, ss_quantity, ss_ext_sales_price]                                                                                                                                                                                                                                                                                                                      |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: item projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], full_filters=[item.i_category = LargeUtf8("Shoes")]                                                                                                                                                                                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year], full_filters=[date_dim.d_year = Int32(2000)]                                                                                                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: store_returns projection=[sr_item_sk, sr_ticket_number, sr_return_quantity, sr_return_amt]                                                                                                                                                                                                                                                                                                                                           |
|               |                     Projection: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, CAST(web_sales.ws_quantity AS Int64) - coalesce(CAST(web_returns.wr_return_quantity AS Int64), Int64(0)) AS sales_cnt, web_sales.ws_ext_sales_price - coalesce(CAST(web_returns.wr_return_amt AS Decimal128(30, 15)), Decimal128(Some(0),30,15)) AS sales_amt                                                                                  |
|               |                       Left Join: web_sales.ws_order_number = web_returns.wr_order_number, web_sales.ws_item_sk = web_returns.wr_item_sk                                                                                                                                                                                                                                                                                                                                   |
|               |                         Projection: web_sales.ws_item_sk, web_sales.ws_order_number, web_sales.ws_quantity, web_sales.ws_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, date_dim.d_year                                                                                                                                                                                                                                       |
|               |                           Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             Projection: web_sales.ws_sold_date_sk, web_sales.ws_item_sk, web_sales.ws_order_number, web_sales.ws_quantity, web_sales.ws_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id                                                                                                                                                                                                                         |
|               |                               Inner Join: web_sales.ws_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_order_number, ws_quantity, ws_ext_sales_price]                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: item projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], full_filters=[item.i_category = LargeUtf8("Shoes")]                                                                                                                                                                                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year], full_filters=[date_dim.d_year = Int32(2000)]                                                                                                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: web_returns projection=[wr_item_sk, wr_order_number, wr_return_quantity, wr_return_amt]                                                                                                                                                                                                                                                                                                                                              |
|               |       SubqueryAlias: prev_yr                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |         SubqueryAlias: all_sales                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |           Projection: sales_detail.d_year, sales_detail.i_brand_id, sales_detail.i_class_id, sales_detail.i_category_id, sales_detail.i_manufact_id, sum(sales_detail.sales_cnt) AS sales_cnt, sum(sales_detail.sales_amt) AS sales_amt                                                                                                                                                                                                                                   |
|               |             Aggregate: groupBy=[[sales_detail.d_year, sales_detail.i_brand_id, sales_detail.i_class_id, sales_detail.i_category_id, sales_detail.i_manufact_id]], aggr=[[sum(sales_detail.sales_cnt), sum(sales_detail.sales_amt)]]                                                                                                                                                                                                                                       |
|               |               SubqueryAlias: sales_detail                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 Aggregate: groupBy=[[date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, sales_cnt, sales_amt]], aggr=[[]]                                                                                                                                                                                                                                                                                                         |
|               |                   Union                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                     Projection: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, CAST(catalog_sales.cs_quantity AS Int64) - coalesce(CAST(catalog_returns.cr_return_quantity AS Int64), Int64(0)) AS sales_cnt, catalog_sales.cs_ext_sales_price - coalesce(CAST(catalog_returns.cr_return_amount AS Decimal128(30, 15)), Decimal128(Some(0),30,15)) AS sales_amt                                                               |
|               |                       Left Join: catalog_sales.cs_order_number = catalog_returns.cr_order_number, catalog_sales.cs_item_sk = catalog_returns.cr_item_sk                                                                                                                                                                                                                                                                                                                   |
|               |                         Projection: catalog_sales.cs_item_sk, catalog_sales.cs_order_number, catalog_sales.cs_quantity, catalog_sales.cs_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, date_dim.d_year                                                                                                                                                                                                                       |
|               |                           Inner Join: catalog_sales.cs_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                             Projection: catalog_sales.cs_sold_date_sk, catalog_sales.cs_item_sk, catalog_sales.cs_order_number, catalog_sales.cs_quantity, catalog_sales.cs_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id                                                                                                                                                                                                     |
|               |                               Inner Join: catalog_sales.cs_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: catalog_sales projection=[cs_sold_date_sk, cs_item_sk, cs_order_number, cs_quantity, cs_ext_sales_price]                                                                                                                                                                                                                                                                                                                     |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: item projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], full_filters=[item.i_category = LargeUtf8("Shoes")]                                                                                                                                                                                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year], full_filters=[date_dim.d_year = Int32(1999)]                                                                                                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: catalog_returns projection=[cr_item_sk, cr_order_number, cr_return_quantity, cr_return_amount]                                                                                                                                                                                                                                                                                                                                       |
|               |                     Projection: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, CAST(store_sales.ss_quantity AS Int64) - coalesce(CAST(store_returns.sr_return_quantity AS Int64), Int64(0)) AS sales_cnt, store_sales.ss_ext_sales_price - coalesce(CAST(store_returns.sr_return_amt AS Decimal128(30, 15)), Decimal128(Some(0),30,15)) AS sales_amt                                                                          |
|               |                       Left Join: store_sales.ss_ticket_number = store_returns.sr_ticket_number, store_sales.ss_item_sk = store_returns.sr_item_sk                                                                                                                                                                                                                                                                                                                         |
|               |                         Projection: store_sales.ss_item_sk, store_sales.ss_ticket_number, store_sales.ss_quantity, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, date_dim.d_year                                                                                                                                                                                                                              |
|               |                           Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                             Projection: store_sales.ss_sold_date_sk, store_sales.ss_item_sk, store_sales.ss_ticket_number, store_sales.ss_quantity, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id                                                                                                                                                                                                              |
|               |                               Inner Join: store_sales.ss_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_ticket_number, ss_quantity, ss_ext_sales_price]                                                                                                                                                                                                                                                                                                                      |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: item projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], full_filters=[item.i_category = LargeUtf8("Shoes")]                                                                                                                                                                                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year], full_filters=[date_dim.d_year = Int32(1999)]                                                                                                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: store_returns projection=[sr_item_sk, sr_ticket_number, sr_return_quantity, sr_return_amt]                                                                                                                                                                                                                                                                                                                                           |
|               |                     Projection: date_dim.d_year, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, CAST(web_sales.ws_quantity AS Int64) - coalesce(CAST(web_returns.wr_return_quantity AS Int64), Int64(0)) AS sales_cnt, web_sales.ws_ext_sales_price - coalesce(CAST(web_returns.wr_return_amt AS Decimal128(30, 15)), Decimal128(Some(0),30,15)) AS sales_amt                                                                                  |
|               |                       Left Join: web_sales.ws_order_number = web_returns.wr_order_number, web_sales.ws_item_sk = web_returns.wr_item_sk                                                                                                                                                                                                                                                                                                                                   |
|               |                         Projection: web_sales.ws_item_sk, web_sales.ws_order_number, web_sales.ws_quantity, web_sales.ws_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id, date_dim.d_year                                                                                                                                                                                                                                       |
|               |                           Inner Join: web_sales.ws_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             Projection: web_sales.ws_sold_date_sk, web_sales.ws_item_sk, web_sales.ws_order_number, web_sales.ws_quantity, web_sales.ws_ext_sales_price, item.i_brand_id, item.i_class_id, item.i_category_id, item.i_manufact_id                                                                                                                                                                                                                         |
|               |                               Inner Join: web_sales.ws_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: web_sales projection=[ws_sold_date_sk, ws_item_sk, ws_order_number, ws_quantity, ws_ext_sales_price]                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   TableScan: item projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], full_filters=[item.i_category = LargeUtf8("Shoes")]                                                                                                                                                                                                                                                                                       |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                               TableScan: date_dim projection=[d_date_sk, d_year], full_filters=[date_dim.d_year = Int32(1999)]                                                                                                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           TableScan: web_returns projection=[wr_item_sk, wr_order_number, wr_return_quantity, wr_return_amt]                                                                                                                                                                                                                                                                                                                                              |
| physical_plan | SortPreservingMergeExec: [sales_cnt_diff@8 ASC NULLS LAST, sales_amt_diff@9 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                    |
|               |   SortExec: TopK(fetch=100), expr=[sales_cnt_diff@8 ASC NULLS LAST, sales_amt_diff@9 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                        |
|               |     ProjectionExec: expr=[d_year@7 as prev_year, d_year@0 as year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sales_cnt@8 as prev_yr_cnt, sales_cnt@5 as curr_yr_cnt, sales_cnt@5 - sales_cnt@8 as sales_cnt_diff, sales_amt@6 - sales_amt@9 as sales_amt_diff]                                                                                                                          |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(i_brand_id@1, i_brand_id@1), (i_class_id@2, i_class_id@2), (i_category_id@3, i_category_id@3), (i_manufact_id@4, i_manufact_id@4)], filter=CAST(sales_cnt@0 AS Decimal128(17, 2)) / CAST(sales_cnt@1 AS Decimal128(17, 2)) < Some(900000),23,6, projection=[d_year@0, i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4, sales_cnt@5, sales_amt@6, d_year@7, sales_cnt@12, sales_amt@13]         |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |             RepartitionExec: partitioning=Hash([i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                     |
|               |               ProjectionExec: expr=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sum(sales_detail.sales_cnt)@5 as sales_cnt, sum(sales_detail.sales_amt)@6 as sales_amt]                                                                                                                                                                                               |
|               |                 AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id], aggr=[sum(sales_detail.sales_cnt), sum(sales_detail.sales_amt)]                                                                                                                                                                                               |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                     RepartitionExec: partitioning=Hash([d_year@0, i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                   |
|               |                       AggregateExec: mode=Partial, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id], aggr=[sum(sales_detail.sales_cnt), sum(sales_detail.sales_amt)]                                                                                                                                                                                                  |
|               |                         AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sales_cnt@5 as sales_cnt, sales_amt@6 as sales_amt], aggr=[]                                                                                                                                                                                           |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             RepartitionExec: partitioning=Hash([d_year@0, i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4, sales_cnt@5, sales_amt@6], 4), input_partitions=12                                                                                                                                                                                                                                                                                |
|               |                               AggregateExec: mode=Partial, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sales_cnt@5 as sales_cnt, sales_amt@6 as sales_amt], aggr=[]                                                                                                                                                                                              |
|               |                                 UnionExec                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                   ProjectionExec: expr=[d_year@6 as d_year, i_brand_id@2 as i_brand_id, i_class_id@3 as i_class_id, i_category_id@4 as i_category_id, i_manufact_id@5 as i_manufact_id, CAST(cs_quantity@0 AS Int64) - coalesce(CAST(cr_return_quantity@7 AS Int64), 0) as sales_cnt, cs_ext_sales_price@1 - coalesce(CAST(cr_return_amount@8 AS Decimal128(30, 15)), Some(0),30,15) as sales_amt]                                                        |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Left, on=[(cs_order_number@1, cr_order_number@1), (cs_item_sk@0, cr_item_sk@0)], projection=[cs_quantity@2, cs_ext_sales_price@3, i_brand_id@4, i_class_id@5, i_category_id@6, i_manufact_id@7, d_year@8, cr_return_quantity@11, cr_return_amount@12]                                                                                                                                     |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([cs_order_number@1, cs_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_item_sk@1, cs_order_number@2, cs_quantity@3, cs_ext_sales_price@4, i_brand_id@5, i_class_id@6, i_category_id@7, i_manufact_id@8, d_year@10]                                                                                                                                                                          |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                          |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_item_sk@1, i_item_sk@0)], projection=[cs_sold_date_sk@0, cs_item_sk@1, cs_order_number@2, cs_quantity@3, cs_ext_sales_price@4, i_brand_id@6, i_class_id@7, i_category_id@8, i_manufact_id@9]                                                                                                                                                               |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([cs_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                       |
|               |                                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_item_sk, cs_order_number, cs_quantity, cs_ext_sales_price] |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                        |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], predicate=i_category@12 = Shoes, pruning_predicate=CASE WHEN i_category_null_count@2 = i_category_row_count@3 THEN false ELSE i_category_min@0 <= Shoes AND Shoes <= i_category_max@1 END, required_guarantees=[N]                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                         ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year], predicate=d_year@6 = 2000, pruning_predicate=CASE WHEN d_year_null_count@2 = d_year_row_count@3 THEN false ELSE d_year_min@0 <= 2000 AND 2000 <= d_year_max@1 END, required_guarantees=[N]                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([cr_order_number@1, cr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_returns/catalog_returns.parquet:0..3106858], [tpcds_sf1/catalog_returns/catalog_returns.parquet:3106858..6213716], [tpcds_sf1/catalog_returns/catalog_returns.parquet:6213716..9320574], [tpcds_sf1/catalog_returns/catalog_returns.parquet:9320574..12427432]]}, projection=[cr_item_sk, cr_order_number, cr_return_quantity, cr_return_amount]                    |
|               |                                   ProjectionExec: expr=[d_year@6 as d_year, i_brand_id@2 as i_brand_id, i_class_id@3 as i_class_id, i_category_id@4 as i_category_id, i_manufact_id@5 as i_manufact_id, CAST(ss_quantity@0 AS Int64) - coalesce(CAST(sr_return_quantity@7 AS Int64), 0) as sales_cnt, ss_ext_sales_price@1 - coalesce(CAST(sr_return_amt@8 AS Decimal128(30, 15)), Some(0),30,15) as sales_amt]                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Left, on=[(ss_ticket_number@1, sr_ticket_number@1), (ss_item_sk@0, sr_item_sk@0)], projection=[ss_quantity@2, ss_ext_sales_price@3, i_brand_id@4, i_class_id@5, i_category_id@6, i_manufact_id@7, d_year@8, sr_return_quantity@11, sr_return_amt@12]                                                                                                                                      |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([ss_ticket_number@1, ss_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                   |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_ticket_number@2, ss_quantity@3, ss_ext_sales_price@4, i_brand_id@5, i_class_id@6, i_category_id@7, i_manufact_id@8, d_year@10]                                                                                                                                                                         |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                          |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_item_sk@1, i_item_sk@0)], projection=[ss_sold_date_sk@0, ss_item_sk@1, ss_ticket_number@2, ss_quantity@3, ss_ext_sales_price@4, i_brand_id@6, i_class_id@7, i_category_id@8, i_manufact_id@9]                                                                                                                                                              |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                       |
|               |                                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_item_sk, ss_ticket_number, ss_quantity, ss_ext_sales_price]              |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                        |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], predicate=i_category@12 = Shoes, pruning_predicate=CASE WHEN i_category_null_count@2 = i_category_row_count@3 THEN false ELSE i_category_min@0 <= Shoes AND Shoes <= i_category_max@1 END, required_guarantees=[N]                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                         ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year], predicate=d_year@6 = 2000, pruning_predicate=CASE WHEN d_year_null_count@2 = d_year_row_count@3 THEN false ELSE d_year_min@0 <= 2000 AND 2000 <= d_year_max@1 END, required_guarantees=[N]                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([sr_ticket_number@1, sr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                   |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_returns/store_returns.parquet:0..4882309], [tpcds_sf1/store_returns/store_returns.parquet:4882309..9764618], [tpcds_sf1/store_returns/store_returns.parquet:9764618..14646927], [tpcds_sf1/store_returns/store_returns.parquet:14646927..19529233]]}, projection=[sr_item_sk, sr_ticket_number, sr_return_quantity, sr_return_amt]                                    |
|               |                                   ProjectionExec: expr=[d_year@6 as d_year, i_brand_id@2 as i_brand_id, i_class_id@3 as i_class_id, i_category_id@4 as i_category_id, i_manufact_id@5 as i_manufact_id, CAST(ws_quantity@0 AS Int64) - coalesce(CAST(wr_return_quantity@7 AS Int64), 0) as sales_cnt, ws_ext_sales_price@1 - coalesce(CAST(wr_return_amt@8 AS Decimal128(30, 15)), Some(0),30,15) as sales_amt]                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Left, on=[(ws_order_number@1, wr_order_number@1), (ws_item_sk@0, wr_item_sk@0)], projection=[ws_quantity@2, ws_ext_sales_price@3, i_brand_id@4, i_class_id@5, i_category_id@6, i_manufact_id@7, d_year@8, wr_return_quantity@11, wr_return_amt@12]                                                                                                                                        |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([ws_order_number@1, ws_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_item_sk@1, ws_order_number@2, ws_quantity@3, ws_ext_sales_price@4, i_brand_id@5, i_class_id@6, i_category_id@7, i_manufact_id@8, d_year@10]                                                                                                                                                                          |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                          |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_item_sk@1, i_item_sk@0)], projection=[ws_sold_date_sk@0, ws_item_sk@1, ws_order_number@2, ws_quantity@3, ws_ext_sales_price@4, i_brand_id@6, i_class_id@7, i_category_id@8, i_manufact_id@9]                                                                                                                                                               |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([ws_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                       |
|               |                                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_sold_date_sk, ws_item_sk, ws_order_number, ws_quantity, ws_ext_sales_price]                                  |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                        |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], predicate=i_category@12 = Shoes, pruning_predicate=CASE WHEN i_category_null_count@2 = i_category_row_count@3 THEN false ELSE i_category_min@0 <= Shoes AND Shoes <= i_category_max@1 END, required_guarantees=[N]                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                         ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year], predicate=d_year@6 = 2000, pruning_predicate=CASE WHEN d_year_null_count@2 = d_year_row_count@3 THEN false ELSE d_year_min@0 <= 2000 AND 2000 <= d_year_max@1 END, required_guarantees=[N]                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([wr_order_number@1, wr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                          |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/web_returns/web_returns.parquet]]}, projection=[wr_item_sk, wr_order_number, wr_return_quantity, wr_return_amt]                                                                                                                                                                                                                                                            |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |             RepartitionExec: partitioning=Hash([i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                     |
|               |               ProjectionExec: expr=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sum(sales_detail.sales_cnt)@5 as sales_cnt, sum(sales_detail.sales_amt)@6 as sales_amt]                                                                                                                                                                                               |
|               |                 AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id], aggr=[sum(sales_detail.sales_cnt), sum(sales_detail.sales_amt)]                                                                                                                                                                                               |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                     RepartitionExec: partitioning=Hash([d_year@0, i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                   |
|               |                       AggregateExec: mode=Partial, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id], aggr=[sum(sales_detail.sales_cnt), sum(sales_detail.sales_amt)]                                                                                                                                                                                                  |
|               |                         AggregateExec: mode=FinalPartitioned, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sales_cnt@5 as sales_cnt, sales_amt@6 as sales_amt], aggr=[]                                                                                                                                                                                           |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             RepartitionExec: partitioning=Hash([d_year@0, i_brand_id@1, i_class_id@2, i_category_id@3, i_manufact_id@4, sales_cnt@5, sales_amt@6], 4), input_partitions=12                                                                                                                                                                                                                                                                                |
|               |                               AggregateExec: mode=Partial, gby=[d_year@0 as d_year, i_brand_id@1 as i_brand_id, i_class_id@2 as i_class_id, i_category_id@3 as i_category_id, i_manufact_id@4 as i_manufact_id, sales_cnt@5 as sales_cnt, sales_amt@6 as sales_amt], aggr=[]                                                                                                                                                                                              |
|               |                                 UnionExec                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                   ProjectionExec: expr=[d_year@6 as d_year, i_brand_id@2 as i_brand_id, i_class_id@3 as i_class_id, i_category_id@4 as i_category_id, i_manufact_id@5 as i_manufact_id, CAST(cs_quantity@0 AS Int64) - coalesce(CAST(cr_return_quantity@7 AS Int64), 0) as sales_cnt, cs_ext_sales_price@1 - coalesce(CAST(cr_return_amount@8 AS Decimal128(30, 15)), Some(0),30,15) as sales_amt]                                                        |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Left, on=[(cs_order_number@1, cr_order_number@1), (cs_item_sk@0, cr_item_sk@0)], projection=[cs_quantity@2, cs_ext_sales_price@3, i_brand_id@4, i_class_id@5, i_category_id@6, i_manufact_id@7, d_year@8, cr_return_quantity@11, cr_return_amount@12]                                                                                                                                     |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([cs_order_number@1, cs_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_sold_date_sk@0, d_date_sk@0)], projection=[cs_item_sk@1, cs_order_number@2, cs_quantity@3, cs_ext_sales_price@4, i_brand_id@5, i_class_id@6, i_category_id@7, i_manufact_id@8, d_year@10]                                                                                                                                                                          |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([cs_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                          |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(cs_item_sk@1, i_item_sk@0)], projection=[cs_sold_date_sk@0, cs_item_sk@1, cs_order_number@2, cs_quantity@3, cs_ext_sales_price@4, i_brand_id@6, i_class_id@7, i_category_id@8, i_manufact_id@9]                                                                                                                                                               |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([cs_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                       |
|               |                                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_sales/catalog_sales.parquet:0..28908415], [tpcds_sf1/catalog_sales/catalog_sales.parquet:28908415..57816830], [tpcds_sf1/catalog_sales/catalog_sales.parquet:57816830..86725245], [tpcds_sf1/catalog_sales/catalog_sales.parquet:86725245..115633658]]}, projection=[cs_sold_date_sk, cs_item_sk, cs_order_number, cs_quantity, cs_ext_sales_price] |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                        |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], predicate=i_category@12 = Shoes, pruning_predicate=CASE WHEN i_category_null_count@2 = i_category_row_count@3 THEN false ELSE i_category_min@0 <= Shoes AND Shoes <= i_category_max@1 END, required_guarantees=[N]                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                         ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year], predicate=d_year@6 = 1999, pruning_predicate=CASE WHEN d_year_null_count@2 = d_year_row_count@3 THEN false ELSE d_year_min@0 <= 1999 AND 1999 <= d_year_max@1 END, required_guarantees=[N]                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([cr_order_number@1, cr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/catalog_returns/catalog_returns.parquet:0..3106858], [tpcds_sf1/catalog_returns/catalog_returns.parquet:3106858..6213716], [tpcds_sf1/catalog_returns/catalog_returns.parquet:6213716..9320574], [tpcds_sf1/catalog_returns/catalog_returns.parquet:9320574..12427432]]}, projection=[cr_item_sk, cr_order_number, cr_return_quantity, cr_return_amount]                    |
|               |                                   ProjectionExec: expr=[d_year@6 as d_year, i_brand_id@2 as i_brand_id, i_class_id@3 as i_class_id, i_category_id@4 as i_category_id, i_manufact_id@5 as i_manufact_id, CAST(ss_quantity@0 AS Int64) - coalesce(CAST(sr_return_quantity@7 AS Int64), 0) as sales_cnt, ss_ext_sales_price@1 - coalesce(CAST(sr_return_amt@8 AS Decimal128(30, 15)), Some(0),30,15) as sales_amt]                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Left, on=[(ss_ticket_number@1, sr_ticket_number@1), (ss_item_sk@0, sr_item_sk@0)], projection=[ss_quantity@2, ss_ext_sales_price@3, i_brand_id@4, i_class_id@5, i_category_id@6, i_manufact_id@7, d_year@8, sr_return_quantity@11, sr_return_amt@12]                                                                                                                                      |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([ss_ticket_number@1, ss_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                   |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_ticket_number@2, ss_quantity@3, ss_ext_sales_price@4, i_brand_id@5, i_class_id@6, i_category_id@7, i_manufact_id@8, d_year@10]                                                                                                                                                                         |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                          |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_item_sk@1, i_item_sk@0)], projection=[ss_sold_date_sk@0, ss_item_sk@1, ss_ticket_number@2, ss_quantity@3, ss_ext_sales_price@4, i_brand_id@6, i_class_id@7, i_category_id@8, i_manufact_id@9]                                                                                                                                                              |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                       |
|               |                                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_item_sk, ss_ticket_number, ss_quantity, ss_ext_sales_price]              |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                        |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], predicate=i_category@12 = Shoes, pruning_predicate=CASE WHEN i_category_null_count@2 = i_category_row_count@3 THEN false ELSE i_category_min@0 <= Shoes AND Shoes <= i_category_max@1 END, required_guarantees=[N]                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                         ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year], predicate=d_year@6 = 1999, pruning_predicate=CASE WHEN d_year_null_count@2 = d_year_row_count@3 THEN false ELSE d_year_min@0 <= 1999 AND 1999 <= d_year_max@1 END, required_guarantees=[N]                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([sr_ticket_number@1, sr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                   |
|               |                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_returns/store_returns.parquet:0..4882309], [tpcds_sf1/store_returns/store_returns.parquet:4882309..9764618], [tpcds_sf1/store_returns/store_returns.parquet:9764618..14646927], [tpcds_sf1/store_returns/store_returns.parquet:14646927..19529233]]}, projection=[sr_item_sk, sr_ticket_number, sr_return_quantity, sr_return_amt]                                    |
|               |                                   ProjectionExec: expr=[d_year@6 as d_year, i_brand_id@2 as i_brand_id, i_class_id@3 as i_class_id, i_category_id@4 as i_category_id, i_manufact_id@5 as i_manufact_id, CAST(ws_quantity@0 AS Int64) - coalesce(CAST(wr_return_quantity@7 AS Int64), 0) as sales_cnt, ws_ext_sales_price@1 - coalesce(CAST(wr_return_amt@8 AS Decimal128(30, 15)), Some(0),30,15) as sales_amt]                                                           |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Left, on=[(ws_order_number@1, wr_order_number@1), (ws_item_sk@0, wr_item_sk@0)], projection=[ws_quantity@2, ws_ext_sales_price@3, i_brand_id@4, i_class_id@5, i_category_id@6, i_manufact_id@7, d_year@8, wr_return_quantity@11, wr_return_amt@12]                                                                                                                                        |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([ws_order_number@1, ws_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_sold_date_sk@0, d_date_sk@0)], projection=[ws_item_sk@1, ws_order_number@2, ws_quantity@3, ws_ext_sales_price@4, i_brand_id@5, i_class_id@6, i_category_id@7, i_manufact_id@8, d_year@10]                                                                                                                                                                          |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([ws_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                          |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ws_item_sk@1, i_item_sk@0)], projection=[ws_sold_date_sk@0, ws_item_sk@1, ws_order_number@2, ws_quantity@3, ws_ext_sales_price@4, i_brand_id@6, i_class_id@7, i_category_id@8, i_manufact_id@9]                                                                                                                                                               |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([ws_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                       |
|               |                                                             BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                                                               ParquetExec: file_groups={4 groups: [[tpcds_sf1/web_sales/web_sales.parquet:0..14558527], [tpcds_sf1/web_sales/web_sales.parquet:14558527..29117054], [tpcds_sf1/web_sales/web_sales.parquet:29117054..43675581], [tpcds_sf1/web_sales/web_sales.parquet:43675581..58234107]]}, projection=[ws_sold_date_sk, ws_item_sk, ws_order_number, ws_quantity, ws_ext_sales_price]                                  |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                                           RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                        |
|               |                                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                          |
|               |                                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_class_id, i_category_id, i_manufact_id], predicate=i_category@12 = Shoes, pruning_predicate=CASE WHEN i_category_null_count@2 = i_category_row_count@3 THEN false ELSE i_category_min@0 <= Shoes AND Shoes <= i_category_max@1 END, required_guarantees=[N]                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                         ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_year], predicate=d_year@6 = 1999, pruning_predicate=CASE WHEN d_year_null_count@2 = d_year_row_count@3 THEN false ELSE d_year_min@0 <= 1999 AND 1999 <= d_year_max@1 END, required_guarantees=[N]                                                                                            |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                           RepartitionExec: partitioning=Hash([wr_order_number@1, wr_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                    |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                          |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                 ParquetExec: file_groups={1 group: [[tpcds_sf1/web_returns/web_returns.parquet]]}, projection=[wr_item_sk, wr_order_number, wr_return_quantity, wr_return_amt]                                                                                                                                                                                                                                                            |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
