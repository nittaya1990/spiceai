---
source: crates/runtime/benches/bench.rs
description: "Query: select c_last_name\n       ,c_first_name\n       ,c_salutation\n       ,c_preferred_cust_flag\n       ,ss_ticket_number\n       ,cnt from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,count(*) cnt\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk\n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and date_dim.d_dom between 1 and 2\n    and (household_demographics.hd_buy_potential = '1001-5000' or\n         household_demographics.hd_buy_potential = '5001-10000')\n    and household_demographics.hd_vehicle_count > 0\n    and case when household_demographics.hd_vehicle_count > 0 then\n             household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count else null end > 1\n    and date_dim.d_year in (1999,1999+1,1999+2)\n    and store.s_county in ('Williamson County','Williamson County','Williamson County','Williamson County')\n    group by ss_ticket_number,ss_customer_sk) dj,customer\n    where ss_customer_sk = c_customer_sk\n      and cnt between 1 and 5\n    order by cnt desc, c_last_name asc;\n"
snapshot_kind: text
---
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: dj.cnt DESC NULLS FIRST, customer.c_last_name ASC NULLS LAST                                                                                                                                                                                                                                                                                                                                               |
|               |   Projection: customer.c_last_name, customer.c_first_name, customer.c_salutation, customer.c_preferred_cust_flag, dj.ss_ticket_number, dj.cnt                                                                                                                                                                                                                                                                    |
|               |     Inner Join: dj.ss_customer_sk = customer.c_customer_sk                                                                                                                                                                                                                                                                                                                                                       |
|               |       SubqueryAlias: dj                                                                                                                                                                                                                                                                                                                                                                                          |
|               |         Projection: store_sales.ss_ticket_number, store_sales.ss_customer_sk, count(*) AS cnt                                                                                                                                                                                                                                                                                                                    |
|               |           Filter: count(*) >= Int64(1) AND count(*) <= Int64(5)                                                                                                                                                                                                                                                                                                                                                  |
|               |             Aggregate: groupBy=[[store_sales.ss_ticket_number, store_sales.ss_customer_sk]], aggr=[[count(Int64(1)) AS count(*)]]                                                                                                                                                                                                                                                                                |
|               |               Projection: store_sales.ss_customer_sk, store_sales.ss_ticket_number                                                                                                                                                                                                                                                                                                                               |
|               |                 Inner Join: store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk                                                                                                                                                                                                                                                                                                                          |
|               |                   Projection: store_sales.ss_customer_sk, store_sales.ss_hdemo_sk, store_sales.ss_ticket_number                                                                                                                                                                                                                                                                                                  |
|               |                     Inner Join: store_sales.ss_store_sk = store.s_store_sk                                                                                                                                                                                                                                                                                                                                       |
|               |                       Projection: store_sales.ss_customer_sk, store_sales.ss_hdemo_sk, store_sales.ss_store_sk, store_sales.ss_ticket_number                                                                                                                                                                                                                                                                     |
|               |                         Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                             |
|               |                           BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                     |
|               |                             TableScan: store_sales projection=[ss_sold_date_sk, ss_customer_sk, ss_hdemo_sk, ss_store_sk, ss_ticket_number]                                                                                                                                                                                                                                                                      |
|               |                           Projection: date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                         |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                   |
|               |                               Filter: date_dim.d_dom >= Int32(1) AND date_dim.d_dom <= Int32(2) AND (date_dim.d_year = Int32(1999) OR date_dim.d_year = Int32(2000) OR date_dim.d_year = Int32(2001))                                                                                                                                                                                                            |
|               |                                 TableScan: date_dim projection=[d_date_sk, d_year, d_dom]                                                                                                                                                                                                                                                                                                                        |
|               |                       Projection: store.s_store_sk                                                                                                                                                                                                                                                                                                                                                               |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                       |
|               |                           Filter: store.s_county IN ([LargeUtf8("Williamson County"), LargeUtf8("Williamson County"), LargeUtf8("Williamson County"), LargeUtf8("Williamson County")])                                                                                                                                                                                                                           |
|               |                             TableScan: store projection=[s_store_sk, s_county]                                                                                                                                                                                                                                                                                                                                   |
|               |                   Projection: household_demographics.hd_demo_sk                                                                                                                                                                                                                                                                                                                                                  |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                           |
|               |                       Filter: (household_demographics.hd_buy_potential = LargeUtf8("1001-5000") OR household_demographics.hd_buy_potential = LargeUtf8("5001-10000")) AND household_demographics.hd_vehicle_count > Int32(0) AND CASE WHEN household_demographics.hd_vehicle_count > Int32(0) THEN household_demographics.hd_dep_count / household_demographics.hd_vehicle_count ELSE Int32(NULL) END > Int32(1) |
|               |                         TableScan: household_demographics projection=[hd_demo_sk, hd_buy_potential, hd_dep_count, hd_vehicle_count]                                                                                                                                                                                                                                                                              |
|               |       BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                         |
|               |         TableScan: customer projection=[c_customer_sk, c_salutation, c_first_name, c_last_name, c_preferred_cust_flag]                                                                                                                                                                                                                                                                                           |
| physical_plan | SortPreservingMergeExec: [cnt@5 DESC, c_last_name@0 ASC NULLS LAST]                                                                                                                                                                                                                                                                                                                                              |
|               |   SortExec: expr=[cnt@5 DESC, c_last_name@0 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                        |
|               |     ProjectionExec: expr=[c_last_name@4 as c_last_name, c_first_name@3 as c_first_name, c_salutation@2 as c_salutation, c_preferred_cust_flag@5 as c_preferred_cust_flag, ss_ticket_number@0 as ss_ticket_number, cnt@1 as cnt]                                                                                                                                                                                  |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                |
|               |         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_customer_sk@1, c_customer_sk@0)], projection=[ss_ticket_number@0, cnt@2, c_salutation@4, c_first_name@5, c_last_name@6, c_preferred_cust_flag@7]                                                                                                                                                                                                |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                            |
|               |             RepartitionExec: partitioning=Hash([ss_customer_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                        |
|               |               ProjectionExec: expr=[ss_ticket_number@0 as ss_ticket_number, ss_customer_sk@1 as ss_customer_sk, count(*)@2 as cnt]                                                                                                                                                                                                                                                                               |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                      |
|               |                   FilterExec: count(*)@2 >= 1 AND count(*)@2 <= 5                                                                                                                                                                                                                                                                                                                                                |
|               |                     AggregateExec: mode=FinalPartitioned, gby=[ss_ticket_number@0 as ss_ticket_number, ss_customer_sk@1 as ss_customer_sk], aggr=[count(*)]                                                                                                                                                                                                                                                      |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                |
|               |                         RepartitionExec: partitioning=Hash([ss_ticket_number@0, ss_customer_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                        |
|               |                           AggregateExec: mode=Partial, gby=[ss_ticket_number@1 as ss_ticket_number, ss_customer_sk@0 as ss_customer_sk], aggr=[count(*)]                                                                                                                                                                                                                                                         |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                          |
|               |                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_hdemo_sk@1, hd_demo_sk@0)], projection=[ss_customer_sk@0, ss_ticket_number@2]                                                                                                                                                                                                                                             |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                      |
|               |                                   RepartitionExec: partitioning=Hash([ss_hdemo_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                     |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                  |
|               |                                       HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_store_sk@2, s_store_sk@0)], projection=[ss_customer_sk@0, ss_hdemo_sk@1, ss_ticket_number@3]                                                                                                                                                                                                                      |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([ss_store_sk@2], 4), input_partitions=4                                                                                                                                                                                                                                                                                             |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                          |
|               |                                               HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_customer_sk@1, ss_hdemo_sk@2, ss_store_sk@3, ss_ticket_number@4]                                                                                                                                                                                            |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                      |
|               |                                                   RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                 |
|               |                                                     BytesProcessedExec                                                                                                                                                                                                                                                                                                                                           |
|               |                                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                         |
|               |                                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                     |
|               |                                                           MemoryExec: partitions=1, partition_sizes=[352]                                                                                                                                                                                                                                                                                                        |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                      |
|               |                                                   RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                       |
|               |                                                     ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                                                                                                                                                              |
|               |                                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                         |
|               |                                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                              |
|               |                                                           FilterExec: d_dom@2 >= 1 AND d_dom@2 <= 2 AND (d_year@1 = 1999 OR d_year@1 = 2000 OR d_year@1 = 2001)                                                                                                                                                                                                                                                  |
|               |                                                             SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                   |
|               |                                                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                               |
|               |                                                                 MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                                                                                                    |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                              |
|               |                                           RepartitionExec: partitioning=Hash([s_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                              |
|               |                                             ProjectionExec: expr=[s_store_sk@0 as s_store_sk]                                                                                                                                                                                                                                                                                                                    |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                      |
|               |                                                   FilterExec: Use s_county@1 IN (SET) ([Literal { value: LargeUtf8("Williamson County") }, Literal { value: LargeUtf8("Williamson County") }, Literal { value: LargeUtf8("Williamson County") }, Literal { value: LargeUtf8("Williamson County") }])                                                                                                             |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                         |
|               |                                                       SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                         |
|               |                                                         MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                                                                                                                                            |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                      |
|               |                                   RepartitionExec: partitioning=Hash([hd_demo_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                      |
|               |                                     ProjectionExec: expr=[hd_demo_sk@0 as hd_demo_sk]                                                                                                                                                                                                                                                                                                                            |
|               |                                       BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                         |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                              |
|               |                                           FilterExec: (hd_buy_potential@1 = 1001-5000 OR hd_buy_potential@1 = 5001-10000) AND hd_vehicle_count@3 > 0 AND CASE WHEN hd_vehicle_count@3 > 0 THEN hd_dep_count@2 / hd_vehicle_count@3 END > 1                                                                                                                                                                       |
|               |                                             RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                 |
|               |                                               SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                 MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                                                                                                                                                    |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                            |
|               |             RepartitionExec: partitioning=Hash([c_customer_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                         |
|               |               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                               |
|               |                   RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                           |
|               |                     MemoryExec: partitions=1, partition_sizes=[13]                                                                                                                                                                                                                                                                                                                                               |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
