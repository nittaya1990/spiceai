---
source: crates/runtime/benches/bench.rs
description: "Query: select\n\ts_store_name,\n\ti_item_desc,\n\tsc.revenue,\n\ti_current_price,\n\ti_wholesale_cost,\n\ti_brand\n from store, item,\n     (select ss_store_sk, avg(revenue) as ave\n \tfrom\n \t    (select  ss_store_sk, ss_item_sk,\n \t\t     sum(ss_sales_price) as revenue\n \t\tfrom store_sales, date_dim\n \t\twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1186 and 1186+11\n \t\tgroup by ss_store_sk, ss_item_sk) sa\n \tgroup by ss_store_sk) sb,\n     (select  ss_store_sk, ss_item_sk, sum(ss_sales_price) as revenue\n \tfrom store_sales, date_dim\n \twhere ss_sold_date_sk = d_date_sk and d_month_seq between 1186 and 1186+11\n \tgroup by ss_store_sk, ss_item_sk) sc\n where sb.ss_store_sk = sc.ss_store_sk and\n       sc.revenue <= 0.1 * sb.ave and\n       s_store_sk = sc.ss_store_sk and\n       i_item_sk = sc.ss_item_sk\n order by s_store_name, i_item_desc\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                            |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: store.s_store_name ASC NULLS LAST, item.i_item_desc ASC NULLS LAST, fetch=100                                                                                                                                                                                                                             |
|               |   Projection: store.s_store_name, item.i_item_desc, sc.revenue, item.i_current_price, item.i_wholesale_cost, item.i_brand                                                                                                                                                                                       |
|               |     Inner Join: sc.ss_store_sk = sb.ss_store_sk Filter: CAST(sc.revenue AS Decimal128(30, 15)) <= CAST(Float64(0.1) * CAST(sb.ave AS Float64) AS Decimal128(30, 15))                                                                                                                                            |
|               |       Projection: store.s_store_name, sc.ss_store_sk, sc.revenue, item.i_item_desc, item.i_current_price, item.i_wholesale_cost, item.i_brand                                                                                                                                                                   |
|               |         Inner Join: sc.ss_item_sk = item.i_item_sk                                                                                                                                                                                                                                                              |
|               |           Projection: store.s_store_name, sc.ss_store_sk, sc.ss_item_sk, sc.revenue                                                                                                                                                                                                                             |
|               |             Inner Join: store.s_store_sk = sc.ss_store_sk                                                                                                                                                                                                                                                       |
|               |               BytesProcessedNode                                                                                                                                                                                                                                                                                |
|               |                 TableScan: store projection=[s_store_sk, s_store_name]                                                                                                                                                                                                                                          |
|               |               SubqueryAlias: sc                                                                                                                                                                                                                                                                                 |
|               |                 Projection: store_sales.ss_store_sk, store_sales.ss_item_sk, sum(store_sales.ss_sales_price) AS revenue                                                                                                                                                                                         |
|               |                   Aggregate: groupBy=[[store_sales.ss_store_sk, store_sales.ss_item_sk]], aggr=[[sum(store_sales.ss_sales_price)]]                                                                                                                                                                              |
|               |                     Projection: store_sales.ss_item_sk, store_sales.ss_store_sk, store_sales.ss_sales_price                                                                                                                                                                                                     |
|               |                       Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                              |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                      |
|               |                           TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_store_sk, ss_sales_price]                                                                                                                                                                                          |
|               |                         Projection: date_dim.d_date_sk                                                                                                                                                                                                                                                          |
|               |                           BytesProcessedNode                                                                                                                                                                                                                                                                    |
|               |                             Filter: date_dim.d_month_seq >= Int32(1186) AND date_dim.d_month_seq <= Int32(1197)                                                                                                                                                                                                 |
|               |                               TableScan: date_dim projection=[d_date_sk, d_month_seq]                                                                                                                                                                                                                           |
|               |           BytesProcessedNode                                                                                                                                                                                                                                                                                    |
|               |             TableScan: item projection=[i_item_sk, i_item_desc, i_current_price, i_wholesale_cost, i_brand]                                                                                                                                                                                                     |
|               |       SubqueryAlias: sb                                                                                                                                                                                                                                                                                         |
|               |         Projection: sa.ss_store_sk, avg(sa.revenue) AS ave                                                                                                                                                                                                                                                      |
|               |           Aggregate: groupBy=[[sa.ss_store_sk]], aggr=[[avg(sa.revenue)]]                                                                                                                                                                                                                                       |
|               |             SubqueryAlias: sa                                                                                                                                                                                                                                                                                   |
|               |               Projection: store_sales.ss_store_sk, sum(store_sales.ss_sales_price) AS revenue                                                                                                                                                                                                                   |
|               |                 Aggregate: groupBy=[[store_sales.ss_store_sk, store_sales.ss_item_sk]], aggr=[[sum(store_sales.ss_sales_price)]]                                                                                                                                                                                |
|               |                   Projection: store_sales.ss_item_sk, store_sales.ss_store_sk, store_sales.ss_sales_price                                                                                                                                                                                                       |
|               |                     Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                |
|               |                       BytesProcessedNode                                                                                                                                                                                                                                                                        |
|               |                         TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_store_sk, ss_sales_price]                                                                                                                                                                                            |
|               |                       Projection: date_dim.d_date_sk                                                                                                                                                                                                                                                            |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                      |
|               |                           Filter: date_dim.d_month_seq >= Int32(1186) AND date_dim.d_month_seq <= Int32(1197)                                                                                                                                                                                                   |
|               |                             TableScan: date_dim projection=[d_date_sk, d_month_seq]                                                                                                                                                                                                                             |
| physical_plan | SortPreservingMergeExec: [s_store_name@0 ASC NULLS LAST, i_item_desc@1 ASC NULLS LAST], fetch=100                                                                                                                                                                                                               |
|               |   SortExec: TopK(fetch=100), expr=[s_store_name@0 ASC NULLS LAST, i_item_desc@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                   |
|               |     ProjectionExec: expr=[s_store_name@0 as s_store_name, i_item_desc@2 as i_item_desc, revenue@1 as revenue, i_current_price@3 as i_current_price, i_wholesale_cost@4 as i_wholesale_cost, i_brand@5 as i_brand]                                                                                               |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                               |
|               |         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_store_sk@1, ss_store_sk@0)], filter=CAST(revenue@0 AS Decimal128(30, 15)) <= CAST(0.1 * CAST(ave@1 AS Float64) AS Decimal128(30, 15)), projection=[s_store_name@0, revenue@2, i_item_desc@3, i_current_price@4, i_wholesale_cost@5, i_brand@6] |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                           |
|               |             RepartitionExec: partitioning=Hash([ss_store_sk@1], 4), input_partitions=4                                                                                                                                                                                                                          |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                       |
|               |                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_item_sk@2, i_item_sk@0)], projection=[s_store_name@0, ss_store_sk@1, revenue@3, i_item_desc@5, i_current_price@6, i_wholesale_cost@7, i_brand@8]                                                                                       |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                   |
|               |                     RepartitionExec: partitioning=Hash([ss_item_sk@2], 4), input_partitions=4                                                                                                                                                                                                                   |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                               |
|               |                         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(s_store_sk@0, ss_store_sk@0)], projection=[s_store_name@1, ss_store_sk@2, ss_item_sk@3, revenue@4]                                                                                                                                |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                           |
|               |                             RepartitionExec: partitioning=Hash([s_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                           |
|               |                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                              |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                                              |
|               |                                   SchemaCastScanExec                                                                                                                                                                                                                                                            |
|               |                                     MemoryExec: partitions=1, partition_sizes=[1]                                                                                                                                                                                                                               |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                           |
|               |                             RepartitionExec: partitioning=Hash([ss_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                          |
|               |                               ProjectionExec: expr=[ss_store_sk@0 as ss_store_sk, ss_item_sk@1 as ss_item_sk, sum(store_sales.ss_sales_price)@2 as revenue]                                                                                                                                                     |
|               |                                 AggregateExec: mode=FinalPartitioned, gby=[ss_store_sk@0 as ss_store_sk, ss_item_sk@1 as ss_item_sk], aggr=[sum(store_sales.ss_sales_price)]                                                                                                                                    |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                   |
|               |                                     RepartitionExec: partitioning=Hash([ss_store_sk@0, ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                    |
|               |                                       AggregateExec: mode=Partial, gby=[ss_store_sk@1 as ss_store_sk, ss_item_sk@0 as ss_item_sk], aggr=[sum(store_sales.ss_sales_price)]                                                                                                                                       |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                             |
|               |                                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_store_sk@2, ss_sales_price@3]                                                                                                                    |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                         |
|               |                                               RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                    |
|               |                                                 BytesProcessedExec                                                                                                                                                                                                                                              |
|               |                                                   SchemaCastScanExec                                                                                                                                                                                                                                            |
|               |                                                     RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                        |
|               |                                                       MemoryExec: partitions=1, partition_sizes=[352]                                                                                                                                                                                                           |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                         |
|               |                                               RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                          |
|               |                                                 ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                                                                 |
|               |                                                   BytesProcessedExec                                                                                                                                                                                                                                            |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                 |
|               |                                                       FilterExec: d_month_seq@1 >= 1186 AND d_month_seq@1 <= 1197                                                                                                                                                                                               |
|               |                                                         SchemaCastScanExec                                                                                                                                                                                                                                      |
|               |                                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                  |
|               |                                                             MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                       |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                   |
|               |                     RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                    |
|               |                       BytesProcessedExec                                                                                                                                                                                                                                                                        |
|               |                         SchemaCastScanExec                                                                                                                                                                                                                                                                      |
|               |                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                  |
|               |                             MemoryExec: partitions=1, partition_sizes=[3]                                                                                                                                                                                                                                       |
|               |           ProjectionExec: expr=[ss_store_sk@0 as ss_store_sk, avg(sa.revenue)@1 as ave]                                                                                                                                                                                                                         |
|               |             AggregateExec: mode=FinalPartitioned, gby=[ss_store_sk@0 as ss_store_sk], aggr=[avg(sa.revenue)]                                                                                                                                                                                                    |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                       |
|               |                 RepartitionExec: partitioning=Hash([ss_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                                      |
|               |                   AggregateExec: mode=Partial, gby=[ss_store_sk@0 as ss_store_sk], aggr=[avg(sa.revenue)]                                                                                                                                                                                                       |
|               |                     ProjectionExec: expr=[ss_store_sk@0 as ss_store_sk, sum(store_sales.ss_sales_price)@2 as revenue]                                                                                                                                                                                           |
|               |                       AggregateExec: mode=FinalPartitioned, gby=[ss_store_sk@0 as ss_store_sk, ss_item_sk@1 as ss_item_sk], aggr=[sum(store_sales.ss_sales_price)]                                                                                                                                              |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                             |
|               |                           RepartitionExec: partitioning=Hash([ss_store_sk@0, ss_item_sk@1], 4), input_partitions=4                                                                                                                                                                                              |
|               |                             AggregateExec: mode=Partial, gby=[ss_store_sk@1 as ss_store_sk, ss_item_sk@0 as ss_item_sk], aggr=[sum(store_sales.ss_sales_price)]                                                                                                                                                 |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                       |
|               |                                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_item_sk@1, ss_store_sk@2, ss_sales_price@3]                                                                                                                              |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                   |
|               |                                     RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                              |
|               |                                       BytesProcessedExec                                                                                                                                                                                                                                                        |
|               |                                         SchemaCastScanExec                                                                                                                                                                                                                                                      |
|               |                                           RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                  |
|               |                                             MemoryExec: partitions=1, partition_sizes=[352]                                                                                                                                                                                                                     |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                   |
|               |                                     RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                    |
|               |                                       ProjectionExec: expr=[d_date_sk@0 as d_date_sk]                                                                                                                                                                                                                           |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                                      |
|               |                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                           |
|               |                                             FilterExec: d_month_seq@1 >= 1186 AND d_month_seq@1 <= 1197                                                                                                                                                                                                         |
|               |                                               SchemaCastScanExec                                                                                                                                                                                                                                                |
|               |                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                            |
|               |                                                   MemoryExec: partitions=1, partition_sizes=[9]                                                                                                                                                                                                                 |
|               |                                                                                                                                                                                                                                                                                                                 |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
