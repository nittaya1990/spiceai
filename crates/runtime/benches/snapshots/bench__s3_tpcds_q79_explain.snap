---
source: crates/runtime/benches/bench.rs
description: "Query: select\n  c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n  from\n   (select ss_ticket_number\n          ,ss_customer_sk\n          ,store.s_city\n          ,sum(ss_coupon_amt) amt\n          ,sum(ss_net_profit) profit\n    from store_sales,date_dim,store,household_demographics\n    where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n    and store_sales.ss_store_sk = store.s_store_sk\n    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n    and (household_demographics.hd_dep_count = 0 or household_demographics.hd_vehicle_count > 4)\n    and date_dim.d_dow = 1\n    and date_dim.d_year in (1999,1999+1,1999+2)\n    and store.s_number_employees between 200 and 295\n    group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n    where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n LIMIT 100;\n"
snapshot_kind: text
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: customer.c_last_name ASC NULLS LAST, customer.c_first_name ASC NULLS LAST, substr(ms.s_city,Int64(1),Int64(30)) ASC NULLS LAST, ms.profit ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |   Projection: customer.c_last_name, customer.c_first_name, substr(ms.s_city, Int64(1), Int64(30)), ms.ss_ticket_number, ms.amt, ms.profit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |     Inner Join: ms.ss_customer_sk = customer.c_customer_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |       SubqueryAlias: ms                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |         Projection: store_sales.ss_ticket_number, store_sales.ss_customer_sk, store.s_city, sum(store_sales.ss_coupon_amt) AS amt, sum(store_sales.ss_net_profit) AS profit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |           Aggregate: groupBy=[[store_sales.ss_ticket_number, store_sales.ss_customer_sk, store_sales.ss_addr_sk, store.s_city]], aggr=[[sum(store_sales.ss_coupon_amt), sum(store_sales.ss_net_profit)]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |             Projection: store_sales.ss_customer_sk, store_sales.ss_addr_sk, store_sales.ss_ticket_number, store_sales.ss_coupon_amt, store_sales.ss_net_profit, store.s_city                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |               Inner Join: store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 Projection: store_sales.ss_customer_sk, store_sales.ss_hdemo_sk, store_sales.ss_addr_sk, store_sales.ss_ticket_number, store_sales.ss_coupon_amt, store_sales.ss_net_profit, store.s_city                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                   Inner Join: store_sales.ss_store_sk = store.s_store_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                     Projection: store_sales.ss_customer_sk, store_sales.ss_hdemo_sk, store_sales.ss_addr_sk, store_sales.ss_store_sk, store_sales.ss_ticket_number, store_sales.ss_coupon_amt, store_sales.ss_net_profit                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                       Inner Join: store_sales.ss_sold_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                           TableScan: store_sales projection=[ss_sold_date_sk, ss_customer_sk, ss_hdemo_sk, ss_addr_sk, ss_store_sk, ss_ticket_number, ss_coupon_amt, ss_net_profit]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                           TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_dow = Int32(1), date_dim.d_year = Int32(1999) OR date_dim.d_year = Int32(2000) OR date_dim.d_year = Int32(2001)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                       TableScan: store projection=[s_store_sk, s_city], full_filters=[store.s_number_employees >= Int32(200), store.s_number_employees <= Int32(295)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                   TableScan: household_demographics projection=[hd_demo_sk], full_filters=[household_demographics.hd_dep_count = Int32(0) OR household_demographics.hd_vehicle_count > Int32(4)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |       BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |         TableScan: customer projection=[c_customer_sk, c_first_name, c_last_name]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| physical_plan | SortPreservingMergeExec: [c_last_name@0 ASC NULLS LAST, c_first_name@1 ASC NULLS LAST, substr(ms.s_city,Int64(1),Int64(30))@2 ASC NULLS LAST, profit@5 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |   SortExec: TopK(fetch=100), expr=[c_last_name@0 ASC NULLS LAST, c_first_name@1 ASC NULLS LAST, substr(ms.s_city,Int64(1),Int64(30))@2 ASC NULLS LAST, profit@5 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |     ProjectionExec: expr=[c_last_name@5 as c_last_name, c_first_name@4 as c_first_name, substr(s_city@1, 1, 30) as substr(ms.s_city,Int64(1),Int64(30)), ss_ticket_number@0 as ss_ticket_number, amt@2 as amt, profit@3 as profit]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_customer_sk@1, c_customer_sk@0)], projection=[ss_ticket_number@0, s_city@2, amt@3, profit@4, c_first_name@6, c_last_name@7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |             RepartitionExec: partitioning=Hash([ss_customer_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |               ProjectionExec: expr=[ss_ticket_number@0 as ss_ticket_number, ss_customer_sk@1 as ss_customer_sk, s_city@3 as s_city, sum(store_sales.ss_coupon_amt)@4 as amt, sum(store_sales.ss_net_profit)@5 as profit]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                 AggregateExec: mode=FinalPartitioned, gby=[ss_ticket_number@0 as ss_ticket_number, ss_customer_sk@1 as ss_customer_sk, ss_addr_sk@2 as ss_addr_sk, s_city@3 as s_city], aggr=[sum(store_sales.ss_coupon_amt), sum(store_sales.ss_net_profit)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                     RepartitionExec: partitioning=Hash([ss_ticket_number@0, ss_customer_sk@1, ss_addr_sk@2, s_city@3], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                       AggregateExec: mode=Partial, gby=[ss_ticket_number@2 as ss_ticket_number, ss_customer_sk@0 as ss_customer_sk, ss_addr_sk@1 as ss_addr_sk, s_city@5 as s_city], aggr=[sum(store_sales.ss_coupon_amt), sum(store_sales.ss_net_profit)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_hdemo_sk@1, hd_demo_sk@0)], projection=[ss_customer_sk@0, ss_addr_sk@2, ss_ticket_number@3, ss_coupon_amt@4, ss_net_profit@5, s_city@6]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                               RepartitionExec: partitioning=Hash([ss_hdemo_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_store_sk@3, s_store_sk@0)], projection=[ss_customer_sk@0, ss_hdemo_sk@1, ss_addr_sk@2, ss_ticket_number@4, ss_coupon_amt@5, ss_net_profit@6, s_city@8]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                       RepartitionExec: partitioning=Hash([ss_store_sk@3], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_sold_date_sk@0, d_date_sk@0)], projection=[ss_customer_sk@1, ss_hdemo_sk@2, ss_addr_sk@3, ss_store_sk@4, ss_ticket_number@5, ss_coupon_amt@6, ss_net_profit@7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                               RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                                   ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_customer_sk, ss_hdemo_sk, ss_addr_sk, ss_store_sk, ss_ticket_number, ss_coupon_amt, ss_net_profit]                                                                                                                                                                                                                                                                                                                               |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                               RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_dow@7 = 1 AND (d_year@6 = 1999 OR d_year@6 = 2000 OR d_year@6 = 2001), pruning_predicate=CASE WHEN d_dow_null_count@2 = d_dow_row_count@3 THEN false ELSE d_dow_min@0 <= 1 AND 1 <= d_dow_max@1 END AND (CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 1999 AND 1999 <= d_year_max@5 END OR CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 2000 AND 2000 <= d_year_max@5 END OR CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 2001 AND 2001 <= d_year_max@5 END), required_guarantees=[N] |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                       RepartitionExec: partitioning=Hash([s_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                             ParquetExec: file_groups={1 group: [[tpcds_sf1/store/store.parquet]]}, projection=[s_store_sk, s_city], predicate=s_number_employees@6 >= 200 AND s_number_employees@6 <= 295, pruning_predicate=CASE WHEN s_number_employees_null_count@1 = s_number_employees_row_count@2 THEN false ELSE s_number_employees_max@0 >= 200 END AND CASE WHEN s_number_employees_null_count@1 = s_number_employees_row_count@2 THEN false ELSE s_number_employees_min@3 <= 295 END, required_guarantees=[N]                                                                                                                                                                                                                                                                                |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                               RepartitionExec: partitioning=Hash([hd_demo_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/household_demographics/household_demographics.parquet]]}, projection=[hd_demo_sk], predicate=hd_dep_count@3 = 0 OR hd_vehicle_count@4 > 4, pruning_predicate=CASE WHEN hd_dep_count_null_count@2 = hd_dep_count_row_count@3 THEN false ELSE hd_dep_count_min@0 <= 0 AND 0 <= hd_dep_count_max@1 END OR CASE WHEN hd_vehicle_count_null_count@5 = hd_vehicle_count_row_count@6 THEN false ELSE hd_vehicle_count_max@4 > 4 END, required_guarantees=[N]                                                                                                                                                                                                                                                                               |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |             RepartitionExec: partitioning=Hash([c_customer_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                   ParquetExec: file_groups={1 group: [[tpcds_sf1/customer/customer.parquet]]}, projection=[c_customer_sk, c_first_name, c_last_name]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
