---
source: crates/runtime/benches/bench.rs
description: "Query: select\n        sum(l_extendedprice) / 7.0 as avg_yearly\nfrom\n    lineitem,\n    part\nwhere\n        p_partkey = l_partkey\n  and p_brand = 'Brand#23'\n  and p_container = 'MED BOX'\n  and l_quantity < (\n    select\n            0.2 * avg(l_quantity)\n    from\n        lineitem\n    where\n            l_partkey = p_partkey\n);"
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |   Federated                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |  Projection: sum(lineitem.l_extendedprice) / Float64(7) AS avg_yearly                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |   Aggregate: groupBy=[[]], aggr=[[sum(lineitem.l_extendedprice)]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |     Inner Join:  Filter: part.p_partkey = lineitem.l_partkey                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |       Filter: lineitem.l_quantity < (<subquery>)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |         Subquery:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |           Projection: Float64(0.2) * avg(lineitem.l_quantity)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |             Aggregate: groupBy=[[]], aggr=[[avg(lineitem.l_quantity)]]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |               Filter: lineitem.l_partkey = outer_ref(part.p_partkey)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                 TableScan: lineitem                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |         TableScan: lineitem projection=[l_partkey, l_quantity, l_extendedprice]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |       TableScan: part projection=[p_partkey], full_filters=[part.p_brand = Utf8("Brand#23"), part.p_container = Utf8("MED BOX")]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| physical_plan | BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |   SchemaCastScanExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |     VirtualExecutionPlan name=spice.ai compute_context=url=https://flight.spiceai.io,username=,org=spiceai,app=tpch sql=SELECT (sum(lineitem.l_extendedprice) / 7.0) AS avg_yearly FROM lineitem JOIN "part" ON (("part".p_partkey = lineitem.l_partkey) AND (((lineitem.l_quantity < (SELECT (0.2 * avg(lineitem.l_quantity)) FROM lineitem WHERE (lineitem.l_partkey = "part".p_partkey))) AND ("part".p_brand = 'Brand#23')) AND ("part".p_container = 'MED BOX'))) rewritten_sql=SELECT (sum("tpch"."lineitem"."l_extendedprice") / 7.0) AS "avg_yearly" FROM "tpch"."lineitem" JOIN "tpch"."part" ON (("tpch"."part"."p_partkey" = "tpch"."lineitem"."l_partkey") AND ((("tpch"."lineitem"."l_quantity" < (SELECT (0.2 * avg("tpch"."lineitem"."l_quantity")) FROM "tpch"."lineitem" WHERE ("tpch"."lineitem"."l_partkey" = "tpch"."part"."p_partkey"))) AND ("tpch"."part"."p_brand" = 'Brand#23')) AND ("tpch"."part"."p_container" = 'MED BOX'))) |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
