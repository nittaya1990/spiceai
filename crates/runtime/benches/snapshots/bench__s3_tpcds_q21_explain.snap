---
source: crates/runtime/benches/bench.rs
description: "Query: select  *\n from(select w_warehouse_name\n            ,i_item_id\n            ,sum(case when (cast(d_date as date) < cast ('2000-05-19' as date))\n\t                then inv_quantity_on_hand\n                      else 0 end) as inv_before\n            ,sum(case when (cast(d_date as date) >= cast ('2000-05-19' as date))\n                      then inv_quantity_on_hand\n                      else 0 end) as inv_after\n   from inventory\n       ,warehouse\n       ,item\n       ,date_dim\n   where i_current_price between 0.99 and 1.49\n     and i_item_sk          = inv_item_sk\n     and inv_warehouse_sk   = w_warehouse_sk\n     and inv_date_sk    = d_date_sk\n     and d_date between (cast ('2000-05-19' as date) - INTERVAL '30 days')\n                    and (cast ('2000-05-19' as date) + INTERVAL '30 days')\n   group by w_warehouse_name, i_item_id) x\n where (case when inv_before > 0\n             then inv_after / inv_before\n             else null\n             end) between 2.0/3.0 and 3.0/2.0\n order by w_warehouse_name\n         ,i_item_id\n  LIMIT 100;\n"
snapshot_kind: text
---
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Sort: x.w_warehouse_name ASC NULLS LAST, x.i_item_id ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |   SubqueryAlias: x                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |     Projection: warehouse.w_warehouse_name, item.i_item_id, sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END) AS inv_before, sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END) AS inv_after                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |       Projection: warehouse.w_warehouse_name, item.i_item_id, sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END), sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |         Filter: __common_expr_5 >= Float64(0.6666666666666666) AND __common_expr_5 <= Float64(1.5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |           Projection: CAST(CASE WHEN sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END) > Int64(0) THEN sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END) / sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END) ELSE Int64(NULL) END AS Float64) AS __common_expr_5, warehouse.w_warehouse_name, item.i_item_id, sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END), sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)                                                                                                                                                                                                                                               |
|               |             Aggregate: groupBy=[[warehouse.w_warehouse_name, item.i_item_id]], aggr=[[sum(CASE WHEN __common_expr_2 < Date32("2000-05-19") THEN CAST(inventory.inv_quantity_on_hand AS Int64) ELSE Int64(0) END) AS sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END), sum(CASE WHEN __common_expr_2 >= Date32("2000-05-19") THEN CAST(inventory.inv_quantity_on_hand AS Int64) ELSE Int64(0) END) AS sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)]]                                                                                                                                                                                                                                                                                                                                                                                 |
|               |               Projection: CAST(date_dim.d_date AS Date32) AS __common_expr_2, inventory.inv_quantity_on_hand, warehouse.w_warehouse_name, item.i_item_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                 Inner Join: inventory.inv_date_sk = date_dim.d_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                   Projection: inventory.inv_date_sk, inventory.inv_quantity_on_hand, warehouse.w_warehouse_name, item.i_item_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                     Inner Join: inventory.inv_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                       Projection: inventory.inv_date_sk, inventory.inv_item_sk, inventory.inv_quantity_on_hand, warehouse.w_warehouse_name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                         Inner Join: inventory.inv_warehouse_sk = warehouse.w_warehouse_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                           BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                             TableScan: inventory projection=[inv_date_sk, inv_item_sk, inv_warehouse_sk, inv_quantity_on_hand]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                             TableScan: warehouse projection=[w_warehouse_sk, w_warehouse_name]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                       BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                         TableScan: item projection=[i_item_sk, i_item_id], full_filters=[item.i_current_price >= Decimal128(Some(99),7,2), item.i_current_price <= Decimal128(Some(149),7,2)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                   BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                     TableScan: date_dim projection=[d_date_sk, d_date], full_filters=[date_dim.d_date >= Date32("2000-04-19"), date_dim.d_date <= Date32("2000-06-18")]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| physical_plan | SortPreservingMergeExec: [w_warehouse_name@0 ASC NULLS LAST, i_item_id@1 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |   SortExec: TopK(fetch=100), expr=[w_warehouse_name@0 ASC NULLS LAST, i_item_id@1 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |     ProjectionExec: expr=[w_warehouse_name@0 as w_warehouse_name, i_item_id@1 as i_item_id, sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@2 as inv_before, sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@3 as inv_after]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |         FilterExec: __common_expr_5@0 >= 0.6666666666666666 AND __common_expr_5@0 <= 1.5, projection=[w_warehouse_name@1, i_item_id@2, sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@3, sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@4]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |           ProjectionExec: expr=[CAST(CASE WHEN sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@2 > 0 THEN sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@3 / sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@2 END AS Float64) as __common_expr_5, w_warehouse_name@0 as w_warehouse_name, i_item_id@1 as i_item_id, sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@2 as sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END), sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)@3 as sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)] |
|               |             AggregateExec: mode=FinalPartitioned, gby=[w_warehouse_name@0 as w_warehouse_name, i_item_id@1 as i_item_id], aggr=[sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END), sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                 RepartitionExec: partitioning=Hash([w_warehouse_name@0, i_item_id@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                   AggregateExec: mode=Partial, gby=[w_warehouse_name@2 as w_warehouse_name, i_item_id@3 as i_item_id], aggr=[sum(CASE WHEN date_dim.d_date < Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END), sum(CASE WHEN date_dim.d_date >= Utf8("2000-05-19") THEN inventory.inv_quantity_on_hand ELSE Int64(0) END)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                     ProjectionExec: expr=[d_date@3 as __common_expr_2, inv_quantity_on_hand@0 as inv_quantity_on_hand, w_warehouse_name@1 as w_warehouse_name, i_item_id@2 as i_item_id]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(inv_date_sk@0, d_date_sk@0)], projection=[inv_quantity_on_hand@1, w_warehouse_name@2, i_item_id@3, d_date@5]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             RepartitionExec: partitioning=Hash([inv_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                               CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 HashJoinExec: mode=Partitioned, join_type=Inner, on=[(inv_item_sk@1, i_item_sk@0)], projection=[inv_date_sk@0, inv_quantity_on_hand@2, w_warehouse_name@3, i_item_id@5]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                     RepartitionExec: partitioning=Hash([inv_item_sk@1], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                         HashJoinExec: mode=Partitioned, join_type=Inner, on=[(inv_warehouse_sk@2, w_warehouse_sk@0)], projection=[inv_date_sk@0, inv_item_sk@1, inv_quantity_on_hand@3, w_warehouse_name@5]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                             RepartitionExec: partitioning=Hash([inv_warehouse_sk@2], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                               BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                 ParquetExec: file_groups={4 groups: [[tpcds_sf1/inventory/inventory.parquet:0..16070757], [tpcds_sf1/inventory/inventory.parquet:16070757..32141514], [tpcds_sf1/inventory/inventory.parquet:32141514..48212271], [tpcds_sf1/inventory/inventory.parquet:48212271..64283026]]}, projection=[inv_date_sk, inv_item_sk, inv_warehouse_sk, inv_quantity_on_hand]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                             RepartitionExec: partitioning=Hash([w_warehouse_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                                   ParquetExec: file_groups={1 group: [[tpcds_sf1/warehouse/warehouse.parquet]]}, projection=[w_warehouse_sk, w_warehouse_name]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                   CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                     RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|               |                                       RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                           ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_item_id], predicate=i_current_price@5 >= Some(99),7,2 AND i_current_price@5 <= Some(149),7,2, pruning_predicate=CASE WHEN i_current_price_null_count@1 = i_current_price_row_count@2 THEN false ELSE i_current_price_max@0 >= Some(99),7,2 END AND CASE WHEN i_current_price_null_count@1 = i_current_price_row_count@2 THEN false ELSE i_current_price_min@3 <= Some(149),7,2 END, required_guarantees=[N]                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                               RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                 BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                   ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk, d_date], predicate=d_date@2 >= 2000-04-19 AND d_date@2 <= 2000-06-18, pruning_predicate=CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_max@0 >= 2000-04-19 END AND CASE WHEN d_date_null_count@1 = d_date_row_count@2 THEN false ELSE d_date_min@3 <= 2000-06-18 END, required_guarantees=[N]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
