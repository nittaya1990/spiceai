---
source: crates/runtime/benches/bench.rs
description: "Query: select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,\n \tsum(ss_ext_sales_price) ext_price\n from date_dim, store_sales, item,customer,customer_address,store\n where d_date_sk = ss_sold_date_sk\n   and ss_item_sk = i_item_sk\n   and i_manager_id=8\n   and d_moy=11\n   and d_year=1999\n   and ss_customer_sk = c_customer_sk\n   and c_current_addr_sk = ca_address_sk\n   and substr(ca_zip,1,5) <> substr(s_zip,1,5)\n   and ss_store_sk = s_store_sk\n group by i_brand\n      ,i_brand_id\n      ,i_manufact_id\n      ,i_manufact\n order by ext_price desc\n         ,i_brand\n         ,i_brand_id\n         ,i_manufact_id\n         ,i_manufact\n LIMIT 100 ;\n"
snapshot_kind: text
---
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | Projection: brand_id, brand, item.i_manufact_id, item.i_manufact, ext_price                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |   Sort: ext_price DESC NULLS FIRST, item.i_brand ASC NULLS LAST, item.i_brand_id ASC NULLS LAST, item.i_manufact_id ASC NULLS LAST, item.i_manufact ASC NULLS LAST, fetch=100                                                                                                                                                                                                                                                                                                                                               |
|               |     Projection: item.i_brand_id AS brand_id, item.i_brand AS brand, item.i_manufact_id, item.i_manufact, sum(store_sales.ss_ext_sales_price) AS ext_price, item.i_brand, item.i_brand_id                                                                                                                                                                                                                                                                                                                                    |
|               |       Aggregate: groupBy=[[item.i_brand, item.i_brand_id, item.i_manufact_id, item.i_manufact]], aggr=[[sum(store_sales.ss_ext_sales_price)]]                                                                                                                                                                                                                                                                                                                                                                               |
|               |         Projection: store_sales.ss_ext_sales_price, item.i_brand_id, item.i_brand, item.i_manufact_id, item.i_manufact                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |           Inner Join: store_sales.ss_store_sk = store.s_store_sk Filter: substr(customer_address.ca_zip, Int64(1), Int64(5)) != substr(store.s_zip, Int64(1), Int64(5))                                                                                                                                                                                                                                                                                                                                                     |
|               |             Projection: store_sales.ss_store_sk, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_brand, item.i_manufact_id, item.i_manufact, customer_address.ca_zip                                                                                                                                                                                                                                                                                                                                                |
|               |               Inner Join: customer.c_current_addr_sk = customer_address.ca_address_sk                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |                 Projection: store_sales.ss_store_sk, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_brand, item.i_manufact_id, item.i_manufact, customer.c_current_addr_sk                                                                                                                                                                                                                                                                                                                                         |
|               |                   Inner Join: store_sales.ss_customer_sk = customer.c_customer_sk                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                     Projection: store_sales.ss_customer_sk, store_sales.ss_store_sk, store_sales.ss_ext_sales_price, item.i_brand_id, item.i_brand, item.i_manufact_id, item.i_manufact                                                                                                                                                                                                                                                                                                                                     |
|               |                       Inner Join: store_sales.ss_item_sk = item.i_item_sk                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|               |                         Projection: store_sales.ss_item_sk, store_sales.ss_customer_sk, store_sales.ss_store_sk, store_sales.ss_ext_sales_price                                                                                                                                                                                                                                                                                                                                                                             |
|               |                           Inner Join: date_dim.d_date_sk = store_sales.ss_sold_date_sk                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                               TableScan: date_dim projection=[d_date_sk], full_filters=[date_dim.d_moy = Int32(11), date_dim.d_year = Int32(1999)]                                                                                                                                                                                                                                                                                                                                                                          |
|               |                             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                               TableScan: store_sales projection=[ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_ext_sales_price]                                                                                                                                                                                                                                                                                                                                                                              |
|               |                         BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                           TableScan: item projection=[i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact], full_filters=[item.i_manager_id = Int32(8)]                                                                                                                                                                                                                                                                                                                                                               |
|               |                     BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                       TableScan: customer projection=[c_customer_sk, c_current_addr_sk]                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                 BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                   TableScan: customer_address projection=[ca_address_sk, ca_zip]                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |             BytesProcessedNode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |               TableScan: store projection=[s_store_sk, s_zip]                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| physical_plan | ProjectionExec: expr=[brand_id@0 as brand_id, brand@1 as brand, i_manufact_id@2 as i_manufact_id, i_manufact@3 as i_manufact, ext_price@4 as ext_price]                                                                                                                                                                                                                                                                                                                                                                     |
|               |   SortPreservingMergeExec: [ext_price@4 DESC, i_brand@5 ASC NULLS LAST, i_brand_id@6 ASC NULLS LAST, i_manufact_id@2 ASC NULLS LAST, i_manufact@3 ASC NULLS LAST], fetch=100                                                                                                                                                                                                                                                                                                                                                |
|               |     SortExec: TopK(fetch=100), expr=[ext_price@4 DESC, i_brand@5 ASC NULLS LAST, i_brand_id@6 ASC NULLS LAST, i_manufact_id@2 ASC NULLS LAST, i_manufact@3 ASC NULLS LAST], preserve_partitioning=[true]                                                                                                                                                                                                                                                                                                                    |
|               |       ProjectionExec: expr=[i_brand_id@1 as brand_id, i_brand@0 as brand, i_manufact_id@2 as i_manufact_id, i_manufact@3 as i_manufact, sum(store_sales.ss_ext_sales_price)@4 as ext_price, i_brand@0 as i_brand, i_brand_id@1 as i_brand_id]                                                                                                                                                                                                                                                                               |
|               |         AggregateExec: mode=FinalPartitioned, gby=[i_brand@0 as i_brand, i_brand_id@1 as i_brand_id, i_manufact_id@2 as i_manufact_id, i_manufact@3 as i_manufact], aggr=[sum(store_sales.ss_ext_sales_price)]                                                                                                                                                                                                                                                                                                              |
|               |           CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               |             RepartitionExec: partitioning=Hash([i_brand@0, i_brand_id@1, i_manufact_id@2, i_manufact@3], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                             |
|               |               AggregateExec: mode=Partial, gby=[i_brand@2 as i_brand, i_brand_id@1 as i_brand_id, i_manufact_id@3 as i_manufact_id, i_manufact@4 as i_manufact], aggr=[sum(store_sales.ss_ext_sales_price)]                                                                                                                                                                                                                                                                                                                 |
|               |                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_store_sk@0, s_store_sk@0)], filter=substr(ca_zip@0, 1, 5) != substr(s_zip@1, 1, 5), projection=[ss_ext_sales_price@1, i_brand_id@2, i_brand@3, i_manufact_id@4, i_manufact@5]                                                                                                                                                                                                                                                                    |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                       RepartitionExec: partitioning=Hash([ss_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                            |
|               |                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(c_current_addr_sk@6, ca_address_sk@0)], projection=[ss_store_sk@0, ss_ext_sales_price@1, i_brand_id@2, i_brand@3, i_manufact_id@4, i_manufact@5, ca_zip@8]                                                                                                                                                                                                                                                                                  |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                               RepartitionExec: partitioning=Hash([c_current_addr_sk@6], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_customer_sk@0, c_customer_sk@0)], projection=[ss_store_sk@1, ss_ext_sales_price@2, i_brand_id@3, i_brand@4, i_manufact_id@5, i_manufact@6, c_current_addr_sk@8]                                                                                                                                                                                                                                                                  |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       RepartitionExec: partitioning=Hash([ss_customer_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                         CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|               |                                           HashJoinExec: mode=Partitioned, join_type=Inner, on=[(ss_item_sk@0, i_item_sk@0)], projection=[ss_customer_sk@1, ss_store_sk@2, ss_ext_sales_price@3, i_brand_id@5, i_brand@6, i_manufact_id@7, i_manufact@8]                                                                                                                                                                                                                                                                     |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                               RepartitionExec: partitioning=Hash([ss_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                                 CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|               |                                                   HashJoinExec: mode=Partitioned, join_type=Inner, on=[(d_date_sk@0, ss_sold_date_sk@0)], projection=[ss_item_sk@2, ss_customer_sk@3, ss_store_sk@4, ss_ext_sales_price@5]                                                                                                                                                                                                                                                                                                  |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                       RepartitionExec: partitioning=Hash([d_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                              |
|               |                                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                                             ParquetExec: file_groups={1 group: [[tpcds_sf1/date_dim/date_dim.parquet]]}, projection=[d_date_sk], predicate=d_moy@8 = 11 AND d_year@6 = 1999, pruning_predicate=CASE WHEN d_moy_null_count@2 = d_moy_row_count@3 THEN false ELSE d_moy_min@0 <= 11 AND 11 <= d_moy_max@1 END AND CASE WHEN d_year_null_count@6 = d_year_row_count@7 THEN false ELSE d_year_min@4 <= 1999 AND 1999 <= d_year_max@5 END, required_guarantees=[N] |
|               |                                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                                       RepartitionExec: partitioning=Hash([ss_sold_date_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                         BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                                           ParquetExec: file_groups={4 groups: [[tpcds_sf1/store_sales/store_sales.parquet:0..38551918], [tpcds_sf1/store_sales/store_sales.parquet:38551918..77103836], [tpcds_sf1/store_sales/store_sales.parquet:77103836..115655754], [tpcds_sf1/store_sales/store_sales.parquet:115655754..154207672]]}, projection=[ss_sold_date_sk, ss_item_sk, ss_customer_sk, ss_store_sk, ss_ext_sales_price]                                                                      |
|               |                                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                                               RepartitionExec: partitioning=Hash([i_item_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                      |
|               |                                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/item/item.parquet]]}, projection=[i_item_sk, i_brand_id, i_brand, i_manufact_id, i_manufact], predicate=i_manager_id@20 = 8, pruning_predicate=CASE WHEN i_manager_id_null_count@2 = i_manager_id_row_count@3 THEN false ELSE i_manager_id_min@0 <= 8 AND 8 <= i_manager_id_max@1 END, required_guarantees=[N]                                                                                         |
|               |                                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                                       RepartitionExec: partitioning=Hash([c_customer_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                          |
|               |                                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                                             ParquetExec: file_groups={1 group: [[tpcds_sf1/customer/customer.parquet]]}, projection=[c_customer_sk, c_current_addr_sk]                                                                                                                                                                                                                                                                                                                                                      |
|               |                             CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               |                               RepartitionExec: partitioning=Hash([ca_address_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               |                                 RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                   BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|               |                                     ParquetExec: file_groups={1 group: [[tpcds_sf1/customer_address/customer_address.parquet]]}, projection=[ca_address_sk, ca_zip]                                                                                                                                                                                                                                                                                                                                                         |
|               |                     CoalesceBatchesExec: target_batch_size=8192                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                       RepartitionExec: partitioning=Hash([s_store_sk@0], 4), input_partitions=4                                                                                                                                                                                                                                                                                                                                                                                                                             |
|               |                         RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                           BytesProcessedExec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               |                             ParquetExec: file_groups={1 group: [[tpcds_sf1/store/store.parquet]]}, projection=[s_store_sk, s_zip]                                                                                                                                                                                                                                                                                                                                                                                           |
|               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
